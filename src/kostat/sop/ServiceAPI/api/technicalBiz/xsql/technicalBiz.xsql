<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="technicalBiz">

	<!-- 기술업종 코드 조회 -->
	<select id="getTechCd" parameterType="hashmap" resultType="hashmap">
		select 
			techbiz_s_class_cd s_class_cd
			,techbiz_s_class_cd_nm s_class_nm
			,cd_exp class_exp 
			<!-- 2017.10.24 개발팀 수정 class_exp 오류로 삭제 -->
			<!-- ,class_exp -->
		from cmm_cd_techbiz_cd
		<where>
			<if test='m_class_cd != "undefined"'>
				and techbiz_m_class_cd = #{m_class_cd}
			</if>
			<if test='b_class_cd != "undefined"'>
				and techbiz_b_class_cd = #{b_class_cd}
			</if>
			<if test='s_class_cd != "undefined"'>
				and techbiz_s_class_cd = #{s_class_cd}
			</if>
		</where>
	</select>

	<select id="getIntroData" parameterType="hashmap" resultType="hashmap">
		select distinct
			ct.base_year
			,ct.techbiz_class_cd m_class_cd
			,cd.techbiz_m_class_cd_nm m_class_nm
			,ct.corp_cnt
			,ct.corp_per
			,ct.corp_irdsrate
		from srv_dt_techbiz_chartrinfo ct 
		left join cmm_cd_techbiz_cd cd
		on ct.techbiz_class_cd = cd.techbiz_m_class_cd
		where region_div = 0
		  and techbiz_cd_div = 2
		  and base_year between ${base_year}-5 and ${base_year} 
		order by base_year desc
	</select>
	
	<!-- 시도별 기술업종 분포현황 -->
	<select id="getSidoFeature" parameterType="hashmap" resultType="hashmap">
			select
			         sido.techbiz_class_cd m_class_cd
			         ,techcd.techbiz_m_class_cd_nm m_class_nm
			         ,sido.corp_per
			         ,tot.corp_per_avg
			         ,sido.sido_z_score
			         ,5 tot_z_score
			         <!-- 2017.08.29 개발팀 추가 -->
			        ,corp_cnt
			        ,corp_irdsrate
			        ,corp_cnt_avg
			        ,lq.country_comp_corp_lq as corp_lct
			        ,worker_per
			        ,worker_cnt
			        ,worker_irdsrate
			        ,worker_cnt_avg
			        ,worker_per_avg
			        ,lq.country_comp_worker_lq as worker_lct
			        ,corp_irdsrate_avg
			        ,worker_irdsrate_avg
			<!-- 2017.08.29 개발팀 추가 끝 -->
			from (
	           select
					cht.adm_cd
					,cht.techbiz_class_cd
					,nvl(cht.corp_per,0) corp_per  <!-- 사업체 수 -->
					,nvl(reg.corp_per,0) sido_z_score  <!-- 사업체 평균비율 -->
					,nvl(reg.CORP_IRDSRATE,0) corp_irdsrate_avg <!-- 사업체평균 증감율 -->
					<!-- 2017.08.29 개발팀 추가 -->
					<!-- 사업체 -->
					,nvl(cht.CORP_CNT,0) corp_cnt <!-- 사업체 수 -->
					,nvl(cht.CORP_IRDSRATE,0) corp_irdsrate <!-- 사업체 증감율 -->
					,nvl(reg.CORP_CNT,0) corp_cnt_avg <!-- 사업체평균수 -->
					<!-- 종사자 -->
					,nvl(cht.WORKER_PER,0) worker_per <!-- 종사자비율 -->
					,nvl(cht.WORKER_CNT,0) worker_cnt <!-- 종사자수 -->
					,nvl(cht.WORKER_IRDSRATE,0) worker_irdsrate <!-- 종사자 증감율 -->
					,nvl(reg.WORKER_CNT,0) worker_cnt_avg <!-- 종사자평균수 -->
					,nvl(reg.WORKER_PER,0) worker_per_avg <!-- 종사자평균비율 -->
					,nvl(reg.WORKER_IRDSRATE,0) worker_irdsrate_avg <!-- 종사자평균 증감율 -->
	           <!-- 2017.08.29 개발팀 추가 끝 -->
	           from
	                     SRV_DT_TECHBIZ_CHARTRINFO cht
	           left join
	                     SRV_DT_TECHBIZ_REGIONTOTAL reg
	           on (cht.techbiz_class_cd = reg.techbiz_m_class_cd and trim(cht.adm_cd) = reg.sido_cd)
	           where cht.region_div = 1
	                     and cht.techbiz_cd_div = 2
	                     and cht.base_year = #{base_year}
	                     and trim(cht.adm_cd) = #{adm_cd}
	                     and cht.base_year = reg.base_year
	                     and TRIM(cht.adm_cd) = reg.sido_cd
	) sido
	left join (
	           select
	                     techbiz_class_cd
	                     ,nvl(avg(corp_per),0) corp_per_avg
	           from
	                     SRV_DT_TECHBIZ_CHARTRINFO
	           where region_div = 1
	                     and techbiz_cd_div = 2
	                     and base_year = #{base_year}
	           group by techbiz_class_cd
	) tot
	on (sido.techbiz_class_cd = tot.techbiz_class_cd)
	left join (
	           select
	                     techbiz_m_class_cd
	                     ,techbiz_m_class_cd_nm
	           from
	                     cmm_cd_techbiz_cd techcd
	           group by
	                     techbiz_m_class_cd
	                     ,techbiz_m_class_cd_nm
	) techcd
	on (sido.techbiz_class_cd = techcd.techbiz_m_class_cd)
	left join (
	           select
	                     *
	           from
	                     srv_dt_techbiz_lq_regiontotal
	           where
	                     base_year = #{base_year}
	                     and adm_cd = #{adm_cd}
	) lq
	on sido.techbiz_class_cd = lq.techbiz_class_cd
	and sido.adm_cd = lq.adm_cd
	</select>
	
	<!-- 시도별 업종별 기술업종 특성정보 -->
	<select id="getSidoFeatureDetail" parameterType="hashmap" resultType="hashmap">
		select
			sido.sido_cd
			,sido.techbiz_b_class_cd b_class_cd
			,techcd.techbiz_b_class_cd_nm b_class_nm
			,sido.techbiz_m_class_cd m_class_cd
			,techcd.techbiz_m_class_cd_nm m_class_nm
			,nvl(sido.corp_cnt,0) corp_cnt_z_score
			,nvl(sido.corp_per,0) corp_per_z_score
			,nvl(sido.corp_irdsrate,0) corp_irds_z_score
			,nvl(sido.worker_cnt,0) worker_cnt_z_score
			,nvl(sido.worker_per,0) worker_per_z_score
			,nvl(sido.worker_irdsrate,0) worker_irds_z_score
		from SRV_DT_TECHBIZ_REGIONTOTAL sido
		left join (
			select distinct
				techbiz_m_class_cd				
				,techbiz_m_class_cd_nm
				,techbiz_b_class_cd
				,techbiz_b_class_cd_nm
			from cmm_cd_techbiz_cd techcd
		) techcd
		on (sido.techbiz_m_class_cd = techcd.techbiz_m_class_cd)
		where sido.base_year = #{base_year}
		  and sido.sido_cd = #{adm_cd}
	</select>
	
	<!-- 업종별 년도별 성남시 신설법인 사업체 수 -->
	<select id="getDensitySeongnam" parameterType="hashmap" resultType="hashmap">
		 SELECT 
		 		count(corp_serial) as corp_cnt, 
		 		base_year
 		 FROM  root.srv_dt_techbiz_newcorpinfo 
 		 WHERE 
	 		 <if test='adm_cd.length() == 2'>
	 		 	sido_cd = SUBSTR(#{adm_cd},1,2) 
	 		 </if>
	 		 <if test='adm_cd.length() == 5'>
	 		 	sido_cd = SUBSTR(#{adm_cd},1,2)
	 		 	
	 		 	<if test='adm_cd == "31020"'>
	 		 		 and sgg_cd like SUBSTR(#{adm_cd},3,2) || '%'
	 		 	</if> 
	 		 	<if test='adm_cd != "31020"'>
	 		 		 and sgg_cd = SUBSTR(#{adm_cd},3,3)
	 		 	</if> 
	 		   
	 		 </if>
	 		 <if test='adm_cd.length() == 7'>
	 		 	sido_cd = SUBSTR(#{adm_cd},1,2) 
	 		    and sgg_cd = SUBSTR(#{adm_cd},3,3)
	 		    and emdong_cd= SUBSTR(#{adm_cd},6,2)
	 		 </if>
 		 GROUP BY base_year
	</select>
	
	<!-- 시군구별 분류별 사업체 및 종사자 현황 -->
	<select id="getSigunguClass" parameterType="hashmap" resultType="hashmap">
		select
			 (select sido_nm from srv_pg_sidobord where sido_cd = A.sido_cd and base_year = #{bnd_year}) sido_nm
			,(select sgg_nm from srv_pg_sggbord where sido_cd = A.sido_cd and sgg_cd = A.sgg_cd and base_year = #{bnd_year}) sgg_nm
			,(
				select 
				<choose>
					<when test='m_class_cd == "00"'>
						distinct techbiz_m_class_cd_nm from cmm_cd_techbiz_cd where techbiz_m_class_cd = TRIM(A.s_class_cd)
					</when>
					<when test='m_class_cd != "00"'>
						techbiz_s_class_cd_nm from cmm_cd_techbiz_cd where techbiz_s_class_cd = TRIM(A.s_class_cd)
					</when>
				</choose>	
			 ) s_class_nm
			,A.*
		from (
			select 
				 substr(adm_cd, 1,2) sido_cd
				,substr(adm_cd, 3,3) sgg_cd
				,techbiz_class_cd s_class_cd
				,base_year
				,corp_cnt
				,corp_per
				,corp_irdsrate
				,worker_cnt
				,worker_per
				,worker_irdsrate
			from srv_dt_techbiz_chartrinfo
			where 
				<choose>
					<when test='m_class_cd == "00"'>
						techbiz_cd_div = '2'
					</when>
					<when test='m_class_cd != "00"'>
						techbiz_cd_div = '3'
					and techbiz_class_cd like TRIM(#{m_class_cd}) || '%'
					</when>
				</choose>	 
			  and base_year = #{base_year}
			  	<choose>
			  		<when test="sgg_cd == 'undefined'">
						and region_div = '1'
						and trim(adm_cd) = #{sido_cd}
			  		</when>
			  		<when test="sgg_cd != 'undefined'">
				  		and region_div = '2'
						and trim(adm_cd) = #{sgg_cd}
			  		</when>
			  	</choose>
		) A
		order by A.corp_cnt desc;
	</select>

	<!-- 시도별, 분류별 경제총조사 -->
	<select id="getSidoEconomy" parameterType="hashmap" resultType="hashmap">
		select 
			 stat.techbiz_b_class_cd b_class_cd
			,stat.techbiz_m_class_cd m_class_cd
			,cd.techbiz_b_class_cd_nm b_class_nm 
			,cd.techbiz_m_class_cd_nm m_class_nm
			,stat.base_year
			<!-- 2017. 03. 09 개발팀 수정 요청 -->
			,ROUND(avg(stat.sales), 2) sales
			,ROUND(avg(stat.lbcst), 2) lbcst
			,ROUND(avg(stat.rntchrg), 2) rntchrg
			,ROUND(avg(stat.business_profit), 2) business_profit 
		from srv_dt_techbiz_ecocensus_stat stat
		left outer join (
			select distinct
				 techbiz_b_class_cd
				,techbiz_m_class_cd
				,techbiz_b_class_cd_nm
				,techbiz_m_class_cd_nm
			from cmm_cd_techbiz_cd
		) cd
		on cd.techbiz_m_class_cd = stat.techbiz_m_class_cd
		where stat.base_year = #{base_year}
		<if test='b_class_cd != "undefined"'>
		and cd.techbiz_b_class_cd = #{b_class_cd}
		</if>
		<if test='sido_cd != "undefined"'>
		and stat.sido_cd = #{sido_cd}
		</if>
		group by 
			 stat.techbiz_b_class_cd
			,stat.techbiz_m_class_cd
			,stat.base_year
			,cd.techbiz_b_class_cd_nm
			,cd.techbiz_m_class_cd_nm
			<if test='sido_cd != "undefined"'>,stat.sido_cd </if>
	</select>
	
	<!-- 시계열별 사업체 수, 사업체 비율 -->
	<select id="getDensityCombined" parameterType="hashmap" resultType="hashmap">
		<!-- select 
			* 
		from (
			select 
				 base_year
				,count(list_db_serial) corp_cnt
			from srv_dt_corpcensus_8
			<where>
				<if test='m_class_cd != "undefined"'>
				and to_char(techbiz_s_class_cd) like #{m_class_cd} || '%'
				</if>
				<if test='s_class_cd != "undefined"'>
				and to_char(techbiz_s_class_cd) = #{s_class_cd}
				</if>
				<if test='adm_cd != "undefined"'>
				and to_char(adm_cd) like #{adm_cd} || '%'	
				</if>
				<if test='base_year != "undefined"'>
				and base_year &lt; #{base_year}	
				</if>
			</where>
			group by base_year
			union 
			select 
				 base_year
				,count(list_db_serial) corp_cnt
			from srv_dt_corpcensus_9
			<where>
				<if test='m_class_cd != "undefined"'>
				and to_char(techbiz_s_class_cd) like #{m_class_cd} || '%'
				</if>
				<if test='s_class_cd != "undefined"'>
				and to_char(techbiz_s_class_cd) = #{s_class_cd}
				</if>
				<if test='adm_cd != "undefined"'>
				and to_char(adm_cd) like #{adm_cd} || '%'	
				</if>
				<if test='base_year != "undefined"'>
				and base_year &lt; #{base_year}	
				</if>
			</where>
			group by base_year
		)
		order by base_year-->
		
		<!-- select 
				 base_year
				,count(list_db_serial) corp_cnt
			from srv_dt_corpcensus_9
			<where>
				<if test='m_class_cd != "undefined"'>
				and to_char(techbiz_s_class_cd) like #{m_class_cd} || '%'
				</if>
				<if test='s_class_cd != "undefined"'>
				and to_char(techbiz_s_class_cd) = #{s_class_cd}
				</if>
				<if test='adm_cd != "undefined"'>
				and to_char(adm_cd) like #{adm_cd} || '%'	
				</if>
				<if test='base_year != "undefined"'>
				and base_year &lt; #{base_year}	
				</if>
			</where>
			group by base_year
			order by base_year -->
			
			
			<if test='adm_cd == "undefined"'>
				SELECT
						sum(corp_cnt) as corp_cnt,
						base_year
				FROM	srv_dt_techbiz_chartrinfo
				WHERE	region_div = '1'
					<if test='m_class_cd != "undefined"'>
						AND techbiz_class_cd = #{s_class_cd} 
					</if>
				GROUP BY base_year
				ORDER BY base_year ASC; 
			</if>
			<if test='adm_cd != "undefined"'>
				<if test='m_class_cd != "undefined"'>
					SELECT
							corp_per,
							corp_cnt,
							base_year
					FROM	srv_dt_techbiz_chartrinfo
					WHERE	trim(adm_cd) = #{adm_cd}
							AND techbiz_class_cd = #{s_class_cd} 
					ORDER BY base_year ASC;  
					
				</if>
				
				<if test='m_class_cd == "undefined"'>
				 	SELECT
							sum(corp_cnt) as corp_cnt,
							base_year
					FROM	srv_dt_techbiz_chartrinfo
					WHERE	
						trim(adm_cd) = #{adm_cd} and techbiz_cd_div = '1'
					GROUP BY base_year
					ORDER BY base_year ASC;  
				</if>
			</if> 

					
			
	</select>
	
	<!-- 타입별 시군구 순위 -->
	<!-- 2017.09.14 개발팀 수정 증감율이 빠진곳이 있는것 같아 점검 필요-->
	<select id="getSigunguRank" parameterType="hashmap" resultType="hashmap">
		select 
			rank.*
			   , chartr.corp_irdsrate as corp_irdsrate
			   , chartr.worker_irdsrate as worker_irdsrate
			from
			(
			   select 
			       cnt.sido_cd
			      ,cnt.sgg_cd
			      ,cnt.base_year
			      ,(select sido_nm from srv_pg_sidobord where sido_cd = cnt.sido_cd and base_year = #{bnd_year}) as sido_nm
			      ,(select sgg_nm from srv_pg_sggbord where sido_cd = cnt.sido_cd and sgg_cd = cnt.sgg_cd and base_year = #{bnd_year}) as sgg_nm
			      ,cnt.techbiz_m_class_cd m_class_cd
			      ,cnt.corp_cnt
			      ,rate.corp_per
			      ,ppltn.resid_ppltn_cnt
			      ,worker.worker_cnt
			      ,avgworker.avg_worker_cnt
			   from srv_dt_techbiz_corpcnt_sgg cnt
			   left join srv_dt_techbiz_corprate_sgg rate
			     on (cnt.sido_cd = rate.sido_cd and cnt.sgg_cd = rate.sgg_cd and cnt.techbiz_m_class_cd = rate.techbiz_m_class_cd and cnt.base_year = rate.base_year)
			   left join srv_dt_techbiz_ppltn_sgg ppltn
			     on (cnt.sido_cd = ppltn.sido_cd and cnt.sgg_cd = ppltn.sgg_cd and cnt.techbiz_m_class_cd = ppltn.techbiz_m_class_cd)
			   left join srv_dt_techbiz_worker_sgg worker
			     on (cnt.sido_cd = worker.sido_cd and cnt.sgg_cd = worker.sgg_cd and cnt.techbiz_m_class_cd = worker.techbiz_m_class_cd and cnt.base_year = worker.base_year)
			   left join srv_dt_techbiz_avgworker_sgg avgworker
			     on (cnt.sido_cd = avgworker.sido_cd and cnt.sgg_cd = avgworker.sgg_cd and cnt.techbiz_m_class_cd = avgworker.techbiz_m_class_cd and cnt.base_year = avgworker.base_year)
			   where cnt.techbiz_m_class_cd = #{m_class_cd}
			     and cnt.sido_cd = substr(#{adm_cd},1,2)
			     and cnt.base_year = #{base_year}
			     and cnt.sgg_cd != '000'
			) rank
			left join
			(
			   select
			      substr(adm_cd, 1, 2) as sido_cd
			      , substr(adm_cd, 3, 3) as sgg_cd
			      , techbiz_class_cd
			      , NVL(corp_irdsrate,0) as corp_irdsrate
			      , NVL(worker_irdsrate,0) as worker_irdsrate
			   from
			      srv_dt_techbiz_chartrinfo
			   where
			      base_year = #{base_year}
			      and region_div = '2'
			      and trim(adm_cd) like #{adm_cd}||'%'
			) chartr
			on rank.sido_cd = chartr.sido_cd and rank.sgg_cd = chartr.sgg_cd and rank.m_class_cd = chartr.techbiz_class_cd
	
		<!-- select 
			 cnt.sido_cd
			,cnt.sgg_cd
			,cnt.base_year
			,(select sido_nm from srv_pg_sidobord where sido_cd = cnt.sido_cd and base_year = #{bnd_year}) as sido_nm
			,(select sgg_nm from srv_pg_sggbord where sido_cd = cnt.sido_cd and sgg_cd = cnt.sgg_cd and base_year = #{bnd_year}) as sgg_nm
			,cnt.techbiz_m_class_cd m_class_cd
			,cnt.corp_cnt
			,rate.corp_per
			,ppltn.resid_ppltn_cnt
			,worker.worker_cnt
			,avgworker.avg_worker_cnt
		from srv_dt_techbiz_corpcnt_sgg cnt
		left join srv_dt_techbiz_corprate_sgg rate
		  on (cnt.sido_cd = rate.sido_cd and cnt.sgg_cd = rate.sgg_cd and cnt.techbiz_m_class_cd = rate.techbiz_m_class_cd and cnt.base_year = rate.base_year)
		left join srv_dt_techbiz_ppltn_sgg ppltn
		  on (cnt.sido_cd = ppltn.sido_cd and cnt.sgg_cd = ppltn.sgg_cd and cnt.techbiz_m_class_cd = ppltn.techbiz_m_class_cd)
		left join srv_dt_techbiz_worker_sgg worker
		  on (cnt.sido_cd = worker.sido_cd and cnt.sgg_cd = worker.sgg_cd and cnt.techbiz_m_class_cd = worker.techbiz_m_class_cd and cnt.base_year = worker.base_year)
		left join srv_dt_techbiz_avgworker_sgg avgworker
		  on (cnt.sido_cd = avgworker.sido_cd and cnt.sgg_cd = avgworker.sgg_cd and cnt.techbiz_m_class_cd = avgworker.techbiz_m_class_cd and cnt.base_year = avgworker.base_year)
		where cnt.techbiz_m_class_cd = #{m_class_cd}
		  and cnt.sido_cd = substr(#{adm_cd},1,2)
		  and cnt.base_year = #{base_year}
		  and cnt.sgg_cd != '000' -->
	</select>

	<!-- 영역내 사업체 -->
	<select id="areacorp" parameterType="hashmap" resultType="hashmap">	
		select class.theme_cd theme_cd
			, theme.s_theme_cd_nm theme_nm
			, count(corp.ksic5) corp_cnt  
		from
			${year} corp
			, cmm_cd_corpclass class
			, cmm_cd_theme theme
		<where> 
			<if test='area_kind  == "POLYGON" '>
				and st_contains(st_polyfromtext(#{area},0),corp.pt)=1 
			</if>
			<if test='area_kind  == "POINT" '>
				and st_contains(ST_BUFFER(st_pointfromtext(#{area},0),#{round}),corp.pt) = 1
			</if>
			<if test='area_kind  == "RECTANGLE" '>
				and st_contains(st_rectfromtext(#{area},0),corp.pt) = 1
			</if>
			and class.theme_cd in ('1001','1002','1003','1004','1005','1006','1007','1008','1009','1013','2004',
			'2006','4002','5001','5002','5003','5004','5005','5006','5007','5008','5009','5010','5011')
			and corp.ksic5 = class.ksic5
			and class.theme_cd = theme.theme_cd
		</where>
		group by class.theme_cd,s_theme_cd_nm
	</select>
	
	<!-- 영역내 거주인구 -->
	<select id="areapopulation" parameterType="hashmap" resultType="hashmap">	
		select 
			nvl(sum(case when (age <![CDATA[>=]]> 0 and age <![CDATA[<=]]> 9) and gender ='1' then 1 end),0) m_00_age
			,nvl(sum(case when (age <![CDATA[>=]]> 10 and age <![CDATA[<=]]> 19) and gender ='1' then 1 end),0) m_10_age
			,nvl(sum(case when (age <![CDATA[>=]]> 20 and age <![CDATA[<=]]> 29) and gender ='1' then 1 end),0) m_20_age
			,nvl(sum(case when (age <![CDATA[>=]]> 30 and age <![CDATA[<=]]> 39) and gender ='1' then 1 end),0) m_30_age
			,nvl(sum(case when (age <![CDATA[>=]]> 40 and age <![CDATA[<=]]> 49) and gender ='1' then 1 end),0) m_40_age
			,nvl(sum(case when (age <![CDATA[>=]]> 50 and age <![CDATA[<=]]> 59) and gender ='1' then 1 end),0) m_50_age
			,nvl(sum(case when age <![CDATA[>=]]> 60 and gender ='1' then 1 end),0) m_60_age
			,nvl(sum(case when (age <![CDATA[>=]]> 0 and age <![CDATA[<=]]> 9) and gender ='2' then 1 end),0) w_00_age
			,nvl(sum(case when (age <![CDATA[>=]]> 10 and age <![CDATA[<=]]> 19) and gender ='2' then 1 end),0) w_10_age
			,nvl(sum(case when (age <![CDATA[>=]]> 20 and age <![CDATA[<=]]> 29) and gender ='2' then 1 end),0) w_20_age
			,nvl(sum(case when (age <![CDATA[>=]]> 30 and age <![CDATA[<=]]> 39) and gender ='2' then 1 end),0) w_30_age
			,nvl(sum(case when (age <![CDATA[>=]]> 40 and age <![CDATA[<=]]> 49) and gender ='2' then 1 end),0) w_40_age
			,nvl(sum(case when (age <![CDATA[>=]]> 50 and age <![CDATA[<=]]> 59) and gender ='2' then 1 end),0) w_50_age
			,nvl(sum(case when age <![CDATA[>=]]> 60 and gender ='2' then 1 end),0) w_60_age
			from ${year} ppl
			<where> 
				<if test='area_kind  == "POLYGON" '>
					and st_contains(st_polyfromtext(#{area},0),ppl.pt)=1 
				</if>
				<if test='area_kind  == "POINT" '>
					and st_contains(ST_BUFFER(st_pointfromtext(#{area},0),#{round}),ppl.pt) = 1
				</if>
				<if test='area_kind  == "RECTANGLE" '>
					and st_contains(st_rectfromtext(#{area},0),ppl.pt) = 1
				</if>
			</where>
	</select>
	
	<!-- 영역내 직장인구 -->
	<select id="areacorpworker" parameterType="hashmap" resultType="hashmap">	
		select nvl(sum(worker_sum),0) worker_sum
		from
			${year} corp
		<where> 
			<if test='area_kind  == "POLYGON" '>
				and st_contains(st_polyfromtext(#{area},0),corp.pt)=1 
			</if>
			<if test='area_kind  == "POINT" '>
				and st_contains(ST_BUFFER(st_pointfromtext(#{area},0),#{round}),corp.pt) = 1
			</if>
			<if test='area_kind  == "RECTANGLE" '>
				and st_contains(st_rectfromtext(#{area},0),corp.pt) = 1
			</if>
		</where>
	</select>
	
	<!-- 영역내 세대구성 -->
	<select id="areahousehold" parameterType="hashmap" resultType="hashmap">	
		select nvl(sum(decode(family.household_type,'01',1,0)),0) household_01_type
			, nvl(sum(decode(family.household_type,'02',1,0)),0) household_02_type
			, nvl(sum(decode(family.household_type,'03',1,0)),0) household_03_type
			, nvl(sum(decode(family.household_type,'04',1,0)),0) household_04_type
			, nvl(sum(decode(family.household_type,'05',1,0)),0) household_05_type
			, nvl(sum(decode(family.household_type,'B0',1,0)),0) household_B0_type
			from ${year} family
			<where> 
				<if test='area_kind  == "POLYGON" '>
					and st_contains(st_polyfromtext(#{area},0),family.pt)=1 
				</if>
				<if test='area_kind  == "POINT" '>
					and st_contains(ST_BUFFER(st_pointfromtext(#{area},0),#{round}),family.pt) = 1
				</if>
				<if test='area_kind  == "RECTANGLE" '>
					and st_contains(st_rectfromtext(#{area},0),family.pt) = 1
				</if>
			</where>
	</select>
	
	<!-- 영역내 주택유형 -->
	<select id="areahousetype" parameterType="hashmap" resultType="hashmap">	
		select nvl(sum(case when house.house_type = '01'  then 1 end),0) detach_house_per
			, nvl(sum(case when (house.house_type = '03' or house.house_type = '04') then 1 end),0) row_multi_house
			, nvl(sum(case when house.house_type = '06' then 1 end),0) effi_apart_per
			, nvl(sum(case when house.house_type = '08' then 1 end),0) dom_soc_fac_per
			, nvl(sum(case when house.house_type = '02' then 1 end),0) apart
			, nvl(sum(case when (house.house_type = '05' or house.house_type = '07'or house.house_type = '09'or house.house_type = '10') then 1 end),0) etc
			from ${year} house
			<where> 
				<if test='area_kind  == "POLYGON" '>
					and st_contains(st_polyfromtext(#{area},0),house.pt)=1 
				</if>
				<if test='area_kind  == "POINT" '>
					and st_contains(ST_BUFFER(st_pointfromtext(#{area},0),#{round}),house.pt) = 1
				</if>
				<if test='area_kind  == "RECTANGLE" '>
					and st_contains(st_rectfromtext(#{area},0),house.pt) = 1
				</if>
			</where>
	</select>
	
	<!-- 선택상권 정보 -->
	<select id="tradeAreaCorp" parameterType="hashmap" resultType="hashmap">	
		SELECT	info.theme_cd
		,			theme.s_theme_cd_nm
		,			info.corp_cnt
		,			info.corp_per
		FROM 	SRV_DT_BUSCOMMER com
		,			SRV_DT_SMALL_LIFEBIZ_INFO info
		,			CMM_CD_THEME theme
		WHERE	com.tradearea_id = info.tradearea_id
		AND		info.theme_cd = theme.theme_cd
		AND		com.tradearea_id = #{tradearea_id}
		AND		SUBSTR(info.theme_cd, 1, 2) = #{theme_cd}
		ORDER BY info.corp_cnt DESC
	</select>
	
	<!-- 최신년도 조회 -->
	<select id="getBaseYear" parameterType="hashmap" resultType="String">
		SELECT  base_year
		FROM    srv_dt_statbaseyearinfo
		WHERE   api_id = #{api_id}
		AND     param_info = #{param}
	</select>
	
	<!-- 경계면적조회 -->
	<select id="polygonuserareacheck" parameterType="hashmap" resultType="String">
		Select round(ST_AREA(ST_POLYFROMTEXT(#{area},0))) areasize from dual
	</select>
	<select id="cercleuserareacheck" parameterType="hashmap" resultType="String">
		Select round(ST_AREA(ST_BUFFER(ST_POINTFROMTEXT(#{area},0),#{round}))) areasize from dual
	</select>
	<select id="rectuserareacheck" parameterType="hashmap" resultType="String">
		Select round(ST_AREA(ST_RECTFROMTEXT(#{area},0))) areasize from dual
	</select>
	
	<!-- 상권조회  -->
	<select id="tradearea" parameterType="hashmap" resultType="hashmap">
         Select tradearea_id, tradearea_nm, st_asbinary(bord) geometry
         from srv_dt_buscommer
         where 
              st_intersects(st_rectfromtext(#{area},0),bord) = 1
	</select>
	
	<!-- 주택거래가격 -->
	<select id="houseprice" parameterType="hashmap" resultType="hashmap">	
		Select price.ym as year_month
			, round(price.apt_highest_price/10000) as apart_highest_price
			, round(price.apt_lowest_price/10000) apart_lowest_price
			, round(price.rmhouse_highest_price/10000) row_multi_house_highest_price
			, round(price.rmhouse_lowest_price/10000) row_multi_house_lowest_price
			<!-- 2017. 06. 27 j.h.Seok DB 표준화 작업 -->
			, round(price.slh_highest_price/10000) single_highest_price
			, round(price.slh_lowest_price/10000) single_lowest_price
		<if test='adm_cd.length() == 7 '>
			, bord.emdong_nm adm_nm
			, bord.sido_cd||bord.sgg_cd||bord.emdong_cd adm_cd
		from srv_dt_housevolumeprice price
			,srv_pg_admbord bord
		where price.sido_cd=substr(#{adm_cd},1,2)
			and price.sgg_cd=substr(#{adm_cd},3,3)
			and price.emdong_cd=substr(#{adm_cd},6,2)
			and price.tot_reg_cd='0000000000000'
			and bord.base_year = #{year}
			and price.sido_cd=bord.sido_cd
			and price.sgg_cd=bord.sgg_cd
			and price.emdong_cd=bord.emdong_cd
		</if>
		<if test='adm_cd.length() == 5 '>
			, bord.sgg_nm adm_nm
			, bord.sido_cd||bord.sgg_cd adm_cd
		from srv_dt_housevolumeprice price
			,srv_pg_sggbord bord
		where price.sido_cd=substr(#{adm_cd},1,2)
			and price.sgg_cd=substr(#{adm_cd},3,3)
			and price.emdong_cd='00'
			and price.tot_reg_cd='0000000000000'
			and bord.base_year = #{year}
			and price.sido_cd=bord.sido_cd
			and price.sgg_cd=bord.sgg_cd
		</if>
		<if test='adm_cd.length() == 2 '>
			, bord.sido_nm adm_nm
			, bord.sido_cd adm_cd
		from srv_dt_housevolumeprice price
			,srv_pg_sidobord bord
		where price.sido_cd=#{adm_cd}
			and price.sgg_cd='000'
			and price.emdong_cd='00'
			and price.tot_reg_cd='0000000000000'
			and bord.base_year = #{year}
			and price.sido_cd=bord.sido_cd
		</if>
	</select>
	
	<!-- 주택거래량 -->
	<select id="housevolume" parameterType="hashmap" resultType="hashmap">	
		Select volume.ym as year_month
			<!-- 2017. 06. 27 j.h.Seok DB 표준화 작업 -->
			, volume.apt_deal_delng_qntty as apart_deal_volume
			, volume.apt_lease_delng_qntty as apart_lease_volume
			, volume.rmhouse_delng_qntty as row_multi_dealvolume
			, volume.rmhouse_lease_delng_qntty as row_multi_leasevolume
			, volume.slh_deal_delng_qntty as single_deal_volume
			, volume.slh_lease_delng_qntty as single_lease_volume
		<if test='adm_cd.length() == 7 '>
			, bord.emdong_nm adm_nm
			, bord.sido_cd||bord.sgg_cd||bord.emdong_cd adm_cd
		from srv_dt_housevolume volume
			,srv_pg_admbord bord
		where volume.sido_cd=substr(#{adm_cd},1,2)
			and volume.sgg_cd=substr(#{adm_cd},3,3)
			and volume.emdong_cd=substr(#{adm_cd},6,2)
			and bord.base_year = #{year}
			and volume.sido_cd=bord.sido_cd
			and volume.sgg_cd=bord.sgg_cd
			and volume.emdong_cd=bord.emdong_cd
		</if>
		<if test='adm_cd.length() == 5 '>
			, bord.sgg_nm adm_nm
			, bord.sido_cd||bord.sgg_cd adm_cd
		from srv_dt_housevolume volume
			,srv_pg_sggbord bord
		where volume.sido_cd=substr(#{adm_cd},1,2)
			and volume.sgg_cd=substr(#{adm_cd},3,3)
			and volume.emdong_cd='00'
			and bord.base_year = #{year}
			and volume.sido_cd=bord.sido_cd
			and volume.sgg_cd=bord.sgg_cd
		</if>
		<if test='adm_cd.length() == 2 '>
			, bord.sido_nm adm_nm
			, bord.sido_cd adm_cd
		from srv_dt_housevolume volume
			,srv_pg_sidobord bord
		where volume.sido_cd=#{adm_cd}
			and volume.sgg_cd='000'
			and volume.emdong_cd='00'
			and bord.base_year = #{year}
			and volume.sido_cd=bord.sido_cd
		</if>
	</select>
	
	<!-- 지역 특성정보 -->
	<select id="regionalSpec" parameterType="hashmap" resultType="String">	
		Select 
		<if test='data_type != "40" '>
			spec.data_cd
		</if>
		<if test='data_type == "40" '>
			theme.s_theme_cd_nm data_cd
		</if>
		<if test='adm_cd.length() == 7 '>
		from srv_dt_regionalspec spec
		<if test='data_type == "40" '>
			,cmm_cd_theme theme
		</if>
		<where> 
			<if test='data_type == "10" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 10
			</if>
			<if test='data_type == "20" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 20
			</if>
			<if test='data_type == "30" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 30
			</if>
			<if test='data_type == "40" '>
					spec.upper_region_percentile <![CDATA[<=]]> 3
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt <![CDATA[>]]> 20 
				and spec.data_type = 40
				and spec.data_cd=theme.theme_cd
			</if>
				and spec.sido_cd=substr(#{adm_cd},1,2)
				and spec.sgg_cd=substr(#{adm_cd},3,3)
				and spec.emdong_cd=substr(#{adm_cd},6,2)
		</where>
		</if>
		<if test='adm_cd.length() == 5 '>
		from srv_dt_regionalspec spec
		<if test='data_type == "40" '>
			,cmm_cd_theme theme
		</if>
		<where> 
			<if test='data_type == "10" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 10
			</if>
			<if test='data_type == "20" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 20
			</if>
			<if test='data_type == "30" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 30
			</if>
			<if test='data_type == "40" '>
					spec.upper_region_percentile <![CDATA[<=]]> 3
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt <![CDATA[>]]> 20 
				and spec.data_type = 40
				and spec.data_cd=theme.theme_cd
			</if>
				and spec.sido_cd=substr(#{adm_cd},1,2)
				and spec.sgg_cd=substr(#{adm_cd},3,3)
				and spec.emdong_cd='00'
		</where>
		</if>
		<if test='adm_cd.length() == 2 '>
		from srv_dt_regionalspec spec
		<if test='data_type == "40" '>
			,cmm_cd_theme theme
		</if>
		<where> 
			<if test='data_type == "10" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 10
			</if>
			<if test='data_type == "20" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 20
			</if>
			<if test='data_type == "30" '>
					spec.upper_region_percentile <![CDATA[<=]]> 5
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt=0
				and spec.data_type = 30
			</if>
			<if test='data_type == "40" '>
					spec.upper_region_percentile <![CDATA[<=]]> 3
				and spec.upper_region_rate <![CDATA[>=]]> 150
				and spec.corp_cnt <![CDATA[>]]> 20 
				and spec.data_type = 40
				and spec.data_cd=theme.theme_cd
			</if>
				and spec.sido_cd=#{adm_cd}
				and spec.sgg_cd='000'
				and spec.emdong_cd='00'
		</where>
		</if>
	</select>
	
	<select id="areaevent" parameterType="hashmap" resultType="hashmap">	
		select  sido_cd||sgg_cd||emdong_cd adm_cd
				, event_no, event_nm
				, addr
				, event_start_dt
				, event_end_dt 
				, st_x(pt) x 
				, st_y(pt) y 
		from SRV_PT_EVENT
		where 
			st_contains(st_rectfromtext(#{area},0),pt) = 1
			and event_end_dt <![CDATA[>]]> sysdate
	</select>
	
	<!-- 지역별버스정류장정보 -->
	<select id="poietcbusstop" parameterType="hashmap" resultType="hashmap">	
		select tot_reg_cd
			,busstop_id
			,bis_cnter_cd
			,bis_cnter_nm
			,busstop_nm
			,st_x(pt) x
			,st_y(pt) y
		from SRV_PT_BUSSTOP_INFO
		where 
			st_contains(st_rectfromtext('rectangle(${minx} ${miny}, ${maxx} ${maxy})',0),pt) = 1
	</select>
	
	<!-- 일자별유동인구정보 -->
	<select id="poietcfloatppln" parameterType="hashmap" resultType="hashmap">	
        select flo.surv_time
            , flo.surv_dt
            <!-- 2017. 06. 27 j.h.Seok DB 표준화 작업 -->
            , flo.weekend_div as wkend_div
            , flo.surv_region
            , flo.surv_no
            , flo.tot_reg_cd
            <!-- 2017. 06. 27 j.h.Seok DB 표준화 작업 -->
            , flo.weather as wethr
            , flo.male_agegp_10_cnt
            , flo.male_agegp_20_cnt
            , flo.male_agegp_30_cnt
            , flo.male_agegp_40_cnt
            , flo.male_agegp_50_cnt
            , flo.fem_agegp_10_cnt
            , flo.fem_agegp_20_cnt
            , flo.fem_agegp_30_cnt
            , flo.fem_agegp_40_cnt
            , flo.fem_agegp_50_cnt
            <!-- 2017. 06. 27 j.h.Seok DB 표준화 작업 -->
            , flo.floating_ppltn_sum as fltppltn_sum
            , st_x(flo.pt) x
            , st_y(flo.pt) y
            , tot.adm_nm
        from SRV_PT_FLOATING_PPLTN_INFO flo, 
        			(
        				select tot_reg_cd 
		                     , a.sido_cd||a.sgg_cd||a.emdong_cd adm_cd 
		                     , b.sido_nm || ' ' || b.sgg_nm || ' ' || b.emdong_nm adm_nm 
		                     , a.base_year as year
		                 from srv_pg_totregbord a, srv_pg_admbord b
		                 where   a.base_year = #{bnd_year}
			                 and a.base_year=b.base_year 
							 and a.sido_cd=b.sido_cd
							 and a.sgg_cd=b.sgg_cd
							 and a.emdong_cd=b.emdong_cd
					) tot
        where flo.tot_reg_cd = tot.tot_reg_cd 
        	and tot.year = #{bnd_year}
            and st_contains(st_rectfromtext('rectangle(${minx} ${miny}, ${maxx} ${maxy})',0),flo.pt) = 1
        order by flo.surv_dt
	</select>
	
	<!-- 일자별유동인구정보 리스트-->
	<select id="poietcfloatlist" parameterType="hashmap" resultType="hashmap">	
		select distinct st_x(pt) x,st_y(pt) y
		from SRV_PT_FLOATING_PPLTN_INFO 
		where 
			st_contains(st_rectfromtext('rectangle(${minx} ${miny}, ${maxx} ${maxy})',0),pt) = 1
	</select>
	
	<!-- 지하철승하차정보 -->
	<select id="poietcmetroppln" parameterType="hashmap" resultType="hashmap">	
		select sido_nm, station_nm, subway_no, inout_type, x, y 
			,hour1_psn_cnt, hour2_psn_cnt, hour3_psn_cnt, hour4_psn_cnt, hour5_psn_cnt, hour6_psn_cnt
			,hour7_psn_cnt, hour8_psn_cnt, hour9_psn_cnt, hour10_psn_cnt, hour11_psn_cnt, hour12_psn_cnt
			,hour13_psn_cnt, hour14_psn_cnt, hour15_psn_cnt, hour16_psn_cnt, hour17_psn_cnt, hour18_psn_cnt
			,hour19_psn_cnt, hour20_psn_cnt, hour21_psn_cnt, hour22_psn_cnt, hour23_psn_cnt, hour24_psn_cnt
			,hour1_psn_cnt + hour2_psn_cnt + hour3_psn_cnt + hour4_psn_cnt + hour5_psn_cnt + hour6_psn_cnt 
			+ hour7_psn_cnt + hour8_psn_cnt + hour9_psn_cnt + hour10_psn_cnt + hour11_psn_cnt + hour12_psn_cnt 
			+ hour13_psn_cnt + hour14_psn_cnt + hour15_psn_cnt + hour16_psn_cnt + hour17_psn_cnt + hour18_psn_cnt 
			+ hour19_psn_cnt + hour20_psn_cnt + hour21_psn_cnt + hour22_psn_cnt + hour23_psn_cnt + hour24_psn_cnt hour_psn_sum
		from
	 		(   select sido_nm
		            ,station_nm
		            ,subway_no
		            ,inout_type
		            <!-- 2017. 06. 27 j.h.Seok DB 표준화 작업 -->
		            ,round(avg(hour_1_psn_cnt),0) hour1_psn_cnt
		            ,round(avg(hour_2_psn_cnt),0) hour2_psn_cnt
		            ,round(avg(hour_3_psn_cnt),0) hour3_psn_cnt
		            ,round(avg(hour_4_psn_cnt),0) hour4_psn_cnt
		            ,round(avg(hour_5_psn_cnt),0) hour5_psn_cnt
		            ,round(avg(hour_6_psn_cnt),0) hour6_psn_cnt
		            ,round(avg(hour_7_psn_cnt),0) hour7_psn_cnt
		            ,round(avg(hour_8_psn_cnt),0) hour8_psn_cnt
		            ,round(avg(hour_9_psn_cnt),0) hour9_psn_cnt
		            ,round(avg(hour_10_psn_cnt),0) hour10_psn_cnt
		            ,round(avg(hour_11_psn_cnt),0) hour11_psn_cnt
		            ,round(avg(hour_12_psn_cnt),0) hour12_psn_cnt
		            ,round(avg(hour_13_psn_cnt),0) hour13_psn_cnt
		            ,round(avg(hour_14_psn_cnt),0) hour14_psn_cnt
		            ,round(avg(hour_15_psn_cnt),0) hour15_psn_cnt
		            ,round(avg(hour_16_psn_cnt),0) hour16_psn_cnt
		            ,round(avg(hour_17_psn_cnt),0) hour17_psn_cnt
		            ,round(avg(hour_18_psn_cnt),0) hour18_psn_cnt
		            ,round(avg(hour_19_psn_cnt),0) hour19_psn_cnt
		            ,round(avg(hour_20_psn_cnt),0) hour20_psn_cnt
		            ,round(avg(hour_21_psn_cnt),0) hour21_psn_cnt
		            ,round(avg(hour_22_psn_cnt),0) hour22_psn_cnt
		            ,round(avg(hour_23_psn_cnt),0) hour23_psn_cnt
		            ,round(avg(hour_24_psn_cnt),0) hour24_psn_cnt
		            ,st_x(pt) x
		            ,st_y(pt) y
	        	from SRV_PT_SUBWAY_INOUT_INFO
		        where 
		            st_contains(st_rectfromtext('rectangle(${minx} ${miny}, ${maxx} ${maxy})',0),pt) = 1
		        group by sido_nm, station_nm, subway_no, inout_type, st_x(pt), st_y(pt)
			)
	</select>
	
	<!-- 지하철승하차정보 지하철역 리스트-->
	<select id="poietcmetrolist" parameterType="hashmap" resultType="String">	
	    select distinct station_nm
        from SRV_PT_SUBWAY_INOUT_INFO 
        where 
            st_contains(st_rectfromtext('rectangle(${minx} ${miny}, ${maxx} ${maxy})',0),pt) = 1
	</select>
	
	<!-- 연도별학교정보 -->
	<select id="poietcschoolppln" parameterType="hashmap" resultType="hashmap">	
		select distinct school_nm
			,sc.base_year
			,tot_reg_cd
			,sgg_nm
			<!-- 2017. 06. 27 j.h.Seok DB 표준화 작업 -->
			,schoolsystem as elsm
			,mainbranch_type
			,school_state
			<!-- 2017. 06. 27 j.h.Seok DB 표준화 작업 -->
			,edu_support_office as eduoffice
			,est_div as fond_div
			,postcd
			,sc.addr
			,tel_no
			,fax_no
			,hpage
			,stdnt_cnt
			,tcher_cnt
			,st_x(pt) x
			,st_y(pt) y
		from SRV_PT_SCHOOL_INFO sc, SRV_PG_SGGBORD sgg
		where 
			 substr(sc.tot_reg_cd, 1, 5) = (sgg.sido_cd || sgg.sgg_cd)
		and
			 st_contains(st_rectfromtext('rectangle(${minx} ${miny}, ${maxx} ${maxy})',0),pt) = 1
	</select>
	
	<!-- 업종별 밀집도 조회-테마코드별 사업체조회 -->
	<!-- <select id="poiCompanyDensity" parameterType="hashmap" resultMap="companysearchMap">
		select count(*) totalcount
			,case when TRUNC(count(*)/to_char(#{resultcount})) <![CDATA[=]]> to_char(#{pagenum}) then mod(count(*),to_char(#{resultcount}))
			  when TRUNC(count(*)/to_char(#{resultcount})) <![CDATA[>]]> to_char(#{pagenum}) then to_number(to_char(#{resultcount}))
			  when TRUNC(count(*)/to_char(#{resultcount})) <![CDATA[<]]> to_char(#{pagenum}) then 0
			end as returncount
			,to_char(#{resultcount}) as resultcount
			,to_char(#{pagenum}) as pagenum
			,to_char(#{year}) as year
			,to_char(#{srt_idx}) as srt_idx
			,to_char(#{theme_cd}) as theme_cd
			,to_char(#{bnd_year}) as bnd_year	
			,to_char(#{corp_num}) as corp_num
			,to_char(#{adm_cd}) as adm_cd	
		from srv_dt_corpcensus_${corp_num} corp
		   , cmm_cd_corpclass class
		   , cmm_cd_theme theme
		<where>		
		    and corp.ksic_5_cd=class.ksic_5_cd 
		    and class.theme_cd = theme.theme_cd
		    and corp.base_year = #{year}
		<if test='theme_cd != null '>
		    and class.theme_cd = #{theme_cd}
		</if>
		<if test='adm_cd != null '>
			and corp.adm_cd like #{adm_cd}||'%'
		</if>
		</where>
	</select>
	
	<resultMap id="companysearchMap" type="kostat.sop.ServiceAPI.api.bizStats.dto.CompanysearchMap">
		<collection property="company_list"
			column="{
						corp_num = corp_num
						, year = year
						, bnd_year = bnd_year
						, theme_cd = theme_cd
						, srt_idx = srt_idx
						, resultcount = resultcount
						, adm_cd = adm_cd
			}"
			ofType="hashmap" javaType="ArrayList" select="companysearchinfo">
		</collection>
	</resultMap> -->

	<!-- <select id="companysearchinfo" parameterType="hashmap" resultType="hashmap">
        select distinct
             corp.adm_cd
             , bd.tot_reg_cd
             , corp.ksic_1_cd || corp.ksic_5_cd class_code
             , class.ksic_5_nm class_nm
             , corp.corp_nm
             , '' AS main_nm
             , corp.employee_cnt
             , censusbd.naddr
             , censusbd.adm_nm
             , '' AS hpage
             , '' as tel_no
             , corp.sufid
             , round(st_x(bd.pt)) x
             , round(st_y(bd.pt)) y
             , theme.b_theme_cd_nm||'/'||theme.s_theme_cd_nm theme_nm
             , theme.theme_cd
        from srv_dt_corpcensus_${corp_num} corp
           , cmm_cd_corpclass class
           , cmm_cd_theme theme
           , SRV_PT_BD bd
           , SRV_PG_CENSUSBD censusbd
        <where>
            and corp.sufid = bd.sufid
            and corp.sufid = censusbd.sufid        
            and corp.ksic_5_cd=class.ksic_5_cd 
            and class.theme_cd = theme.theme_cd
            and corp.base_year= #{year}
        <if test='theme_cd != null '>
            and class.theme_cd = #{theme_cd}
        </if>
        <if test='adm_cd != null '>
			and corp.adm_cd like #{adm_cd}||'%'
		</if>
        </where>
            limit #{srt_idx}, #{resultcount}
    </select> -->
    <select id="poiCompanyDensity" parameterType="hashmap" resultMap="companysearchMap">
		select count(*) totalcount
			,case when TRUNC(count(*)/to_char(#{resultcount})) <![CDATA[=]]> to_char(#{pagenum}) then mod(count(*),to_char(#{resultcount}))
			  when TRUNC(count(*)/to_char(#{resultcount})) <![CDATA[>]]> to_char(#{pagenum}) then to_number(to_char(#{resultcount}))
			  when TRUNC(count(*)/to_char(#{resultcount})) <![CDATA[<]]> to_char(#{pagenum}) then 0
			end as returncount
			,to_char(#{resultcount}) as resultcount
			,to_char(#{pagenum}) as pagenum
			,to_char(#{year}) as year
			,to_char(#{srt_idx}) as srt_idx
			,to_char(#{theme_cd}) as theme_cd
			,to_char(#{bnd_year}) as bnd_year	
			,to_char(#{corp_num}) as corp_num
			,to_char(#{adm_cd}) as adm_cd	
		from srv_dt_corpcensus_${corp_num}
		where base_year = #{year}
			<if test='theme_cd != null '>
				and theme_cd = #{theme_cd}
			</if>
			<if test='adm_cd != null '>
				and adm_cd like #{adm_cd}||'%'
			</if>
	</select>
	
	<select id="poiCompanyDensity_Test" parameterType="hashmap" resultType="hashmap">
	<if test='data_type == "1" '>
		select count(*) As cnt
                 ,a.adm_cd as adm_cd
                 ,b.X
                 ,b.Y
          from srv_dt_corpcensus_9 a,
          	(select 
                SIDO_CD||SGG_CD||EMDONG_CD as adm_cd
                ,round(X_COOR) AS X
                ,round(Y_COOR) AS Y
                From srv_pg_admbord 
                where BASE_YEAR = #{year}) b

            where a.base_year=#{year}
          
            <if test='theme_cd != null '>
				and a.theme_cd = #{theme_cd}
			</if>
            and a.adm_cd = b.adm_cd
            Group by a.adm_cd,b.X,b.Y
	</if>
	<if test='data_type == "2" '>
			select 
				   tot.cnt
				  ,tot.tot_reg_cd as adm_cd
				  ,bord.x_coor as x
				  ,bord.y_coor as y
			from srv_pg_totregbord bord,
			(
				select 
						count(*) as cnt
						,bd.tot_reg_cd
				from srv_dt_corpcensus_9 corp, srv_pt_bd bd
				where theme_cd = #{theme_cd} and base_year = #{base_year}
				and substr(adm_cd, 1, 2) = #{sido_cd}
				and corp.sufid = bd.sufid
				group by bd.tot_reg_cd
			) tot
				where tot.tot_reg_cd = bord.tot_reg_cd
				order by tot.tot_reg_cd
	</if>
		
	</select>
	
	
	

	<resultMap id="companysearchMap" type="kostat.sop.ServiceAPI.api.bizStats.dto.CompanysearchMap">
		<collection property="company_list"
			column="{
						corp_num = corp_num
						, year = year
						, bnd_year = bnd_year
						, theme_cd = theme_cd
						, srt_idx = srt_idx
						, resultcount = resultcount
						, adm_cd = adm_cd
			}"
			ofType="hashmap" javaType="ArrayList" select="companysearchinfo">
		</collection>
	</resultMap>


	<select id="companysearchinfo" parameterType="hashmap" resultType="hashmap">
		select distinct
			 corp.adm_cd
			 , bd.tot_reg_cd
			 , corp.ksic_1_cd || corp.ksic_5_cd class_code
			 , class.ksic_5_nm class_nm
			 , corp.corp_nm
			 , '' AS main_nm
			 , corp.employee_cnt
			 , censusbd.naddr
			 , censusbd.adm_nm
			 , '' AS hpage
			 , '' as tel_no
			 , corp.sufid
			 , round(st_x(bd.pt)) x
			 , round(st_y(bd.pt)) y
			 , theme.b_theme_cd_nm||'/'||theme.s_theme_cd_nm theme_nm
			 , theme.theme_cd
		from 
			(	
				select adm_cd, ksic_1_cd, ksic_5_cd, corp_nm, employee_cnt, sufid, theme_cd
				from srv_dt_corpcensus_${corp_num}
				where base_year= #{year}
				<if test='theme_cd != null '>
					and theme_cd = #{theme_cd}
				</if>
				<if test='adm_cd != null '>
					and adm_cd like #{adm_cd}||'%'
				</if>
				limit #{srt_idx}, #{resultcount}
			) corp
		   , cmm_cd_corpclass class
		   , cmm_cd_theme theme
		   , SRV_PT_BD bd
		   , SRV_PG_CENSUSBD censusbd
		<where>
			and corp.sufid = bd.sufid
			and corp.sufid = censusbd.sufid        
			and corp.ksic_5_cd = class.ksic_5_cd 
			and corp.theme_cd = class.theme_cd
			and corp.theme_cd = theme.theme_cd
		</where>
	</select>
    
    
    <!-- 업종별 밀집도 조회-테마코드별 사업체 년도별 개수 조회 -->
	<select id="poiCompanyTimeSeries" parameterType="hashmap" resultType="hashmap">
		SELECT	corp.base_year, COUNT(*) as cnt
		FROM 	srv_dt_corpcensus_8 corp
		, 			cmm_cd_corpclass class
		, 			cmm_cd_theme theme
		WHERE	corp.ksic_5_cd = class.ksic_5_cd 
		AND 		class.theme_cd = theme.theme_cd
		AND		class.theme_cd = #{theme_cd}
		AND		corp.adm_cd like #{adm_cd}||'%'
		GROUP BY corp.base_year
		
		UNION ALL
		
		SELECT	corp.base_year, COUNT(*) as cnt
		FROM 	srv_dt_corpcensus_9 corp
		, 			cmm_cd_corpclass class
		, 			cmm_cd_theme theme
		WHERE	corp.ksic_5_cd = class.ksic_5_cd 
		AND 		class.theme_cd = theme.theme_cd
		AND		class.theme_cd = #{theme_cd}
		AND		corp.adm_cd like #{adm_cd}||'%'
		GROUP BY corp.base_year
	</select>
	
	<!-- 지역 종합정보 조회 - 총사업체, 총인구, 총가구, 총주택 조회 -->
	<select id="allCompanyPplHouse" parameterType="hashmap" resultType="hashmap">
		SELECT	(
						SELECT	COUNT(*) as corp_cnt
						FROM		SRV_DT_CORPCENSUS_9
						WHERE	adm_cd LIKE #{adm_cd}||'%'
						AND		base_year = #{base_year}
					) as corp_cnt
		,			(
						SELECT	SUM(ppltn_cnt) as ppltn_cnt
						FROM		SRV_DT_POPSREG_2010
						WHERE	tot_reg_cd LIKE #{adm_cd}||'%'
					) as ppltn_cnt
		,			(
						SELECT	SUM(family_cnt) as family_cnt
						FROM		SRV_DT_FAMILYREG_2010
						WHERE	tot_reg_cd LIKE #{adm_cd}||'%'
					) as family_cnt
		,			(
						SELECT	SUM(resid_cnt) as resid_cnt
						FROM		SRV_DT_HOUSEREG_2010
						WHERE	tot_reg_cd LIKE #{adm_cd}||'%'
						AND		house_yn = 'Y'
					) as resid_cnt
		FROM 	DUAL
	</select>
	
	<!-- 상권정보 - 선택영역 비율 -->
	<select id="tradeSelectAreaRatio" parameterType="hashmap" resultType="hashmap">
		SELECT	rstrt_cnt
		,			rstrt_per
		,			srv_corp_cnt
		,			srv_corp_per
		,			whrtlsal_corp_cnt
		,			whrtlsal_per
		,			lodge_corp_cnt
		,			lodgebiz_per
		FROM 	SRV_DT_BUSCOMMER com
		,			SRV_DT_SMALL_LIFEBIZ_STATUS stat
		WHERE	com.tradearea_id = stat.tradearea_id
		AND		com.tradearea_id = #{tradearea_id}
	</select>
	
	<!-- 상권정보 - 전국평균 비율 -->
	<select id="tradeCountryAvgRatio" parameterType="hashmap" resultType="hashmap">
		SELECT	SUM(rstrt_cnt) as rstrt_cnt
		,			SUM(srv_corp_cnt) as srv_corp_cnt
		,			SUM(whrtlsal_corp_cnt) as whrtlsal_corp_cnt
		,			SUM(lodge_corp_cnt) as lodge_corp_cnt
		FROM 	SRV_DT_BUSCOMMER com
		,			SRV_DT_SMALL_LIFEBIZ_STATUS stat
		WHERE	com.tradearea_id = stat.tradearea_id
	</select>
	
	<!-- 지역 종합정보 조회 - 주요 시설물 현황 -->
	<select id="mainFacilityList" parameterType="hashmap" resultType="hashmap">
		SELECT 	SUM(CASE WHEN theme_cd IN (7001, 7002, 7003, 7004, 7005, 7006, 7007) THEN 1 ELSE 0 END) as theme_sum_01
		,			SUM(CASE WHEN theme_cd IN (6001, 6002, 6003, 6004) THEN 1 ELSE 0 END) as theme_sum_02
		,			SUM(CASE WHEN theme_cd IN (8006, 9002) THEN 1 ELSE 0 END) as theme_sum_03
		,			SUM(CASE WHEN theme_cd IN (8007, 9003) THEN 1 ELSE 0 END) as theme_sum_04
		,			(
						SELECT	metro + bus
						FROM	
								(
									SELECT	(
													SELECT COUNT(*)
													FROM
															(
																SELECT	distinct station_nm
																FROM 	SRV_PT_SUBWAY_INOUT_INFO 
																WHERE	st_contains(ST_BUFFER(st_pointfromtext(#{area},0),#{round}),pt) = 1
															)
												)  as metro
									,			(		
													SELECT COUNT(*)
													FROM
														(
															SELECT	distinct busstop_nm
															FROM 	SRV_PT_BUSSTOP_INFO 
															WHERE	tot_reg_cd LIKE #{adm_cd}||'%'
														)						
												) as bus		
									FROM DUAL
								)
					) as theme_sum_05
		,			SUM(CASE WHEN theme_cd IN (6003, 6004) THEN 1 ELSE 0 END) as theme_sum_06
		,			SUM(CASE WHEN theme_cd IN (9001) THEN 1 ELSE 0 END) as theme_sum_07
		,			SUM(CASE WHEN theme_cd IN (2003) THEN 1 ELSE 0 END) as theme_sum_08
		,			SUM(CASE WHEN theme_cd IN (9004) THEN 1 ELSE 0 END) as theme_sum_09
		,			SUM(CASE WHEN theme_cd IN (9005) THEN 1 ELSE 0 END) as theme_sum_10
		FROM 	SRV_DT_CORPCENSUS_9 corp, SRV_PT_BD bd
		WHERE 	bd.sufid = corp.sufid
		AND		corp.base_year = #{base_year}
		AND		bd.tot_reg_cd LIKE #{adm_cd}||'%'
	</select>
	
	<select id="getAllSggCorpCnt" parameterType="hashmap" resultType="hashmap">
		SELECT 
			tech.sido_cd, 
			tech.sgg_cd, 
			tech.corp_cnt as techbiz_corp_cnt, 
			ROUND(TO_FLOAT(bord.x_coor)) x_coor, 
			ROUND(TO_FLOAT(bord.y_coor)) y_coor,  
			TRIM(bord.sido_nm) sido_nm, 
			TRIM(bord.sgg_nm) sgg_nm
		FROM 
			(SELECT 
				sido_cd, 
				sgg_cd, 
				sum(corp_cnt) as corp_cnt
			 FROM SRV_DT_TECHBIZ_CORPSGG
			 WHERE base_year = #{base_year} AND techbiz_b_class_cd !='0' 
			 GROUP BY sido_cd, sgg_cd) tech, SRV_PG_SGGBORD bord
		WHERE bord.base_year = #{bnd_year} 
		AND tech.sido_cd = bord.sido_cd 
		AND tech.sgg_cd = bord.sgg_cd
	</select>
	
	<select id="getPoiCompanyDensity" parameterType="hashmap" resultType="hashmap">
		<if test='data_type == "1" '>
        	select 
					nvl(corp.cnt, 0) as cnt
				,	bord.adm_cd
				,	bord.X
				,	bord.Y
			from
				(
					select 
						SIDO_CD||SGG_CD||EMDONG_CD as adm_cd
						,round(X_COOR) AS X
						,round(Y_COOR) AS Y
					From 
						srv_pg_admbord 
					where 
						BASE_YEAR = #{bnd_year}
				) bord
			inner join
				(
					select 
						sum(corp_cnt) as cnt
					,	substr(tot_reg_cd, 1, 7) as adm_cd
					from 
						srv_dt_techbiz_corpreg
					where
						base_year = #{year}
					<if test='theme_cd != null and theme_cd != "00" '>
						<if test='theme_cd.length() == 2'>
							and techbiz_m_class_cd = #{theme_cd}
						</if>
						<if test='theme_cd.length() == 3'>
							and techbiz_s_class_cd = #{theme_cd}
						</if>
					</if>
					group by substr(tot_reg_cd, 1, 7)
				) corp
			on bord.adm_cd = corp.adm_cd and corp.cnt > 0;
            
	</if>
	<if test='data_type == "2" '>
			select 
					nvl(corp.cnt, 0) as cnt
				,	bord.adm_cd
				,	bord.X
				,	bord.Y
			from
				(
					select 
						tot_reg_cd as adm_cd
						,round(X_COOR) AS X
						,round(Y_COOR) AS Y
					From 
						srv_pg_totregbord 
					where 
						BASE_YEAR = #{bnd_year}
				) bord
			inner join
				(
					select 
						sum(corp_cnt) as cnt
					,	tot_reg_cd as adm_cd
					from 
						srv_dt_techbiz_corpreg
					where
						base_year = #{year}
					<if test='theme_cd != null and theme_cd != "00" '>
						<if test='theme_cd.length() == 2'>
							and techbiz_m_class_cd = #{theme_cd}
						</if>
						<if test='theme_cd.length() == 3'>
							and techbiz_s_class_cd = #{theme_cd}
						</if>
					</if>
					and substr(tot_reg_cd,1,2) = #{adm_cd}
					group by tot_reg_cd
				) corp
			on bord.adm_cd = corp.adm_cd and corp.cnt > 0;
	</if>
	
	<if test='data_type=="3"'>
	<!-- 8,9차 사업체 센서스 기술업종테마코드 추가되면 그때 작업 -->
		 <!-- 2018.01.15 [개발팀] 상용과 쿼리가 달라서 상용기준으로 수정 -->
          select distinct
                 a.corp_nm as corp_nm
                 ,c.naddr as naddr
                 ,a.adm_cd as adm_cd
                 ,a.sufid as sufid
				 ,'' as  theme_nm
                 ,a.techbiz_s_class_cd as theme_cd
                 ,b.X
                 ,b.Y
          from  srv_dt_corpcensus_9 a,
            (select 
                 sufid
                , round(st_x(pt)) AS X
                , round(st_y(pt)) AS Y
                
                From srv_pt_bd
                where tot_reg_cd like #{adm_cd}||'%'
                ) b,
                 SRV_PG_CENSUSBD c

            where a.base_year=#{year}
            
            <if test='theme_cd != null and theme_cd != "00" '>
				<if test='theme_cd.length() == 2'>
					and techbiz_s_class_cd like #{theme_cd}||'%'
				</if>
				<if test='theme_cd.length() == 3'>
					and techbiz_s_class_cd = #{theme_cd}
				</if>
			</if>
            and a.sufid = b.sufid
            and a.sufid = c.sufid
	    and a.techbiz_s_class_cd is not null     
	</if>
	<if test='data_type == "4" '>
			select 
					nvl(corp.cnt, 0) as cnt
				,	bord.adm_cd
				,	bord.X
				,	bord.Y
			from
				(
					select 
						tot_reg_cd as adm_cd
						,round(X_COOR) AS X
						,round(Y_COOR) AS Y
					From 
						srv_pg_totregbord 
					where 
						BASE_YEAR = #{bnd_year}
				) bord
			inner join
				(
					select 
						sum(corp_cnt) as cnt
					,	tot_reg_cd as adm_cd
					from 
						srv_dt_techbiz_corpreg
					where
						base_year = #{year}
					<if test='theme_cd != null and theme_cd != "00" '>
						<if test='theme_cd.length() == 2'>
							and techbiz_m_class_cd = #{theme_cd}
						</if>
						<if test='theme_cd.length() == 3'>
							and techbiz_s_class_cd = #{theme_cd}
						</if>
					</if>
					and substr(tot_reg_cd,1,4) = #{adm_cd}
					group by tot_reg_cd
				) corp
			on bord.adm_cd = corp.adm_cd and corp.cnt > 0;
	</if>
	</select>
	
<!-- ================================================================= -->
	<!-- [지원시설] 지역통계 현황 -->
	<select id="selectAreaStateBarChart" parameterType="hashmap" resultType="hashmap">
		(
			SELECT '00' AS sido_cd, '전국평균' AS sido_nm, AVG(corp_cnt) AS corp_cnt, AVG(worker_cnt) AS worker_cnt
			FROM 
				(
				select a.sido_cd, a.sido_Nm, isnull(b.corp_cnt, 0) AS corp_cnt, isnull(b.worker_cnt, 0) AS worker_cnt
				from 
					(
						SELECT sido_cd, sido_nm 
						FROM SRV_PG_SIDOBORD
<!-- 						WHERE base_year = #{base_year} -->
						WHERE base_year = #{bnd_year}
					) a 
					LEFT JOIN 
					(	
						SELECT trim(adm_cd) as adm_cd, base_year, SUM(corp_cnt) AS corp_cnt, SUM(worker_cnt) AS worker_cnt
						FROM SRV_DT_TECHBIZ_CHARTRINFO
						WHERE region_div = '1'
						AND techbiz_cd_div = '1'
						AND base_year = #{year}
<!-- 						AND base_year = #{base_year} -->
						GROUP BY trim(adm_cd), base_year
					) b
					on a.sido_cd = b.adm_cd
				)
		)		
		UNION
		(		
			SELECT a.sido_cd, a.sido_nm, ISNULL(b.corp_cnt, 0) AS corp_cnt, ISNULL(b.worker_cnt, 0) AS worker_cnt
			FROM 
				(
					SELECT sido_cd, sido_nm 
					FROM SRV_PG_SIDOBORD
<!-- 						WHERE base_year = #{base_year} -->
					WHERE base_year = #{bnd_year}
				) a 
				LEFT JOIN 
				(	
					SELECT trim(adm_cd) as adm_cd, base_year, SUM(corp_cnt) AS corp_cnt, SUM(worker_cnt) AS worker_cnt
					FROM SRV_DT_TECHBIZ_CHARTRINFO
					WHERE region_div = '1'
					AND techbiz_cd_div = '1'
					AND base_year = #{year}
<!-- 					AND base_year = #{base_year} -->
					GROUP BY trim(adm_cd), base_year
				) b
				ON a.sido_cd = b.adm_cd
		)
	</select>
	
	<!-- [지원시설] 주요 지원시설 현황 -->
	<select id="selectMajorFacilityBarChart" parameterType="hashmap" resultType="hashmap">

	SELECT
			ISNULL(SUM(CASE WHEN theme_cd IN (6001, 6002, 6003, 6004) THEN corp_cnt ELSE 0 END), 0) AS theme_sum_01 ,
			<!-- 2017.09.13 개발팀 수정 속도문제 -->
			<!-- ( SELECT metro + bus  --> 
<!-- 				FROM (  --> 
<!-- 						SELECT (  --> 
<!-- 								SELECT COUNT(*)  --> 
<!-- 								FROM (  --> 
<!-- 											SELECT DISTINCT station_nm --> 
<!-- 											FROM SRV_PG_TOTREGBORD a --> 
<!-- 													, (  --> 
<!-- 															SELECT 	distinct sido_nm, station_nm , pt --> 
<!-- 															FROM 	SRV_PT_SUBWAY_INOUT_INFO  --> 
<!-- 														) b --> 
<!-- 											WHERE base_year = #{bnd_year} --> 
<!-- 											 <if test='adm_cd.length() == 2'> --> 
<!-- 											 	AND sido_cd = SUBSTR(#{adm_cd},1,2) --> 
<!-- 											</if> --> 
<!-- 											<if test='adm_cd.length() == 5'> --> 
<!-- 												AND sido_cd = SUBSTR(#{adm_cd},1,2) --> 
<!-- 												<if test='adm_cd == "31020"'> --> 
<!-- 													AND sgg_cd like SUBSTR(#{adm_cd},3,2) || '%' --> 
<!-- 												</if> --> 
<!-- 												<if test='adm_cd != "31020"'> --> 
<!-- 													AND sgg_cd = SUBSTR(#{adm_cd},3,3) --> 
<!-- 												</if> --> 
<!-- 											</if> --> 
<!-- 											AND ST_CONTAINS(bord, pt) = 1 --> 
<!-- 										) --> 
<!-- 									) as metro , --> 
<!-- 									(  --> 
<!-- 										SELECT COUNT(*)  --> 
<!-- 										FROM (  --> 
<!-- 												SELECT busstop_nm  --> 
<!-- 												FROM SRV_PT_BUSSTOP_INFO  --> 
<!-- 												WHERE tot_reg_cd IN ( --> 
<!-- 																			SELECT tot_reg_cd  --> 
<!-- 																			FROM SRV_PG_TOTREGBORD  --> 
<!-- 																			WHERE base_year = #{bnd_year} --> 
<!-- 	 																		<if test='adm_cd.length() == 2'> --> 
<!-- 																			 	AND sido_cd = SUBSTR(#{adm_cd},1,2) --> 
<!-- 																			</if> --> 
<!-- 																			<if test='adm_cd.length() == 5'> --> 
<!-- 																				AND sido_cd = SUBSTR(#{adm_cd},1,2) --> 
<!-- 																				<if test='adm_cd == "31020"'> --> 
<!-- 																					AND sgg_cd like SUBSTR(#{adm_cd},3,2) || '%' --> 
<!-- 																				</if> --> 
<!-- 																			 	<if test='adm_cd != "31020"'> --> 
<!-- 																			 		AND sgg_cd = SUBSTR(#{adm_cd},3,3) --> 
<!-- 																			 	</if> --> 
<!-- 																			</if> --> 
<!-- 																			) --> 
<!--  --> 
<!-- 											) --> 
<!-- 									) as bus --> 
<!-- 						FROM DUAL --> 
<!-- 					) -->
<!--		) AS theme_sum_02, -->		
			ISNULL(SUM(CASE WHEN theme_cd IN (9002) THEN corp_cnt ELSE 0 END), 0) AS theme_sum_03,		
			ISNULL(SUM(CASE WHEN theme_cd IN (7004, 7005, 7006) THEN corp_cnt ELSE 0 END), 0) AS theme_sum_04,  
			(
				SELECT COUNT(*)
				FROM SRV_DT_TECHBIZ_STARTUPBIZFAC
				 
					WHERE sido_cd = SUBSTR(#{adm_cd},1,2)
				 
				 
			) AS theme_sum_05		
		
		FROM srv_dt_corpthemereg where base_year = #{year} 
		and tot_reg_cd IN (
								SELECT tot_reg_cd 
								FROM SRV_PG_TOTREGBORD 
								WHERE base_year = #{bnd_year}
								<if test='adm_cd.length() == 2'>
									AND sido_cd = SUBSTR(#{adm_cd},1,2)
								</if>
								<if test='adm_cd.length() == 5'>
									AND sido_cd = SUBSTR(#{adm_cd},1,2)
									<if test='adm_cd == "32020"'>
										AND sgg_cd like SUBSTR(#{adm_cd},3,2) || '%'
									</if>
									<if test='adm_cd != "32020"'>
										AND sgg_cd = SUBSTR(#{adm_cd},3,3)
									</if>
								</if>
								)
	</select>
	
	<!-- [지원시설, 산업단지] 지역 종합 통계 정보 상단 데이터 -->
	<select id="selectAreaStateTitleData" parameterType="hashmap" resultType="hashmap">	
		SELECT
		(
			SELECT SUM(resid_ppltn_cnt) 
			FROM srv_dt_techbiz_ppltn_sgg
 			WHERE base_year = #{year}
			<if test='adm_cd.length() == 2'>
				AND sido_cd = #{adm_cd}
			</if>
			<if test='adm_cd.length() == 5'>
				AND sido_cd = SUBSTR(#{adm_cd},1,2)
				AND sgg_cd = SUBSTR(#{adm_cd},3,3)
			</if>
		) AS resid_ppltn_cnt 		<!-- 시군구 별 거주인구수 -->
		, (
			SELECT COUNT(*) AS supply_cnt
			FROM srv_dt_techbiz_startupbizfac
 			WHERE 
 			<if test='adm_cd.length() == 2'>
				sido_cd = #{adm_cd}
			</if>
			<if test='adm_cd.length() == 5'>
				sido_cd = SUBSTR(#{adm_cd},1,2)
				AND sgg_cd = SUBSTR(#{adm_cd},3,3)
			</if>
		) AS supply_cnt			<!-- 시군구 별 창업시설 수 -->
		, (
			SELECT COUNT(*) AS industry_cnt
			FROM srv_dt_techbiz_induscominfo
 			WHERE 
 			<if test='adm_cd.length() == 2'>
				sido_cd = #{adm_cd}
			</if>
			<if test='adm_cd.length() == 5'>
				sido_cd = SUBSTR(#{adm_cd},1,2)
				AND sgg_cd = SUBSTR(#{adm_cd},3,3)
			</if>
		) AS industry_cnt		<!-- 시군구 별 산업단지 수 -->
		FROM DUAL
		
		
		
		
		
	</select>
	
	<!-- 기술업종별 사업체/종사자 수&비율 -->
	<select id="selectTechnicalBizCntBarChartAndPercentPieChart"  parameterType="hashmap" resultType="hashmap">	
		SELECT
				TB1.techbiz_m_class_cd_nm 
				, TB1.techbiz_s_class_cd
				, TB1.techbiz_s_class_cd_nm
				, TB1.base_year
				, ISNULL(TB1.corp_cnt, 0) AS corp_cnt			
				, ISNULL(TB1.corp_per, 0) AS corp_per		
				, ISNULL(TB1.worker_per, 0) AS worker_per	
				, ISNULL(TB1.worker_cnt, 0) AS worker_cnt
				, ISNULL(TB2.corp_cnt, 0) AS upper_corp_cnt			
				, ISNULL(TB2.corp_per, 0) AS upper_corp_per		
				, ISNULL(TB2.worker_per, 0) AS upper_worker_per	
				, ISNULL(TB2.worker_cnt, 0) AS upper_worker_cnt				
		FROM
			(
			
				<if test='techbiz_class_cd != "00"'>
					SELECT 
						b.region_div
						, trim(b.adm_cd)
						, b.techbiz_cd_div
						, a.techbiz_m_class_cd_nm
						, a.techbiz_s_class_cd
						, a.techbiz_s_class_cd_nm
						, b.base_year
						, b.corp_cnt
						, b.corp_per
						, b.corp_irdsrate
						, b.worker_irdsrate
						, b.worker_per
						, b.worker_cnt
					FROM CMM_CD_TECHBIZ_CD a
							LEFT JOIN SRV_DT_TECHBIZ_CHARTRINFO b 
								ON a.techbiz_s_class_cd = b.techbiz_class_cd
								<if test='adm_cd.length() == 2'>
									AND b.region_div = '1'
								</if>
								<if test='adm_cd.length() == 5'>
									AND b.region_div = '2'
								</if>
								AND b.techbiz_cd_div = '3'
	 							AND b.base_year = #{year}
	 							AND trim(b.adm_cd) = #{adm_cd}
	 							
	 				WHERE a.techbiz_m_class_cd = #{techbiz_class_cd}	
	 			</if>
	 			<if test='techbiz_class_cd == "00"'>
	 				SELECT 
	 						b.region_div
							, trim(b.adm_cd)
							, b.techbiz_cd_div
							, a.techbiz_m_class_cd_nm
							, a.techbiz_m_class_cd as techbiz_s_class_cd
							, a.techbiz_m_class_cd_nm as techbiz_s_class_cd_nm
							, b.base_year
							, b.corp_cnt
							, b.corp_per
							, b.corp_irdsrate
							, b.worker_irdsrate
							, b.worker_per
							, b.worker_cnt
	 				 FROM SRV_DT_TECHBIZ_CHARTRINFO b,
					(
						SELECT techbiz_m_class_cd, 
							   techbiz_m_class_cd_nm 
						FROM   cmm_cd_techbiz_cd 
						GROUP BY techbiz_m_class_cd, techbiz_m_class_cd_nm
					) a
					WHERE   
						<if test='adm_cd.length() == 2'>
							b.region_div = '1'
						</if>
						<if test='adm_cd.length() == 5'>
							b.region_div = '2'
						</if>
					
						AND b.techbiz_cd_div = '2'
						AND b.base_year = #{year} 
						AND trim(b.adm_cd) = #{adm_cd} 
						AND A.techbiz_m_class_cd = b.techbiz_class_cd
	 			</if>			
				
			) TB1
			LEFT JOIN 
			(
				<if test='techbiz_class_cd != "00"'>
					SELECT 
							b.region_div
							, trim(b.adm_cd)
							, b.techbiz_cd_div
							, a.techbiz_m_class_cd_nm
							, a.techbiz_s_class_cd
							, a.techbiz_s_class_cd_nm
							, b.base_year
							, b.corp_cnt
							, b.corp_per
							, b.corp_irdsrate
							, b.worker_irdsrate
							, b.worker_per
							, b.worker_cnt
					FROM CMM_CD_TECHBIZ_CD a
							LEFT JOIN SRV_DT_TECHBIZ_CHARTRINFO b 
								ON a.techbiz_s_class_cd = b.techbiz_class_cd
								    <if test='adm_cd.length() == 2'>
								    	AND b.region_div = '0'
								    	AND trim(b.adm_cd) = '00'
								    </if>
								    <if test='adm_cd.length() == 5'>
								    	AND b.region_div = '1'
								    	AND trim(b.adm_cd) = SUBSTR(#{adm_cd},1,2)
								    </if>
								    <if test='adm_cd.length() == 7'>
								    	AND b.region_div = '2'
								    	AND trim(b.adm_cd) = SUBSTR(#{adm_cd},1,5)
								    </if>
									AND b.techbiz_cd_div = '3'
									AND b.base_year = #{year}  							
	 																
					WHERE a.techbiz_m_class_cd = #{techbiz_class_cd}
				</if>
				<if test='techbiz_class_cd == "00"'>
					SELECT 
	 						b.region_div
							, trim(b.adm_cd)
							, b.techbiz_cd_div
							, a.techbiz_m_class_cd_nm
							, a.techbiz_m_class_cd as techbiz_s_class_cd
							, a.techbiz_m_class_cd_nm as techbiz_s_class_cd_nm
							, b.base_year
							, b.corp_cnt
							, b.corp_per
							, b.corp_irdsrate
							, b.worker_irdsrate
							, b.worker_per
							, b.worker_cnt
	 				 FROM SRV_DT_TECHBIZ_CHARTRINFO b,
					(
						SELECT techbiz_m_class_cd, 
							   techbiz_m_class_cd_nm 
						FROM   cmm_cd_techbiz_cd 
						GROUP BY techbiz_m_class_cd, techbiz_m_class_cd_nm
					) a
					WHERE   
						<if test='adm_cd.length() == 2'>
							b.region_div = '0'
							AND trim(b.adm_cd) = '00'
						</if>
						<if test='adm_cd.length() == 5'>
							b.region_div = '1'
							AND trim(b.adm_cd) = SUBSTR(#{adm_cd},1,2)
						</if>
						<if test='adm_cd.length() == 7'>
							b.region_div = '2'
							AND trim(b.adm_cd) = SUBSTR(#{adm_cd},1,5)
						</if>
					
						AND b.techbiz_cd_div = '2'
						AND b.base_year = #{year} 
						AND A.techbiz_m_class_cd = b.techbiz_class_cd
	 			</if>			
				
			) TB2
			ON TB1.techbiz_s_class_cd = TB2.techbiz_s_class_cd
				
	</select>	
		
	<!-- 기술업종별 사업체/종사자 증감 -->
	<select id="selectTechnicalBizVariateLineChart"  parameterType="hashmap" resultType="hashmap">
		SELECT
			   base_year,
			   techbiz_class_cd,
			   corp_cnt,
			   corp_irdsrate,
			   worker_irdsrate,
			   worker_cnt,
			   TRIM(adm_cd) as adm_cd
		FROM srv_dt_techbiz_chartrinfo
		WHERE 
			  <if test='adm_cd.length() == 2'>
			  	region_div = '1'
			  </if>
			  <if test='adm_cd.length() == 5'>
			  	region_div = '2'
			  </if>
			  <if test='adm_cd.length() == 7'>
			  	region_div = '3'
			  </if>
			  <if test='techbiz_class_cd != "00"'>
			  	and techbiz_class_cd = #{techbiz_class_cd}
	 		  	and techbiz_cd_div = #{techbiz_cd_div} 
			  </if>
			  <if test='techbiz_class_cd == "00"'>
			  	and techbiz_class_cd = '0'
	 		  	and techbiz_cd_div = '0'
			  </if>
			  
	 		  and trim(adm_cd) = #{adm_cd} 
	 		  
	    ORDER BY base_year ASC;
	</select>	
	
	<!-- [산업단지] 산업단지 명 -->
	<select id="selectComplexNm"  parameterType="hashmap" resultType="hashmap">
		SELECT complex_nm 
		FROM SRV_PG_TECHBIZ_INDUSCOMBORD 
		WHERE complex_no = '111011'
<!-- 		WHERE complex_no = #{complex_no} -->
	</select>
	
	
	<!-- [산업단지] 산업단지 내 기술업종 증감현황 -->
	<select id="selectIndustryVariationStateLineChart"  parameterType="hashmap" resultType="hashmap">
		SELECT complex_no, base_year, corp_cnt, worker_cnt 
		FROM SRV_DT_TECHBIZ_INDUSCOMCHANGE
		WHERE complex_no = #{complex_no}
	</select>
	
	<!-- [산업단지] 산업단지 내 기술업종 분포현황 -->
	<select id="selectIndustryDistributionStateRadialShapeChart"  parameterType="hashmap" resultType="hashmap">
		SELECT 
				complex_no, 
				base_year, 
				complex_type, 
				high_tech, 
				mid_tech, 
				low_tech, 
				uptode_tech, 
				nvl(ict, 0) as ict, 
				orgidea_dgtl, 
				spclty_srv
		FROM SRV_DT_TECHBIZ_INDUSCOMTOTAL
		WHERE complex_no = #{complex_no}
	</select>
	
	<!-- [산업단지] 산업단지 내 기술업종 상세현황 -->
	<select id="selectIndustryDetailStateBarChart"  parameterType="hashmap" resultType="hashmap">
		SELECT 
			 a.techbiz_s_class_cd
			, b.techbiz_s_class_cd_nm
			, a.corp_cnt
			, a.corp_avg_cnt as corp_avg
		FROM SRV_DT_TECHBIZ_INDUSCOMDETAIL a
					LEFT JOIN CMM_CD_TECHBIZ_CD b 
						ON a.techbiz_s_class_cd = b.techbiz_s_class_cd
		WHERE a.complex_no = #{complex_no}
 		AND	a.techbiz_m_class_cd = #{techbiz_m_class_cd}
	</select>
	
	<!-- [산업단지] 산업단지 내 주요시설 현황 -->
	<select id="selectIndustryImportantFacilityStateBarChart"  parameterType="hashmap" resultType="hashmap">
		(
			SELECT 'cnt' AS type
					, pub_inst
					, transport_fac
					, fnnc_inst
					, univ
					, found_support_fac 
			FROM srv_dt_techbiz_induscom_facstat
			WHERE complex_no = #{complex_no}	
		)
		UNION
		(
			SELECT 'avgCnt' AS type
					, avg(pub_inst) as pub_inst
					, avg(transport_fac) AS transport_fac
					, avg(fnnc_inst) AS fnnc_inst
					, avg(univ) AS univ
					, avg(found_support_fac) AS found_support_fac
			FROM srv_dt_techbiz_induscom_facstat
		)
	</select>
	
	<select id="selectCompanyCntPerWorkerCnt" parameterType="hashmap" resultType="hashmap">
		SELECT 
				sum(a.corp_cnt) as corp_cnt,
       			sum(a.worker_cnt) as worker_cnt,
	   			TRIM(a.adm_cd),
	   			TRIM(bord.sido_nm)
		FROM srv_dt_techbiz_chartrinfo a, srv_pg_sidobord bord
		WHERE a.region_div='1' and a.techbiz_cd_div='1' and a.base_year = #{year} and trim(a.adm_cd) = bord.sido_cd and bord.base_year=#{bnd_year}
		GROUP BY trim(a.adm_cd), a.region_div, a.techbiz_cd_div, bord.sido_nm
	</select>
	
	<select id="selectSupplyRegionInfo" parameterType="hashmap" resultType="hashmap">
		<if test='type == "1"'>
			SELECT sum(a.corp_cnt) as corp_cnt, 
			       sum(a.worker_cnt) as worker_cnt, 
			       TRIM(a.adm_cd) as adm_cd,
			       bord.sido_nm as adm_nm
			FROM  root.srv_dt_techbiz_chartrinfo a, srv_pg_sidobord bord
			WHERE
				a.techbiz_cd_div='1' 
				and a.region_div='1'
				and trim(a.adm_cd) = bord.sido_cd
				and bord.base_year=#{bnd_year}
				and a.base_year=#{year} 
			GROUP BY trim(adm_cd), bord.sido_nm
		</if>
		<if test='type == "2"'>
			SELECT sum(a.corp_cnt) as corp_cnt, 
			       sum(a.worker_cnt) as worker_cnt, 
			       TRIM(a.adm_cd) as adm_cd,
			       bord.addr as adm_nm
			FROM  root.srv_dt_techbiz_chartrinfo a, srv_pg_sggbord bord
			WHERE
				<if test='techbiz_class_cd != "undefined"'>
					a.techbiz_cd_div='2'
					and techbiz_class_cd = #{techbiz_class_cd}
				</if> 
				<if test='techbiz_class_cd == "undefined"'>
					a.techbiz_cd_div='1' 
				</if>
				
				and a.region_div='2'
				and SUBSTR(a.adm_cd,1,2) = bord.sido_cd 
				and SUBSTR(a.adm_cd,3,3) = bord.sgg_cd
				and bord.base_year=#{bnd_year}
				and a.base_year=#{year} and trim(a.adm_cd) like #{adm_cd} ||'%' 
			GROUP BY trim(adm_cd), bord.addr
		</if>
		<if test='type == "3"'>
			SELECT sum(a.corp_cnt) as corp_cnt, 
				   sum(a.worker_cnt) as worker_cnt, 
				   TRIM(a.adm_cd) as adm_cd,
				   bord.addr as adm_nm
			FROM  root.srv_dt_techbiz_chartrinfo a, srv_pg_admbord bord
			WHERE
					<if test='techbiz_class_cd != "undefined"'>
						a.techbiz_cd_div='2'
						and techbiz_class_cd = #{techbiz_class_cd}
					</if> 
					<if test='techbiz_class_cd == "undefined"'>
						a.techbiz_cd_div='1' 
					</if>
					and a.region_div='3'
					and SUBSTR(a.adm_cd,1,2) = bord.sido_cd 
					and SUBSTR(a.adm_cd,3,3) = bord.sgg_cd
					and SUBSTR(a.adm_cd,6,2) = bord.emdong_cd
					and bord.base_year=#{bnd_year}
					and a.base_year=#{year} and trim(a.adm_cd) like #{adm_cd} ||'%' 
			GROUP BY trim(a.adm_cd), bord.addr
		</if>
		<if test='type == "4"'>
			SELECT sum(a.corp_cnt) as corp_cnt, 
			       sum(a.worker_cnt) as worker_cnt, 
			       TRIM(a.adm_cd) as adm_cd,
			       bord.sgg_nm as adm_nm
			FROM  root.srv_dt_techbiz_chartrinfo a, srv_pg_sggbord bord
			WHERE
				a.techbiz_cd_div='1' 
				and a.region_div='2'
				and substr(a.adm_cd,1,2) = bord.sido_cd
				and substr(a.adm_cd,3,3) = bord.sgg_cd
				and substr(a.adm_cd,1,4) = #{adm_cd}
				and bord.base_year=#{bnd_year}
				and a.base_year=#{year}
			GROUP BY adm_cd, bord.sgg_nm
		</if>
	</select>
	
	<!-- 지역별 기술업종 사업체/종사자수 조회 -->
	<select id="selectRegionCorpWorkerInfo" parameterType="hashmap" resultType="hashmap">
		SELECT sum(corp_cnt) as corp_cnt, 
			   sum(worker_cnt) as worker_cnt
		FROM srv_dt_techbiz_chartrinfo
		WHERE base_year = #{year}
		<if test='adm_cd.length() == 2'>
			and region_div='1'
		</if>
		<if test='adm_cd.length() == 5'>
			and region_div='2'
		</if>
		and techbiz_cd_div='1' and trim(adm_cd) = #{adm_cd} 
		GROUP BY adm_cd
	</select>
	
	<!-- 지역별 기술업종정보 -->
	<select id="selectTechInfo" parameterType="hashmap" resultType="hashmap">
		SELECT 

			   	   techbiz_class_cd,
				   corp_cnt,
				   corp_per,
				   corp_irdsrate,
				   worker_irdsrate,
				   worker_per,
				   worker_cnt,
				   TRIM(adm_cd) as adm_cd,
				   <if test='adm_cd.length() == 2'>
			  			(SELECT COUNT(sido_cd) FROM srv_pg_sidobord WHERE base_year=#{bnd_year}) as region_cnt 
			  	   </if>
			 	   <if test='adm_cd.length() == 5'>
			  			(SELECT COUNT(sido_cd) FROM  root.srv_pg_sggbord WHERE base_year=#{bnd_year} and TRIM(sido_cd)=SUBSTR(#{adm_cd},1,2)) as region_cnt 
			       </if>
			  	   <if test='adm_cd.length() == 7'>
			  		   (SELECT COUNT(sido_cd) FROM  root.srv_pg_totregbord WHERE base_year=#{bnd_year} and TRIM(sido_cd)=SUBSTR(#{adm_cd},1,2) and TRIM(sgg_cd)=SUBSTR(#{adm_cd},3,3)) as region_cnt
			  	   </if>
   
		FROM srv_dt_techbiz_chartrinfo
		WHERE base_year = #{year}
			  <if test='adm_cd.length() == 2'>
			  	and region_div = '1'
			  </if>
			  <if test='adm_cd.length() == 5'>
			  	and region_div = '2'
			  </if>
			  <if test='adm_cd.length() == 7'>
			  	and region_div = '3'
			  </if>
	 		 	and trim(adm_cd) = #{adm_cd} 
	 		  <if test='techbiz_class_cd == "00"'>
	 		   	and techbiz_cd_div = '0' 
	 		  </if>
	 		  <if test='techbiz_class_cd != "00"'>
	 		  	and techbiz_cd_div = #{techbiz_cd_div} 
	 		  	and techbiz_class_cd = #{techbiz_class_cd}
	 		  </if>
	 		 
	</select>
	
	<select id="selectIndustryBoundary" parameterType="hashmap" resultType="hashmap">
		SELECT 
				complex_no,
				complex_nm,
				complex_type,
				x_coor,
				y_coor,
				area,
				st_asbinary(bord) geometry
		FROM    srv_pg_techbiz_induscombord
		WHERE   complex_no = #{complex_no}
	</select>
	
	<select id="selectNewCorpInfoList" parameterType="hashmap" resultType="hashmap">
		<if test='adm_cd == "31020"'>
			SELECT count(corp_serial) as corp_cnt, 
				   sido_cd||sgg_cd as adm_cd  
		    FROM  root.srv_dt_techbiz_newcorpinfo 
		    WHERE sido_cd = SUBSTR(#{adm_cd},1,2) 
		    	  and sgg_cd like SUBSTR(#{adm_cd},3,2) || '%' 
		    	  and base_year = #{year} 
		    GROUP BY sido_cd, sgg_cd
		</if>
		<if test='adm_cd != "31020"'>
			SELECT count(corp_serial) as corp_cnt, 
			   sido_cd||sgg_cd||emdong_cd as adm_cd  
		    FROM  root.srv_dt_techbiz_newcorpinfo 
		    WHERE sido_cd = SUBSTR(#{adm_cd},1,2) 
		    	  and sgg_cd = SUBSTR(#{adm_cd},3,3) 
		    	  and base_year = #{year} 
		    GROUP BY sido_cd, sgg_cd, emdong_cd
		</if>
		
	</select>
	
	<select id="selectCorpInfoTimeSeries" parameterType="hashmap" resultType="hashmap">
		SELECT 
				sum(corp_cnt) as corp_cnt,
				base_year
		FROM srv_dt_techbiz_chartrinfo
		WHERE 
			<if test='adm_cd.length() == 2'>
				region_div='1'
			</if>
			<if test='adm_cd.length() == 5'>
				region_div='2'
			</if>
			<if test='adm_cd.length() == 7'>
				region_div='3'
			</if>
			and techbiz_cd_div='1' and trim(adm_cd) = #{adm_cd} 
		GROUP BY base_year
	</select>
	
	<!-- 산업단지 내 지원시설정보 -->
	<select id="selectSupplyPoiInIndustry" parameterType="hashmap" resultType="hashmap">
		SELECT 
				fac.inst_serial,
				fac.sido_cd,
				fac.sgg_cd,
				fac.complex_no,
				fac.inst_nm,
				fac.lct_type,
				CMM.cd_content as lct_type_nm,
				fac.addr,
				fac.tel_no,
				fac.url,
				fac.x_coor,
				fac.y_coor
		FROM srv_dt_techbiz_startupbizfac fac
		LEFT OUTER JOIN CMM_CD_ONE CMM 
			ON fac.lct_type = CMM.cd_value_1
		WHERE CMM.cd_nm = '창업지원시설입지유형' AND fac.complex_no= #{complex_no}
	</select>
	
	<select id="selectSggCompanyMapInfo" parameterType="hashmap" resultType="hashmap">
		<!-- 사업체수  -->
			<if test='type == "0"'>
				SELECT 
					sgg.corp_cnt,
				   	sgg.sido_cd,
				   	sgg.sgg_cd,
				   	sgg.techbiz_m_class_cd as techbiz_cd,
				   	bord.sido_nm,
				   	bord.sgg_nm,
				   	bord.x_coor,
				   	bord.y_coor
				FROM (
					SELECT 
						corp_cnt,
						sido_cd, 
						sgg_cd, 
						techbiz_m_class_cd
				FROM srv_dt_techbiz_corpcnt_sgg 
				WHERE base_year = #{year}
					<if test='techbiz_m_class_cd != "00"'>
						AND techbiz_m_class_cd != '00' 
					</if>
					AND techbiz_m_class_cd = #{techbiz_m_class_cd} 
				GROUP BY sido_cd, sgg_cd, corp_cnt, techbiz_m_class_cd 
				) sgg
				INNER JOIN (
					SELECT 
							sido_cd, 
							sido_nm, 
							sgg_cd, 
							sgg_nm,
							x_coor,
							y_coor 
					FROM  srv_pg_sggbord
					WHERE base_year = #{bnd_year} 
				)bord
				ON sgg.sido_cd = bord.sido_cd and sgg.sgg_cd = bord.sgg_cd
			</if>
			
			<!-- 사업체비율  -->
			<if test='type == "1"'>
				SELECT
					sgg.corp_per,
				   	sgg.sido_cd,
				   	sgg.sgg_cd,
				   	sgg.techbiz_m_class_cd as techbiz_cd,
				   	bord.sido_nm,
				   	bord.sgg_nm,
				   	bord.x_coor,
				   	bord.y_coor
				FROM (
					SELECT 
							corp_per, 
							sido_cd, 
							sgg_cd, 
							techbiz_m_class_cd
					FROM srv_dt_techbiz_corprate_sgg 
					WHERE base_year = #{year} 
						<if test='techbiz_m_class_cd != "00"'>
							AND techbiz_m_class_cd != '00' 
						</if>
						AND techbiz_m_class_cd = #{techbiz_m_class_cd} 
					GROUP BY sido_cd, sgg_cd, corp_per, techbiz_m_class_cd
				) sgg
				INNER JOIN (
					SELECT 
							sido_cd, 
							sido_nm, 
							sgg_cd, 
							sgg_nm,
							x_coor,
							y_coor 
					FROM  srv_pg_sggbord
					WHERE base_year = #{bnd_year} 
				)bord
				ON sgg.sido_cd = bord.sido_cd and sgg.sgg_cd = bord.sgg_cd
				
				
			</if>
			
			<!-- 거주인구  -->
			<if test='type == "2"'>
				SELECT
					sgg.resid_ppltn_cnt, 
					sgg.sido_cd, 
					sgg.sgg_cd,
					bord.sido_nm,
				   	bord.sgg_nm,
				   	bord.x_coor,
				   	bord.y_coor 
				FROM(
					SELECT 
						resid_ppltn_cnt, 
						sido_cd, 
						sgg_cd 
					FROM srv_dt_techbiz_ppltn_sgg 
					WHERE techbiz_m_class_cd = #{techbiz_m_class_cd}
					GROUP BY sido_cd, sgg_cd, resid_ppltn_cnt
				)sgg
				INNER JOIN (
					SELECT 
							sido_cd, 
							sido_nm, 
							sgg_cd, 
							sgg_nm,
							x_coor,
							y_coor
					FROM  srv_pg_sggbord
					WHERE base_year = #{bnd_year} 
				)bord
				ON sgg.sido_cd = bord.sido_cd and sgg.sgg_cd = bord.sgg_cd
			</if>
			
			<!-- 업종종사자수  -->
			<if test='type == "3"'>
				SELECT
					sgg.worker_cnt, 
					sgg.sido_cd, 
					sgg.sgg_cd, 
					sgg.techbiz_m_class_cd as techbiz_cd,
					bord.sido_nm,
				   	bord.sgg_nm,
				   	bord.x_coor,
				   	bord.y_coor
				FROM(
					SELECT 
						worker_cnt, 
						sido_cd, 
						sgg_cd, 
						techbiz_m_class_cd
					FROM srv_dt_techbiz_worker_sgg 
					WHERE base_year = #{year} 
						<if test='techbiz_m_class_cd != "00"'>
							AND techbiz_m_class_cd != '00' 
						</if>
						AND techbiz_m_class_cd = #{techbiz_m_class_cd} 
					GROUP BY sido_cd, sgg_cd, worker_cnt, techbiz_m_class_cd
				)sgg
				INNER JOIN (
					SELECT 
							sido_cd, 
							sido_nm, 
							sgg_cd, 
							sgg_nm,
							x_coor,
							y_coor 
					FROM  srv_pg_sggbord
					WHERE base_year = #{bnd_year} 
				)bord
				ON sgg.sido_cd = bord.sido_cd and sgg.sgg_cd = bord.sgg_cd
				
			</if>
			
			<!-- 업종별 평균종사자수  -->
			<if test='type == "4"'>
				SELECT
					sgg.avg_worker_cnt, 
					sgg.sido_cd, 
					sgg.sgg_cd, 
					sgg.techbiz_m_class_cd as techbiz_cd,
					bord.sido_nm,
				   	bord.sgg_nm,
				   	bord.x_coor,
				   	bord.y_coor
				FROM(
					SELECT 
						avg_worker_cnt, 
						sido_cd, 
						sgg_cd, 
						techbiz_m_class_cd
					FROM srv_dt_techbiz_avgworker_sgg 
					WHERE base_year = #{year} 
						<if test='techbiz_m_class_cd != "00"'>
							AND techbiz_m_class_cd != '00' 
						</if> 
						AND techbiz_m_class_cd = #{techbiz_m_class_cd} 
					GROUP BY sido_cd, sgg_cd, avg_worker_cnt, techbiz_m_class_cd
				)sgg
				INNER JOIN (
					SELECT 
							sido_cd, 
							sido_nm, 
							sgg_cd, 
							sgg_nm,
							x_coor,
							y_coor
					FROM  srv_pg_sggbord
					WHERE base_year = #{bnd_year} 
				)bord
				ON sgg.sido_cd = bord.sido_cd and sgg.sgg_cd = bord.sgg_cd
				
			</if>
	
	</select>	
	
	<!-- 2017. 09. 14 개발팀 추가 -->
	<select id="selectFindRegionSgg" parameterType="hashmap" resultType="hashmap">
		select 
			data.*
			, bord.sido_nm
			, bord.sgg_nm
			, cd.techbiz_m_class_cd_nm
			
			<!-- <if test='is_contain_bizfac != null and is_contain_bizfac == "Y"'> -->
			, nvl(bizfacCnt.bizfac_cnt, 0) as bizfac_cnt 
			<!-- </if> -->
			
			<!-- <if test='is_contain_induscom != null and is_contain_induscom == "Y"'> -->
			, nvl(induscomCnt.induscom_cnt, 0) as induscom_cnt
			<!-- </if> --> 
			
			
		from
		(
			select
				trim(chartr.adm_cd) as adm_cd
				, lq.sido_cd
				, lq.sgg_cd
				, techbiz_b_class_cd
				, techbiz_m_class_cd
				, lq.country_vs_corp_lq
				, lq.country_vs_worker_lq
				, lq.sido_vs_corp_lq
				, lq.sido_vs_worker_lq
				, chartr.corp_irdsrate
				, chartr.worker_irdsrate
			from
			(
				select 
					substr(adm_cd, 1, 2) as sido_cd
					, substr(adm_cd, 3, 3) as sgg_cd
					, substr(techbiz_class_cd, 1, 1) as techbiz_b_class_cd
					, substr(techbiz_class_cd, 1, 2) as techbiz_m_class_cd
					, country_comp_corp_lq as country_vs_corp_lq
					, country_comp_worker_lq as country_vs_worker_lq
					, sido_comp_corp_lq as sido_vs_corp_lq
					, sido_comp_worker_lq as sido_vs_worker_lq
				from 
					srv_dt_techbiz_lq_regiontotal
				where
					base_year = #{base_year}
					and region_div = '2'
						
					<if test='techbiz_class_cd != null'>
					and techbiz_cd_div = #{techbiz_cd_div}
					and techbiz_class_cd = #{techbiz_class_cd}
					</if>
					
					<if test='techbiz_class_cd == null'>
					and techbiz_cd_div = '2'
					</if>
					
					<if test='lq_base_region == "country" and from_corp_lq != null and to_corp_lq != null'>
						<if test='to_corp_lq =="over"'>
							and country_comp_corp_lq > #{from_corp_lq}
						</if>
						<if test='to_corp_lq !="over"'>
							and country_comp_corp_lq between #{from_corp_lq} and #{to_corp_lq}
						</if>
					</if>
					
					<if test='lq_base_region == "country" and from_worker_lq != null and to_worker_lq != null'>
						<if test='to_worker_lq =="over"'>
							and country_comp_worker_lq > #{from_worker_lq}
						</if>
						<if test='to_worker_lq !="over"'>
							and country_comp_worker_lq between #{from_worker_lq} and #{to_worker_lq}
						</if>
					</if>
					
					<if test='lq_base_region == "sido" and from_corp_lq != null and to_corp_lq != null'>
						<if test='to_corp_lq =="over"'>
							and sido_comp_corp_lq > #{from_corp_lq}
						</if>
						<if test='to_corp_lq !="over"'>
							and sido_comp_corp_lq between #{from_corp_lq} and #{to_corp_lq}
						</if>
					</if>
					
					<if test='lq_base_region == "sido" and from_worker_lq != null and to_worker_lq != null'>
						<if test='to_worker_lq =="over"'>
							and sido_comp_worker_lq > #{from_worker_lq}
						</if>
						<if test='to_worker_lq !="over"'>
							and sido_comp_worker_lq between #{from_worker_lq} and #{to_worker_lq}
						</if>
					</if>
			) lq
			
			<!-- <if test='is_contain_bizfac != null and is_contain_bizfac == "Y"'> -->
			left join
			(
				select
					sido_cd
					, sgg_cd
					, nvl(count(*),0) as bizfac_cnt
				from
					srv_dt_techbiz_startupbizfac
				group by sido_cd, sgg_cd
			) bizfac
			on lq.sido_cd = bizfac.sido_cd and lq.sgg_cd = bizfac.sgg_cd
			<!-- </if> -->
			
			<!-- <if test='is_contain_induscom != null and is_contain_induscom == "Y"'> -->
			left join
			(
				select
					sido_cd
					, sgg_cd
					,  nvl(count(*),0) as induscom_cnt
				from
					srv_dt_techbiz_induscominfo
				group by sido_cd, sgg_cd
			) induscom
			on lq.sido_cd = induscom.sido_cd and lq.sgg_cd = induscom.sgg_cd
			<!-- </if> -->
			
			inner join
			(
				select
					adm_cd
					, techbiz_class_cd
					, corp_irdsrate
					, worker_irdsrate
				from
					srv_dt_techbiz_chartrinfo
				where
					base_year = #{base_year}
					and region_div = '2'
					
					<if test='techbiz_class_cd != null'>
					and techbiz_cd_div = #{techbiz_cd_div}
					and techbiz_class_cd = #{techbiz_class_cd}
					</if>
					
					<if test='techbiz_class_cd == null'>
					and techbiz_cd_div = '2'
					</if>
					
				group by adm_cd, techbiz_class_cd, corp_irdsrate, worker_irdsrate
			) chartr
			on concat(lq.sido_cd, lq.sgg_cd) = trim(chartr.adm_cd) and lq.techbiz_m_class_cd = chartr.techbiz_class_cd
		) data
		inner join
		(
			select
				sido_nm
				, sgg_nm
				, sido_cd
				, sgg_cd
			from
				srv_pg_sggbord
			where 
				base_year = #{base_year}
		) bord
		on data.sido_cd = bord.sido_cd and data.sgg_cd = bord.sgg_cd
		left join
		(
			select
				techbiz_m_class_cd
				, techbiz_m_class_cd_nm
			from
				cmm_cd_techbiz_cd
			group by techbiz_m_class_cd, techbiz_m_class_cd_nm
		) cd
		on data.techbiz_m_class_cd = cd.techbiz_m_class_cd
		
		<!-- <if test='is_contain_bizfac != null and is_contain_bizfac == "Y"'> -->
		left join
		(
			select
				sido_Cd
				, sgg_cd
				,  nvl(count(*),0) as bizfac_cnt
			from
				srv_dt_techbiz_startupbizfac
			group by sido_cd, sgg_cd
		) bizfacCnt
		on data.sido_cd = bizfacCnt.sido_cd and data.sgg_cd = bizfacCnt.sgg_cd 
		<!-- </if> -->
		
		<!-- <if test='is_contain_induscom != null and is_contain_induscom == "Y"'> -->
		left join
		(
			select
				sido_Cd
				, sgg_cd
				,  nvl(count(*),0) as induscom_cnt
			from
				srv_dt_techbiz_induscominfo
			group by sido_cd, sgg_cd
		) induscomCnt
		on data.sido_cd = induscomCnt.sido_cd and data.sgg_cd = induscomCnt.sgg_cd
		<!-- </if> --> 
	
	</select>
	
	<!-- 2017.11.06 개발팀 추가 -->
	<select id="selectFindRegionSggIrds" parameterType="hashmap" resultType="hashmap">
		select 
			data.*
			, bord.sido_nm
			, bord.sgg_nm
			, cd.techbiz_m_class_cd_nm
			
			<!-- <if test='is_contain_bizfac != null and is_contain_bizfac == "Y"'> -->
			, nvl(bizfacCnt.bizfac_cnt, 0) as bizfac_cnt 
			<!-- </if> -->
			
			<!-- <if test='is_contain_induscom != null and is_contain_induscom == "Y"'> -->
			, nvl(induscomCnt.induscom_cnt, 0) as induscom_cnt
			<!-- </if> --> 
			
			
		from
		(
			select
				trim(chartr.adm_cd) as adm_cd
				, lq.sido_cd
				, lq.sgg_cd
				, techbiz_b_class_cd
				, techbiz_m_class_cd
				, lq.country_vs_corp_lq
				, lq.country_vs_worker_lq
				, lq.sido_vs_corp_lq
				, lq.sido_vs_worker_lq
				, chartr.corp_irdsrate
				, chartr.worker_irdsrate
			from
			(
				select 
					substr(adm_cd, 1, 2) as sido_cd
					, substr(adm_cd, 3, 3) as sgg_cd
					, substr(techbiz_class_cd, 1, 1) as techbiz_b_class_cd
					, substr(techbiz_class_cd, 1, 2) as techbiz_m_class_cd
					, country_comp_corp_lq as country_vs_corp_lq
					, country_comp_worker_lq as country_vs_worker_lq
					, sido_comp_corp_lq as sido_vs_corp_lq
					, sido_comp_worker_lq as sido_vs_worker_lq
				from 
					srv_dt_techbiz_lq_regiontotal
				where
					base_year = #{base_year}
					and region_div = '2'
						
					<if test='techbiz_class_cd != null'>
					and techbiz_cd_div = #{techbiz_cd_div}
					and techbiz_class_cd = #{techbiz_class_cd}
					</if>
					
					<if test='techbiz_class_cd == null'>
					and techbiz_cd_div = '2'
					</if>
					
					<!-- <if test='lq_base_region == "country" and from_corp_lq != null and to_corp_lq != null'>
					and country_vs_corp_lq between #{from_corp_lq} and #{to_corp_lq}
					</if>
					
					<if test='lq_base_region == "country" and from_worker_lq != null and to_worker_lq != null'>
					and country_vs_worker_lq between #{from_worker_lq} and #{to_worker_lq}
					</if>
					
					<if test='lq_base_region == "sido" and from_corp_lq != null and to_corp_lq != null'>
					and sido_vs_corp_lq between #{from_corp_lq} and #{to_corp_lq}
					</if>
					
					<if test='lq_base_region == "sido" and from_worker_lq != null and to_worker_lq != null'>
					and sido_vs_worker_lq between #{from_worker_lq} and #{to_worker_lq}
					</if> -->
			) lq
			
			<!-- <if test='is_contain_bizfac != null and is_contain_bizfac == "Y"'> -->
			left join
			(
				select
					sido_cd
					, sgg_cd
					, nvl(count(*),0) as bizfac_cnt
				from
					srv_dt_techbiz_startupbizfac
				group by sido_cd, sgg_cd
			) bizfac
			on lq.sido_cd = bizfac.sido_cd and lq.sgg_cd = bizfac.sgg_cd
			<!-- </if> -->
			
			<!-- <if test='is_contain_induscom != null and is_contain_induscom == "Y"'> -->
			left join
			(
				select
					sido_cd
					, sgg_cd
					,  nvl(count(*),0) as induscom_cnt
				from
					srv_dt_techbiz_induscominfo
				group by sido_cd, sgg_cd
			) induscom
			on lq.sido_cd = induscom.sido_cd and lq.sgg_cd = induscom.sgg_cd
			<!-- </if> -->
			
			inner join
			(
				select
					adm_cd
					, techbiz_class_cd
					, corp_irdsrate
					, worker_irdsrate
				from
					srv_dt_techbiz_chartrinfo
				where
					base_year = #{base_year}
					and region_div = '2'
					
					<if test='techbiz_class_cd != null'>
					and techbiz_cd_div = #{techbiz_cd_div}
					and techbiz_class_cd = #{techbiz_class_cd}
					</if>
					
					<if test='techbiz_class_cd == null'>
					and techbiz_cd_div = '2'
					</if>
					
					<if test='lq_base_region == "country" and from_corp_lq != null and to_corp_lq != null'>
						<if test='to_corp_lq =="over"'>
							and corp_irdsrate > #{from_corp_lq}
						</if>
						<if test='to_corp_lq !="over"'>
							and corp_irdsrate betWeen #{from_corp_lq} and #{to_corp_lq}
						</if>
						
					</if>
					<if test='lq_base_region == "country" and from_worker_lq != null and to_worker_lq != null'>
						<if test='to_worker_lq =="over"'>
							and worker_irdsrate > #{from_worker_lq}
						</if>
						<if test='to_worker_lq !="over"'>
							and worker_irdsrate betWeen #{from_worker_lq} and #{to_worker_lq}
						</if>
					</if>
					
					
				group by adm_cd, techbiz_class_cd, corp_irdsrate, worker_irdsrate
			) chartr
			on concat(lq.sido_cd, lq.sgg_cd) = trim(chartr.adm_cd) and lq.techbiz_m_class_cd = chartr.techbiz_class_cd
		) data
		inner join
		(
			select
				sido_nm
				, sgg_nm
				, sido_cd
				, sgg_cd
			from
				srv_pg_sggbord
			where 
				base_year = #{base_year}
		) bord
		on data.sido_cd = bord.sido_cd and data.sgg_cd = bord.sgg_cd
		left join
		(
			select
				techbiz_m_class_cd
				, techbiz_m_class_cd_nm
			from
				cmm_cd_techbiz_cd
			group by techbiz_m_class_cd, techbiz_m_class_cd_nm
		) cd
		on data.techbiz_m_class_cd = cd.techbiz_m_class_cd
		
		<!-- <if test='is_contain_bizfac != null and is_contain_bizfac == "Y"'> -->
		left join
		(
			select
				sido_Cd
				, sgg_cd
				,  nvl(count(*),0) as bizfac_cnt
			from
				srv_dt_techbiz_startupbizfac
			group by sido_cd, sgg_cd
		) bizfacCnt
		on data.sido_cd = bizfacCnt.sido_cd and data.sgg_cd = bizfacCnt.sgg_cd 
		<!-- </if> -->
		
		<!-- <if test='is_contain_induscom != null and is_contain_induscom == "Y"'> -->
		left join
		(
			select
				sido_Cd
				, sgg_cd
				,  nvl(count(*),0) as induscom_cnt
			from
				srv_dt_techbiz_induscominfo
			group by sido_cd, sgg_cd
		) induscomCnt
		on data.sido_cd = induscomCnt.sido_cd and data.sgg_cd = induscomCnt.sgg_cd
		<!-- </if> --> 
	</select>
	
	<!-- 2017. 10. 10 개발팀 추가 -->
	<select id="selectInduscomLq" parameterType="hashmap" resultType="hashmap">
		select
			lq.*
			, cd.techbiz_m_class_cd_nm
		from		
			(
			select 
				complex_no
				, techbiz_class_cd
				, country_comp_corp_lq as country_vs_corp_lq
				, country_comp_worker_lq as country_vs_worker_lq
				, sido_comp_corp_lq as sido_vs_corp_lq
				, sido_comp_worker_lq as sido_vs_worker_lq
			from 
				SRV_DT_TECHBIZ_INDUSCOMDETAIL_LQ
			where
				base_year = #{base_year}
				and complex_no = #{complex_no}
				and len(techbiz_class_cd) = 2
			) lq
		left join 
			(
			select 
				techbiz_m_class_cd
				, techbiz_m_class_cd_nm 
			from 
				cmm_cd_techbiz_cd
			group by
				techbiz_m_class_cd
				, techbiz_m_class_cd_nm 
			) cd
		on lq.techbiz_class_cd = cd.techbiz_m_class_cd
	</select>
	
	<!-- 2017. 10. 19 개발팀 추가 -->
	<select id="selectRegionLq" parameterType="hashmap" resultType="hashmap">
		select 
			data.*
			
			<if test='region_div == 1'>
			, bord.sido_nm
			</if>
			<if test='region_div == 2'>
			, bord.sido_nm
			, bord.sgg_nm
			</if>
			<if test='region_div == 3'>
			, bord.sido_nm
			, bord.sgg_nm
			, bord.emdong_nm
			</if>
			
			<if test='techbiz_cd_div == 1'>
			, cd.techbiz_b_class_cd_nm
			</if>
			<if test='techbiz_cd_div == 2'>
			, cd.techbiz_m_class_cd_nm
			</if>
			<if test='techbiz_cd_div == 3'>
			, cd.techbiz_s_class_cd_nm
			</if>
			
		from
		(
			select
				trim(chartr.adm_cd) as adm_cd
				
				<if test='region_div == 1'>
				, substr(chartr.adm_cd, 1, 2) as sido_cd
				</if>
				<if test='region_div == 2'>
				, substr(chartr.adm_cd, 1, 2) as sido_cd
				, substr(chartr.adm_cd, 3, 3) as sgg_cd
				</if>
				<if test='region_div == 3'>
				, substr(chartr.adm_cd, 1, 2) as sido_cd
				, substr(chartr.adm_cd, 3, 3) as sgg_cd
				, substr(chartr.adm_cd, 6, 2) as emdong_cd
				</if>
				
				<if test='techbiz_cd_div == 1'>
				, substr(lq.techbiz_class_cd, 1, 1) as techbiz_b_class_cd
				</if>
				<if test='techbiz_cd_div == 2'>
				, substr(lq.techbiz_class_cd, 1, 2) as techbiz_m_class_cd
				</if>
				<if test='techbiz_cd_div == 3'>
				, substr(lq.techbiz_class_cd, 1, 3) as techbiz_s_class_cd
				</if>
				
				, lq.country_vs_corp_lq
				, lq.country_vs_worker_lq
				, lq.sido_vs_corp_lq
				, lq.sido_vs_worker_lq
				, chartr.corp_irdsrate
				, chartr.worker_irdsrate
				, chartr.corp_cnt
				, chartr.worker_cnt
				, chartr.corp_per
				, chartr.worker_per
				, lq.base_year
			from
			(
				select 
					adm_cd
					, techbiz_class_cd
					, country_comp_corp_lq as country_vs_corp_lq
					, country_comp_worker_lq as country_vs_worker_lq
					, sido_comp_corp_lq as sido_vs_corp_lq
					, sido_comp_worker_lq as sido_vs_worker_lq
					, base_year
				from 
					srv_dt_techbiz_lq_regiontotal
				where
					1 = 1
					<if test='base_year != null'>
					and base_year = #{base_year}
					</if>
					
					<choose>
						<when test='adm_cd == null'>
						and region_div = '1'
						</when>
						<otherwise>
							<if test='lower_search == 0'>
							and region_div = #{region_div}
							and trim(adm_cd) = #{adm_cd}
							</if>
							
							<if test='lower_search != 0'>
							and region_div = #{region_div}
							and trim(adm_cd) like #{lower_adm_cd}
							</if>
						</otherwise> 
					</choose>
					
					<choose>
						<when test='techbiz_class_cd == null'>
						and techbiz_cd_div = '2'
						</when>
						<otherwise>
						and techbiz_cd_div = #{techbiz_cd_div}
						and techbiz_class_cd = #{techbiz_class_cd}
						</otherwise> 
					</choose>
					
			) lq
			inner join
			(
				select
					adm_cd
					, techbiz_class_cd
					, corp_irdsrate
					, worker_irdsrate
					, corp_cnt
					, worker_cnt
					, corp_per
					, worker_per
					, base_year
				from
					srv_dt_techbiz_chartrinfo
				where
					1 = 1
					<if test='base_year != null'>
					and base_year = #{base_year}
					</if>
					
					<choose>
						<when test='adm_cd == null'>
						and region_div = '1'
						</when>
						<otherwise>
							<if test='lower_search == 0'>
							and region_div = #{region_div}
							and trim(adm_cd) = #{adm_cd}
							</if>
							
							<if test='lower_search != 0'>
							and region_div = #{region_div}
							and trim(adm_cd) like #{lower_adm_cd}
							</if>
						</otherwise> 
					</choose>
					
					<choose>
						<when test='techbiz_class_cd == null'>
						and techbiz_cd_div = '2'
						</when>
						<otherwise>
						and techbiz_cd_div = #{techbiz_cd_div}
						and techbiz_class_cd = #{techbiz_class_cd}
						</otherwise> 
					</choose>
					
				group by adm_cd, techbiz_class_cd, corp_irdsrate, worker_irdsrate, corp_cnt, worker_cnt, corp_per, worker_per, base_year
			) chartr
			on lq.base_year = chartr.base_year and trim(lq.adm_cd) = trim(chartr.adm_cd) and lq.techbiz_class_cd = chartr.techbiz_class_cd
		) data
		<if test='region_div == 1'>
		inner join
		(
			select
				sido_nm
				, sido_cd
				, base_year
			from
				srv_pg_sidobord
			where 
				1 = 1
				<if test='base_year != null'>
				and base_year = #{base_year}
				</if>
		) bord
		on data.base_year = bord.base_year and data.sido_cd = bord.sido_cd
		</if>
		<if test='region_div == 2'>
		inner join
		(
			select
				sido_nm
				, sgg_nm
				, sido_cd
				, sgg_cd
				, base_year
			from
				srv_pg_sggbord
			where 
				1 = 1
				<if test='base_year != null'>
				and base_year = #{base_year}
				</if>
		) bord
		on data.base_year = bord.base_year and data.sido_cd = bord.sido_cd and data.sgg_cd = bord.sgg_cd
		</if>
		<if test='region_div == 3'>
		inner join
		(
			select
				sido_nm
				, sgg_nm
				, emdong_nm
				, sido_cd
				, sgg_cd
				, emdong_cd
				, base_year
			from
				srv_pg_admbord
			where 
				1 = 1
				<if test='base_year != null'>
				and base_year = #{base_year}
				</if>
		) bord
		on data.base_year = bord.base_year and data.sido_cd = bord.sido_cd and data.sgg_cd = bord.sgg_cd and data.emdong_cd = bord.emdong_cd
		</if>
		<if test='techbiz_cd_div == 1'>
		left join
		(
			select
				techbiz_b_class_cd
				, techbiz_b_class_cd_nm
			from
				cmm_cd_techbiz_cd
			group by techbiz_b_class_cd, techbiz_b_class_cd_nm
		) cd
		on data.techbiz_b_class_cd = cd.techbiz_b_class_cd
		</if>
		<if test='techbiz_cd_div == 2'>
		left join
		(
			select
				techbiz_m_class_cd
				, techbiz_m_class_cd_nm
			from
				cmm_cd_techbiz_cd
			group by techbiz_m_class_cd, techbiz_m_class_cd_nm
		) cd
		on data.techbiz_m_class_cd = cd.techbiz_m_class_cd
		</if>
		<if test='techbiz_cd_div == 3'>
		left join
		(
			select
				techbiz_s_class_cd
				, techbiz_s_class_cd_nm
			from
				cmm_cd_techbiz_cd
			group by techbiz_s_class_cd, techbiz_s_class_cd_nm
		) cd
		on data.techbiz_s_class_cd = cd.techbiz_s_class_cd
		</if>
	</select>
	
	
	<!-- 2017.11.08 개발팀 추가 필터 -->
	<select id="selectFilterSerch" parameterType="hashmap" resultType="hashmap">
		select 
			sido_cd,sgg_cd, 
			techbiz_m_class_cd,
			comp_div,ppltn_stat_sd_idx,
			area_stat_sd_idx,
			pclnd_chg_rt_sd_idx, 
			fnidpr_sd_idx as financial_sd_idx,
			corp_cnt_sd_idx,
			worker_cnt_sd_idx   
			
			from SRV_DT_TECHBIZ_REGIONTOTAL_SGG
			
		where base_year = #{base_year}
		<if test='ppltn != null and ppltn == 1'>
			and ppltn_stat_sd_idx between #{fromPpltn} and #{toPpltn}
		</if>
		<if test='areaStat != null and areaStat == 1'>
			and area_stat_sd_idx between #{fromAreaStat} and #{toAreaStat}
		</if>
		<if test='areaPrice != null and areaPrice == 1'>
			and pclnd_chg_rt_sd_idx between #{fromAreaPrice} and #{toAreaPrice}
		</if>
		<if test='financial != null and financial == 1'>
			<!-- and financial_sd_idx between #{fromFinancial} and #{toFinancial} -->
			 and fnidpr_sd_idx between #{fromFinancial} and #{toFinancial} 
		</if>
		<!-- and sido_cd = SUBSTR(#{adm_cd},1,2) 
		and sgg_cd = SUBSTR(#{adm_cd},3,3) -->
		and techbiz_m_class_cd = #{techCd}
        
        and comp_div = #{base_region}
	</select>
	
	<select id="selectTotalInfo1" parameterType="hashmap" resultType="hashmap">
    	<!-- 2018.01.22 [개발팀] 쿼리튜닝 -->
    	SELECT 
				sido_cd || sgg_cd as adm_cd,
				techbiz_m_class_Cd as techCd,
				nvl(ppltn_stat_sd_idx, 0) as ppltnZ ,
        	 	nvl(area_stat_sd_idx, 0) as areaStatZ ,
        	 	nvl(pclnd_chg_rt_sd_idx, 0) as areaPriceZ ,
        	 	nvl(fnidpr_sd_idx, 0) as financialZ ,
        	 	nvl(corp_cnt_sd_idx, 0) as corpCntZ ,
        	 	nvl(worker_cnt_sd_idx, 0)  as  workerCntZ

		FROM  	SRV_DT_TECHBIZ_REGIONTOTAL_SGG 
		where 
			comp_div = #{base_region}
			and techbiz_m_class_cd = #{techCd}
			and BASE_YEAR = #{base_year}
            and SIDO_CD = SUBSTR(#{adm_cd},1,2)
            and SGG_CD = SUBSTR(#{adm_cd},3,3)
    	
	</select>
	<select id="selectTotalInfo2" parameterType="hashmap" resultType="hashmap">
		select 
			adm_cd,
			techbiz_class_cd,
			country_comp_corp_lq as country_vs_corp_lq,
			country_comp_worker_lq as country_vs_worker_lq,
			sido_comp_corp_lq as sido_vs_corp_lq,
			sido_comp_worker_lq as sido_vs_worker_lq
			
			from srv_dt_techbiz_lq_regiontotal
			
			where
						BASE_YEAR = #{base_year}
                		and adm_cd = #{adm_cd}
                		and techbiz_class_cd = #{techCd}
	</select>
	
	<select id="selectTotalInfo3" parameterType="hashmap" resultType="hashmap">
		select
					adm_cd
					, base_year
					, techbiz_class_cd
					, corp_irdsrate
					, worker_irdsrate
				from
					srv_dt_techbiz_chartrinfo
				where
					techbiz_class_cd = #{techCd}
					and adm_cd = #{adm_cd}
					
					order by base_year asc
	</select>
	
	<select id="selectDetailInfo1" parameterType="hashmap" resultType="hashmap">
		select count(*) as cnt from SRV_DT_TECHBIZ_STARTUPBIZFAC
		
		where SIDO_CD = SUBSTR(#{adm_cd},1,2) and SGG_CD = SUBSTR(#{adm_cd},3,3);
	</select>
	<select id="selectDetailInfo2" parameterType="hashmap" resultType="hashmap">
		select count(*) as cnt from SRV_DT_TECHBIZ_INDUSCOMINFO
		
		where SIDO_CD = SUBSTR(#{adm_cd},1,2) and SGG_CD = SUBSTR(#{adm_cd},3,3)
	</select>
	<select id="selectDetailInfo3" parameterType="hashmap" resultType="hashmap">
		<if  test='option1 == "0"'>
		select 
			corp_cnt as cnt
			from srv_dt_techbiz_chartrinfo
			where region_div = '2'
				and techbiz_class_cd = #{techCd}
				and base_year = #{base_year}
				and adm_cd = #{adm_cd}
		</if>
		<if  test='option1 == "1"'>
		select 
			worker_cnt as cnt
			from srv_dt_techbiz_chartrinfo
			where region_div = '2'
				and techbiz_class_cd = #{techCd}
				and base_year = #{base_year}
				and adm_cd = #{adm_cd}
		</if>
	</select>
	<select id="selectAdmNm" parameterType="hashmap" resultType="hashmap">
		select addr,sido_nm,sgg_nm,sido_cd||sgg_cd as adm_cd from srv_pg_sggbord
		
		where 
		base_year = #{base_year}
		 and SIDO_CD = SUBSTR(#{adm_cd},1,2)
		 and SGG_CD = SUBSTR(#{adm_cd},3,3)
		
	</select>
	
	<select id="selectDetailInfo4" parameterType="hashmap" resultType="hashmap">
		<!-- SRV_DT_TECHBIZ_PPLTN_SGG 2015년도 데이터가 없어서 임시로 처리  -->
		<if  test='option2 == "0"'>
			select RESID_PPLTN_CNT as cnt
				from SRV_DT_TECHBIZ_PPLTN_SGG
				where  base_year = #{base_year}
				and techbiz_m_class_cd = #{techCd}
				and SIDO_CD = SUBSTR(#{adm_cd},1,2) 
				and SGG_CD = SUBSTR(#{adm_cd},3,3)
		</if>
		<if  test='option2 == "1"'>
				<!-- 2018.01.18 [개발팀] 쿼리수정 -->
				select AREA as cnt from SRV_PG_SGGBORD
				where base_year = #{bnd_year}
				and SIDO_CD = SUBSTR(#{adm_cd},1,2) 
				and SGG_CD = SUBSTR(#{adm_cd},3,3) 
				
		</if>
		<if  test='option2 == "2"'>
			select nvl(pclnd_chg_rt, 0) as cnt <!-- 2018.01.19 [개발팀] -->
				from srv_dt_techbiz_chartrinfo
				where  base_year = #{base_year}
				and techbiz_class_cd = #{techCd}
				and adm_cd = #{adm_cd} 
		</if>
		<if  test='option2 == "3"'>
			select nvl(fnidpr, 0) as cnt <!-- 2018.01.19 [개발팀] -->
				from srv_dt_techbiz_chartrinfo
				where  base_year = #{base_year}
				and techbiz_class_cd = #{techCd}
				and adm_cd = #{adm_cd}
		</if>
	</select>
<!-- ================================================================= -->	
</mapper>