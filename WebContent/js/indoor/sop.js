/*
 sop 0.1-dev,
*/
!function(t,i,e){function n(){var i=t.sop;o.noConflict=function(){return t.sop=i,this},t.sop=o}var o={version:"0.1-dev"};"object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd?define(o):n(),o.Util={extend:function(t){var i,e,n,o;for(e=1,n=arguments.length;n>e;e++){o=arguments[e];for(i in o)t[i]=o[i]}return t},create:Object.create||function(){function t(){}return function(i){return t.prototype=i,new t}}(),bind:function(t,i){var e=Array.prototype.slice;if(t.bind)return t.bind.apply(t,e.call(arguments,1));var n=e.call(arguments,2);return function(){return t.apply(i,n.length?n.concat(e.call(arguments)):arguments)}},stamp:function(t){return t._sop_id=t._sop_id||++o.Util.lastId,t._sop_id},lastId:0,throttle:function(t,i,e){var n,o,s,r;return r=function(){n=!1,o&&(s.apply(e,o),o=!1)},s=function(){n?o=arguments:(t.apply(e,arguments),setTimeout(r,i),n=!0)}},wrapNum:function(t,i,e){var n=i[1],o=i[0],s=n-o;return t===n&&e?t:((t-o)%s+s)%s+o},falseFn:function(){return!1},formatNum:function(t,i){var e=Math.pow(10,i||5);return Math.round(t*e)/e},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,i){t.hasOwnProperty("options")||(t.options=t.options?o.Util.create(t.options):{});for(var e in i)t.options[e]=i[e];return t.options},getParamString:function(t,i,e){var n=[];for(var o in t)n.push(encodeURIComponent(e?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(i&&-1!==i.indexOf("?")?"&":"?")+n.join("&")},template:function(t,i){return t.replace(o.Util.templateRe,function(t,n){var o=i[n];if(o===e)throw new Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(i)),o})},templateRe:/\{ *([\w_]+) *\}/g,isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",isUndefined:function(t){return"undefined"==typeof t},typeOf:function(t){var i=Object.prototype.toString;return this._ObjectToType[i.call(t)]||(t?"object":null===t?"null":"undefined")},_ObjectToType:{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Object]":"object","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Error]":"error"}},function(){function i(i){return t["webkit"+i]||t["moz"+i]||t["ms"+i]}function e(i){var e=+new Date,o=Math.max(0,16-(e-n));return n=e+o,t.setTimeout(i,o)}var n=0,s=t.requestAnimationFrame||i("RequestAnimationFrame")||e,r=t.cancelAnimationFrame||i("CancelAnimationFrame")||i("CancelRequestAnimationFrame")||function(i){t.clearTimeout(i)};o.Util.requestAnimFrame=function(i,n,r){return r&&s===e?void i.call(n):s.call(t,o.bind(i,n))},o.Util.cancelAnimFrame=function(i){i&&r.call(t,i)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var i=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks.length&&this.callInitHooks()},e=i.__super__=this.prototype,n=o.Util.create(e);n.constructor=i,i.prototype=n;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(i[s]=this[s]);return t.statics&&(o.extend(i,t.statics),delete t.statics),t.includes&&(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),n.options&&(t.options=o.Util.extend(o.Util.create(n.options),t.options)),o.extend(n,t),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){e.callInitHooks&&e.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,i=n._initHooks.length;i>t;t++)n._initHooks[t].call(this)}},i},o.Class.include=function(t){o.extend(this.prototype,t)},o.Class.mergeOptions=function(t){o.extend(this.prototype.options,t)},o.Class.addInitHook=function(t){var i=Array.prototype.slice.call(arguments,1),e="function"==typeof t?t:function(){this[t].apply(this,i)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(e)},o.Evented=o.Class.extend({on:function(t,i,e){if("object"==typeof t)for(var n in t)this._on(n,t[n],i);else{t=o.Util.splitWords(t);for(var s=0,r=t.length;r>s;s++)this._on(t[s],i,e)}return this},off:function(t,i,e){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],i);else{t=o.Util.splitWords(t);for(var s=0,r=t.length;r>s;s++)this._off(t[s],i,e)}else delete this._events;return this},_on:function(t,i,e){var n=this._events=this._events||{},s=e&&e!==this&&o.stamp(e);if(s){var r=t+"_idx",a=t+"_len",h=n[r]=n[r]||{},u=o.stamp(i)+"_"+s;h[u]||(h[u]={fn:i,ctx:e},n[a]=(n[a]||0)+1)}else n[t]=n[t]||[],n[t].push({fn:i})},_off:function(t,i,e){var n=this._events,s=t+"_idx",r=t+"_len";if(n){if(!i)return delete n[t],delete n[s],void delete n[r];var a,h,u,l,c,d=e&&e!==this&&o.stamp(e);if(d)c=o.stamp(i)+"_"+d,a=n[s],a&&a[c]&&(l=a[c],delete a[c],n[r]--);else if(a=n[t])for(h=0,u=a.length;u>h;h++)if(a[h].fn===i){l=a[h],a.splice(h,1);break}l&&(l.fn=o.Util.falseFn)}},fire:function(t,i,e){if(!this.listens(t,e))return this;var n=o.Util.extend({},i,{type:t,target:this}),s=this._events;if(s){var r,a,h,u,l=s[t+"_idx"];if(s[t])for(h=s[t].slice(),r=0,a=h.length;a>r;r++)h[r].fn.call(this,n);for(u in l)l[u].fn.call(l[u].ctx,n)}return e&&this._propagateEvent(n),this},listens:function(t,i){var e=this._events;if(e&&(e[t]||e[t+"_len"]))return!0;if(i)for(var n in this._eventParents)if(this._eventParents[n].listens(t,i))return!0;return!1},once:function(t,i,e){if("object"==typeof t){for(var n in t)this.once(n,t[n],i);return this}var s=o.bind(function(){this.off(t,i,e).off(t,s,e)},this);return this.on(t,i,e).on(t,s,e)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[o.stamp(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[o.stamp(t)],this},_propagateEvent:function(t){for(var i in this._eventParents)this._eventParents[i].fire(t.type,o.extend({layer:t.target},t),!0)}});var s=o.Evented.prototype;s.addEventListener=s.on,s.removeEventListener=s.clearAllEventListeners=s.off,s.addOneTimeEventListener=s.once,s.fireEvent=s.fire,s.hasEventListeners=s.listens,o.Mixin={Events:s},function(){var e=navigator.userAgent.toLowerCase(),n=i.documentElement,s="ActiveXObject"in t,r=-1!==e.indexOf("webkit"),a=-1!==e.indexOf("phantom"),h=-1!==e.search("android [23]"),u=-1!==e.indexOf("chrome"),l="undefined"!=typeof orientation,c=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!t.PointerEvent,d=t.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||c,m=s&&"transition"in n.style,_="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!h,p="MozPerspective"in n.style,f="OTransition"in n.style,v="devicePixelRatio"in t&&t.devicePixelRatio>1;if(!v&&"matchMedia"in t){var y=t.matchMedia("(min-resolution:144dpi)");v=y&&y.matches}var g=!t.L_NO_TOUCH&&!a&&(d||"ontouchstart"in t||t.DocumentTouch&&i instanceof t.DocumentTouch),w=!1;"function"==typeof XMLHttpRequest&&(w=!0),o.Browser={ie:s,ielt9:s&&!i.addEventListener,webkit:r,gecko:-1!==e.indexOf("gecko")&&!r&&!t.opera&&!s,android:-1!==e.indexOf("android"),android23:h,chrome:u,safari:!u&&-1!==e.indexOf("safari"),ie3d:m,webkit3d:_,gecko3d:p,opera3d:f,any3d:!t.L_DISABLE_3D&&(m||_||p||f)&&!a,mobile:l,mobileWebkit:l&&r,mobileWebkit3d:l&&_,mobileOpera:l&&t.opera,touch:!!g,msPointer:!!c,pointer:!!d,retina:!!v,xhr:w}}(),o.Const=o.Class.extend({statics:{IMAGE_PATH:function(){var t,e,n,o,s=i.getElementsByTagName("script"),r=/[\/^]sop[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,e=s.length;e>t;t++)if(n=s[t].src,n.match(r))return o=n.split(r)[0],(o?o+"/":"")+"images"}()}}),o.Point=function(t,i,e){this.x=e?Math.round(t):t,this.y=e?Math.round(i):i},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(t){t=o.point(t);var i=t.x-this.x,e=t.y-this.y;return Math.sqrt(i*i+e*e)},equals:function(t){return t=o.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,i,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===e||null===t?t:new o.Point(t,i,n)},o.Bounds=function(t,i){if(t)for(var e=i?[t,i]:t,n=0,o=e.length;o>n;n++)this.extend(e[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var i,e;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(i=t.min,e=t.max):i=e=t,i.x>=this.min.x&&e.x<=this.max.x&&i.y>=this.min.y&&e.y<=this.max.y},intersects:function(t){t=o.bounds(t);var i=this.min,e=this.max,n=t.min,s=t.max,r=s.x>=i.x&&n.x<=e.x,a=s.y>=i.y&&n.y<=e.y;return r&&a},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,i){return!t||t instanceof o.Bounds?t:new o.Bounds(t,i)},o.Transformation=function(t,i,e,n){this._a=t,this._b=i,this._c=e,this._d=n},o.Transformation.prototype={transform:function(t,i){return this._transform(t.clone(),i)},_transform:function(t,i){return i=i||1,t.x=i*(this._a*t.x+this._b),t.y=i*(this._c*t.y+this._d),t},untransform:function(t,i){return i=i||1,new o.Point((t.x/i-this._b)/this._a,(t.y/i-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?i.getElementById(t):t},getStyle:function(t,e){var n=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!n||"auto"===n)&&i.defaultView){var o=i.defaultView.getComputedStyle(t,null);n=o?o[e]:null}return"auto"===n?null:n},create:function(t,e,n){var o=i.createElement(t);return o.className=e,n&&n.appendChild(o),o},remove:function(t){var i=t.parentNode;i&&i.removeChild(t)},empty:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},toFront:function(t){t.parentNode.appendChild(t)},toBack:function(t){var i=t.parentNode;i.insertBefore(t,i.firstChild)},hasClass:function(t,i){if(t.classList!==e)return t.classList.contains(i);var n=o.DomUtil.getClass(t);return n.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(n)},addClass:function(t,i){if(t.classList!==e)for(var n=o.Util.splitWords(i),s=0,r=n.length;r>s;s++)t.classList.add(n[s]);else if(!o.DomUtil.hasClass(t,i)){var a=o.DomUtil.getClass(t);o.DomUtil.setClass(t,(a?a+" ":"")+i)}},removeClass:function(t,i){t.classList!==e?t.classList.remove(i):o.DomUtil.setClass(t,o.Util.trim((" "+o.DomUtil.getClass(t)+" ").replace(" "+i+" "," ")))},setClass:function(t,i){t.className.baseVal===e?t.className=i:t.className.baseVal=i},getClass:function(t){return t.className.baseVal===e?t.className:t.className.baseVal},setOpacity:function(t,i){if("opacity"in t.style)t.style.opacity=i;else if("filter"in t.style){var e=!1,n="DXImageTransform.Microsoft.Alpha";try{e=t.filters.item(n)}catch(o){if(1===i)return}i=Math.round(100*i),e?(e.Enabled=100!==i,e.Opacity=i):t.style.filter+=" progid:"+n+"(opacity="+i+")"}},testProp:function(t){for(var e=i.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1},setTransform:function(t,i,e){var n=i||new o.Point(0,0);t.style[o.DomUtil.TRANSFORM]="translate3d("+n.x+"px,"+n.y+"px,0)"+(e?" scale("+e+")":"")},setPosition:function(t,i,e){t._sop_pos=i,o.Browser.any3d&&!e?o.DomUtil.setTransform(t,i):(t.style.left=i.x+"px",t.style.top=i.y+"px")},getPosition:function(t){return t._sop_pos}},function(){o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var e=o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);if(o.DomUtil.TRANSITION_END="webkitTransition"===e||"OTransition"===e?e+"End":"transitionend","onselectstart"in i)o.DomUtil.disableTextSelection=function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},o.DomUtil.enableTextSelection=function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)};else{var n=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.DomUtil.disableTextSelection=function(){if(n){var t=i.documentElement.style;this._userSelect=t[n],t[n]="none"}},o.DomUtil.enableTextSelection=function(){n&&(i.documentElement.style[n]=this._userSelect,delete this._userSelect)}}o.DomUtil.disableImageDrag=function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},o.DomUtil.enableImageDrag=function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)}}(),o.UTMK=function(t,i,n){if(isNaN(t)||isNaN(i))throw new Error("Invalid UTMK object: ("+t+", "+i+")");this.x=+t,this.y=+i,n!==e&&(this.alt=+n)},o.UTMK.prototype={equals:function(t,i){if(!t)return!1;t=o.utmk(t);var n=Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y));return(i===e?1e-9:i)>=n},toString:function(t){return"UTMK("+o.Util.formatNum(this.x,t)+", "+o.Util.formatNum(this.y,t)+")"},distanceTo:function(t){return o.CRS.UTMK.distance(this,o.utmk(t))},wrap:function(){return o.CRS.UTMK.wrapUTMK(this)}},o.UTMK.PROJ_CODE="SR-ORG:7308",o.UTMK.PROJ_DEF="+proj=tmerc +lat_0=38.0 +lon_0=127.5 +x_0=1000000.0 +y_0=2000000.0 +k=0.9996 +a=6378137.0 +b=6356752.3141403 +ellps=GRS80 +towgs84=0,0,0 +datum=WGS84 +no_defs",o.utmk=function(t,i){return t instanceof o.UTMK?t:o.Util.isArray(t)&&"object"!=typeof t[0]?3===t.length?new o.UTMK(t[0],t[1],t[2]):new o.UTMK(t[0],t[1]):t===e||null===t?t:"object"==typeof t&&"x"in t?new o.UTMK(t.x,"y"in t?t.y:0):i===e?null:new o.UTMK(t,i)},o.UTMKBounds=function(t,i){if(t)for(var e=i?[t,i]:t,n=0,o=e.length;o>n;n++)this.extend(e[n])},o.UTMKBounds.prototype={extend:function(t){var i,e,n=this._southWest,s=this._northEast;if(t instanceof o.UTMK)i=t,e=t;else{if(!(t instanceof o.UTMKBounds))return t?this.extend(o.utmk(t)||o.utmkBounds(t)):this;if(i=t._southWest,e=t._northEast,!i||!e)return this}return n||s?(n.x=Math.min(i.x,n.x),n.y=Math.min(i.y,n.y),s.x=Math.max(e.x,s.x),s.y=Math.max(e.y,s.y)):(this._southWest=new o.UTMK(i.x,i.y),this._northEast=new o.UTMK(e.x,e.y)),this},pad:function(t){var i=this._southWest,e=this._northEast,n=Math.abs(i.y-e.y)*t,s=Math.abs(i.x-e.x)*t;return new o.UTMKBounds(new o.UTMK(i.x-s,i.y-n),new o.UTMK(e.x+s,e.y+n))},getCenter:function(){return new o.UTMK((this._southWest.x+this._northEast.x)/2,(this._southWest.y+this._northEast.y)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.UTMK(this.getWest(),this.getNorth())},getSouthEast:function(){return new o.UTMK(this.getEast(),this.getSouth())},getWest:function(){return this._southWest.x},getSouth:function(){return this._southWest.y},getEast:function(){return this._northEast.x},getNorth:function(){return this._northEast.y},contains:function(t){t="number"==typeof t[0]||t instanceof o.UTMK?o.utmk(t):o.utmkBounds(t);var i,e,n=this._southWest,s=this._northEast;return t instanceof o.UTMKBounds?(i=t.getSouthWest(),e=t.getNorthEast()):i=e=t,i.x>=n.x&&e.x<=s.x&&i.y>=n.y&&e.y<=s.y},intersects:function(t){t=o.utmkBounds(t);var i=this._southWest,e=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.y>=i.y&&n.y<=e.y,a=s.x>=i.x&&n.x<=e.x;return r&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=o.utmkBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},o.utmkBounds=function(t,i){return!t||t instanceof o.UTMKBounds?t:new o.UTMKBounds(t,i)},o.Projection={},o.Projection.UTMK={bounds:o.bounds([171162,1214781],[1744026,2787645]),utmkBounds:o.utmkBounds([[171162,1214781],[1744026,2787645]]),project:function(t){return new o.Point(t.x,t.y)},unproject:function(t){return new o.UTMK(t.x,t.y)}},o.CRS={utmkToPoint:function(t,i){var e=this.projection.project(t),n=this.scale(i);return this.transformation._transform(e,n)},pointToUTMK:function(t,i){var e=this.scale(i),n=this.transformation.untransform(t,e);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},getProjectedBounds:function(t){if(this.infinite)return null;var i=this.projection.bounds,e=this.scale(t),n=this.transformation.transform(i.min,e),s=this.transformation.transform(i.max,e);return o.bounds(n,s)},wrapUTMK:function(t){var i=this.wrapX?o.Util.wrapNum(t.x,this.wrapX,!0):t.x,e=this.wrapY?o.Util.wrapNum(t.y,this.wrapY,!0):t.y;return o.utmk(i,e)}},o.CRS.UTMK=o.extend({},o.CRS,{projection:o.Projection.UTMK,transformation:new o.Transformation(1,-171162,-1,2787645),resolutions:[2048,1024,512,256,128,64,32,16,8,4,2,1,.5,.25,.125,.0625,.03125,.015625,.0078125,.00390625,.001953125],_scales:function(){for(var t=[],i=0,e=this.resolutions.length;e>i;i++)t[i]=1/this.resolutions[i];return t},scale:function(t){return"function"==typeof this._scales&&(this._scales=this._scales()),this._scales[t]},distance:function(t,i){var e=i.x-t.x,n=i.y-t.y;return Math.sqrt(e*e+n*n)}}),o.Map=o.Evented.extend({options:{crs:o.CRS.UTMK,fadeAnimation:!0,trackResize:!0,markerZoomAnimation:!0},initialize:function(t,i){i=o.setOptions(this,i),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),i.maxBounds&&this.setMaxBounds(i.maxBounds),i.center&&i.zoom!==e&&this.setView(o.utmk(i.center),i.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this.callInitHooks(),this._addLayers(this.options.layers)},setView:function(t,i){return i=i===e?this.getZoom():i,this._resetView(o.utmk(t),this._limitZoom(i)),this},setZoom:function(t,i){return this._loaded?this.setView(this.getCenter(),t,{zoom:i}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,i){return this.setZoom(this._zoom+(t||1),i)},zoomOut:function(t,i){return this.setZoom(this._zoom-(t||1),i)},setZoomAround:function(t,i,e){var n=this.getZoomScale(i),s=this.getSize().divideBy(2),r=t instanceof o.Point?t:this.utmkToContainerPoint(t),a=r.subtract(s).multiplyBy(1-1/n),h=this.containerPointToUTMK(s.add(a));return this.setView(h,i,{zoom:e})},fitBounds:function(t,i){i=i||{},t=t.getBounds?t.getBounds():o.utmkBounds(t);var e=o.point(i.paddingTopLeft||i.padding||[0,0]),n=o.point(i.paddingBottomRight||i.padding||[0,0]),s=this.getBoundsZoom(t,!1,e.add(n));s=i.maxZoom?Math.min(i.maxZoom,s):s;var r=n.subtract(e).divideBy(2),a=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),u=this.unproject(a.add(h).divideBy(2).add(r),s);return this.setView(u,s,i)},panTo:function(t,i){return this.setView(t,this._zoom,{pan:i})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(o.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=o.utmkBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):this.off("moveend",this._panInsideMaxBounds)},panInsideBounds:function(t,i){var e=this.getCenter(),n=this._limitCenter(e,this._zoom,t);return e.equals(n)?this:this.panTo(n,i)},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var i=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var e=this.getSize(),n=i.divideBy(2).round(),s=e.divideBy(2).round(),r=n.subtract(s);return r.x||r.y?(t.animate&&t.pan?this.panBy(r):(t.pan&&this._rawPanBy(r),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:i,newSize:e})):this},addHandler:function(t,i){if(!i)return this;var e=this[t]=new i(this);return this._handlers.push(e),this.options[t]&&e.enable(),this},remove:function(){this._initEvents("off");try{delete this._container._sop}catch(t){this._container._sop=e}return o.DomUtil.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload"),this},createPane:function(t,i){var e="sop-pane"+(t?" sop-"+t.replace("Pane","")+"-pane":""),n=o.DomUtil.create("div",e,i||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToUTMK(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),i=this.unproject(t.getBottomLeft()),e=this.unproject(t.getTopRight());return new o.UTMKBounds(i,e)},getMinZoom:function(){return this.options.minZoom===e?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===e?this._layersMaxZoom===e?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,i,e){t=o.utmkBounds(t);var n,s=this.getMinZoom()-(i?1:0),r=this.getMaxZoom(),a=this.getSize(),h=t.getNorthWest(),u=t.getSouthEast(),l=!0;e=o.point(e||[0,0]);do s++,n=this.project(u,s).subtract(this.project(h,s)).add(e),l=i?n.x<a.x||n.y<a.y:a.contains(n);while(l&&r>=s);return l&&i?null:i?s:s-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new o.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new o.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPixelWorldBounds:function(){return this.options.crs.getProjectedBounds(this.getZoom())},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var i=this.options.crs;return i.scale(t)/i.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,i){return i=i===e?this._zoom:i,this.options.crs.utmkToPoint(o.utmk(t),i)},unproject:function(t,i){return i=i===e?this._zoom:i,this.options.crs.pointToUTMK(o.point(t),i)},layerPointToUTMK:function(t){var i=o.point(t).add(this.getPixelOrigin());return this.unproject(i)},utmkToLayerPoint:function(t){var i=this.project(o.utmk(t))._round();return i._subtract(this.getPixelOrigin())},wrapUTMK:function(t){return this.options.crs.wrapUTMK(o.utmk(t))},distance:function(t,i){return this.options.crs.distance(o.utmk(t),o.utmk(i))},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToUTMK:function(t){var i=this.containerPointToLayerPoint(o.point(t));return this.layerPointToUTMK(i)},utmkToContainerPoint:function(t){return this.layerPointToContainerPoint(this.utmkToLayerPoint(o.utmk(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToUTMK:function(t){return this.layerPointToUTMK(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var i=this._container=o.DomUtil.get(t);if(!i)throw new Error("Map container not found.");if(i._sop)throw new Error("Map container is already initialized.");i._sop=!0},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&o.Browser.any3d,o.DomUtil.addClass(t,"sop-container"+(o.Browser.touch?" sop-touch":"")+(o.Browser.retina?" sop-retina":"")+(o.Browser.ielt9?" sop-oldie":"")+(o.Browser.safari?" sop-safari":"")+(this._fadeAnimated?" sop-fade-anim":""));var i=o.DomUtil.getStyle(t,"position");"absolute"!==i&&"relative"!==i&&"fixed"!==i&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=this.createPane("mapPane",this._container),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("infowindowPane"),this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,"sop-zoom-hide"),o.DomUtil.addClass(t.shadowPane,"sop-zoom-hide"))},_resetView:function(t,i,e,n){var s=this._zoom!==i;n||(this.fire("movestart"),s&&this.fire("zoomstart")),this._zoom=i,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),e?this._initialTopLeftPoint._add(this._getMapPanePos()):o.DomUtil.setPosition(this._mapPane,new o.Point(0,0));var r=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!e}),r&&this.fire("load"),this.fire("move"),(s||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!e})},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(i){o.DomEvent&&(i=i||"on",o.DomEvent[i](this._container,"click dblclick mousedown mouseup mouseenter mouseleave mousemove contextmenu",this._handleMouseEvent,this),this.options.trackResize&&o.DomEvent[i](t,"resize",this._onResize,this),this.on("absclickstart",function(){this.absClick=!0}),this.on("absclickend",function(){this.absClick=!1}))},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_handleMouseEvent:function(t){this._loaded&&this._fireMouseEvent(this,t,"mouseenter"===t.type?"mouseover":"mouseleave"===t.type?"mouseout":t.type)},_fireMouseEvent:function(t,i,e,n,s){if(e=e||i.type,!o.DomEvent._skipped(i)){if("click"===e){if(!i._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved()))return;t.fire("preclick")}if(t.listens(e,n)){"contextmenu"===e&&o.DomEvent.preventDefault(i),("click"===e||"dblclick"===e||"contextmenu"===e)&&o.DomEvent.stopPropagation(i);var r={originalEvent:i,containerPoint:this.mouseEventToContainerPoint(i)};return r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.utmk=s||this.layerPointToUTMK(r.layerPoint),"click"===e&&this.absClick?void this.fire("click",r,n):void t.fire(e,r,n)}}},_clearHandlers:function(){for(var t=0,i=this._handlers.length;i>t;t++)this._handlers[t].disable()},whenReady:function(t,i){return this._loaded?t.call(i||this,{target:this}):this.on("load",t,i),this},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,i){var e=this.getSize()._divideBy(2);return this.project(t,i)._subtract(e)._round()},_utmkToNewLayerPoint:function(t,i,e){var n=this._getNewTopLeftPoint(e,i).add(this._getMapPanePos());return this.project(t,i)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.utmkToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,i,e){if(!e)return t;var n=this.project(t,i),s=this.getSize().divideBy(2),r=new o.Bounds(n.subtract(s),n.add(s)),a=this._getBoundsOffset(r,e,i);return this.unproject(n.add(a),i)},_limitOffset:function(t,i){if(!i)return t;var e=this.getPixelBounds(),n=new o.Bounds(e.min.add(t),e.max.add(t));return t.add(this._getBoundsOffset(n,i))},_getBoundsOffset:function(t,i,e){var n=this.project(i.getNorthWest(),e).subtract(t.min),s=this.project(i.getSouthEast(),e).subtract(t.max),r=this._rebound(n.x,-s.x),a=this._rebound(n.y,-s.y);return new o.Point(r,a)},_rebound:function(t,i){return t+i>0?Math.round(t-i)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(i))},_limitZoom:function(t){var i=this.getMinZoom(),e=this.getMaxZoom();return Math.max(i,Math.min(e,t))}}),o.map=function(t,i){return new o.Map(t,i)},o.Layer=o.Evented.extend({options:{pane:"overlayPane"},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},_layerAdd:function(t){var i=t.target;i.hasLayer(this)&&(this._map=i,this._zoomAnimated=i._zoomAnimated,this.onAdd(i),this.getAttribution&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution()),this.getEvents&&i.on(this.getEvents(),this),this.fire("add"),i.fire("layeradd",{layer:this}))}}),o.Map.include({addLayer:function(t){var i=o.stamp(t);return this._layers[i]?t:(this._layers[i]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var i=o.stamp(t);return this._layers[i]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),t.getEvents&&this.off(t.getEvents(),t),delete this._layers[i],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&o.stamp(t)in this._layers},eachLayer:function(t,i){for(var e in this._layers)t.call(i,this._layers[e]);return this},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var i=0,e=t.length;e>i;i++)this.addLayer(t[i])},_addZoomLimit:function(t){(isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[o.stamp(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var i=o.stamp(t);this._zoomBoundLayers[i]&&(delete this._zoomBoundLayers[i],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,i=-1/0,n=this._getZoomSpan();for(var o in this._zoomBoundLayers){var s=this._zoomBoundLayers[o].options;t=s.minZoom===e?t:Math.min(t,s.minZoom),i=s.maxZoom===e?i:Math.max(i,s.maxZoom)}this._layersMaxZoom=i===-1/0?e:i,this._layersMinZoom=1/0===t?e:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange")}}),o.GridLayer=o.Layer.extend({options:{pane:"tilePane",tileSize:256,opacity:1,unloadInvisibleTiles:o.Browser.mobile,updateWhenIdle:o.Browser.mobile,updateInterval:150},initialize:function(t){t=o.setOptions(this,t)},onAdd:function(){this._initContainer(),this.options.updateWhenIdle||(this._update=o.Util.throttle(this._update,this.options.updateInterval,this)),this._reset(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._clearBgBuffer(),o.DomUtil.remove(this._container),t._removeZoomLimit(this),this._container=null},bringToFront:function(){return this._map&&(o.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this
},bringToBack:function(){return this._map&&(o.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},getEvents:function(){var t={viewreset:this._reset,moveend:this._update};return this.options.updateWhenIdle||(t.move=this._update),this._zoomAnimated&&(t.zoomstart=this._startZoomAnim,t.zoomanim=this._animateZoom,t.zoomend=this._endZoomAnim),t},_updateZIndex:function(){this._container&&this.options.zIndex!==e&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var i,e=this.getPane().children,n=-t(-1/0,1/0),o=0,s=e.length;s>o;o++)i=e[o].style.zIndex,e[o]!==this._container&&i&&(n=t(n,+i));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){var t=this.options.opacity;if(o.Browser.ielt9)for(var i in this._tiles)o.DomUtil.setOpacity(this._tiles[i],t);else o.DomUtil.setOpacity(this._container,t)},_initContainer:function(){if(!this._container){if(this._container=o.DomUtil.create("div","sop-layer"),this._updateZIndex(),this._zoomAnimated){var t="sop-tile-container sop-zoom-animated";this._bgBuffer=o.DomUtil.create("div",t,this._container),this._tileContainer=o.DomUtil.create("div",t,this._container),o.DomUtil.setTransform(this._tileContainer)}else this._tileContainer=this._container;this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container)}},_reset:function(t){for(var i in this._tiles)this.fire("tileunload",{tile:this._tiles[i]});this._tiles={},this._tilesToLoad=0,this._tilesTotal=0,o.DomUtil.empty(this._tileContainer),this._zoomAnimated&&t&&t.hard&&this._clearBgBuffer(),this._tileNumBounds=this._getTileNumBounds(),this._resetWrap()},_resetWrap:function(){var t=this._map,i=t.options.crs;if(!i.infinite){var e=this._getTileSize();i.wrapX&&(this._wrapLng=[Math.floor(t.project([i.wrapX[0],0]).x/e),Math.ceil(t.project([i.wrapX[1],0]).x/e)]),i.wrapY&&(this._wrapLat=[Math.floor(t.project([0,i.wrapY[0]]).y/e),Math.ceil(t.project([0,i.wrapY[1]]).y/e)])}},_getTileSize:function(){return this.options.tileSize},_update:function(){if(this._map){var t=this._map.getPixelBounds(),i=this._map.getZoom(),e=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var n=o.bounds(t.min.divideBy(e).floor(),t.max.divideBy(e).floor());this._addTiles(n),this.options.unloadInvisibleTiles&&this._removeOtherTiles(n)}}},_addTiles:function(t){var e,n,s,r=[],a=t.getCenter(),h=this._map.getZoom();for(e=t.min.y;e<=t.max.y;e++)for(n=t.min.x;n<=t.max.x;n++)s=new o.Point(n,e),s.z=h,this._tileCoordsToKey(s)in this._tiles||!this._isValidTile(s)||r.push(s);var u=r.length;if(0!==u){this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=u,this._tilesTotal+=u,r.sort(function(t,i){return t.distanceTo(a)-i.distanceTo(a)});var l=i.createDocumentFragment();for(n=0;u>n;n++)this._addTile(r[n],l);this._tileContainer.appendChild(l)}},_isValidTile:function(t){var i=this._map.options.crs;if(!i.infinite){var e=this._tileNumBounds;if(!i.wrapX&&(t.x<e.min.x||t.x>e.max.x)||!i.wrapY&&(t.y<e.min.y||t.y>e.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return o.utmkBounds(this.options.bounds).intersects(n)},_tileCoordsToBounds:function(t){var i=this._map,e=this._getTileSize(),n=t.multiplyBy(e),s=n.add([e,e]),r=i.wrapUTMK(i.unproject(n,t.z)),a=i.wrapUTMK(i.unproject(s,t.z));return new o.UTMKBounds(r,a)},_tileCoordsToKey:function(t){return t.x+":"+t.y},_keyToTileCoords:function(t){var i=t.split(":"),e=parseInt(i[0],10),n=parseInt(i[1],10);return new o.Point(e,n)},_removeOtherTiles:function(t){for(var i in this._tiles)t.contains(this._keyToTileCoords(i))||this._removeTile(i)},_removeTile:function(t){var i=this._tiles[t];o.DomUtil.remove(i),delete this._tiles[t],this.fire("tileunload",{tile:i})},_initTile:function(t){var i=this._getTileSize();o.DomUtil.addClass(t,"sop-tile"),t.style.width=i+"px",t.style.height=i+"px",t.onselectstart=o.Util.falseFn,t.onmousemove=o.Util.falseFn,o.Browser.ielt9&&this.options.opacity<1&&o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.android&&!o.Browser.android23&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,i){var e=this._getTilePos(t);this._wrapCoords(t);var n=this.createTile(t,o.bind(this._tileReady,this));this._initTile(n),this.createTile.length<2&&setTimeout(o.bind(this._tileReady,this,null,n),0),o.DomUtil.setPosition(n,e,!0),this._tiles[this._tileCoordsToKey(t)]=n,i.appendChild(n),this.fire("tileloadstart",{tile:n})},_tileReady:function(t,i){t&&this.fire("tileerror",{error:t,tile:i}),o.DomUtil.addClass(i,"sop-tile-loaded"),this.fire("tileload",{tile:i}),this._tilesToLoad--,0===this._tilesToLoad&&this._visibleTilesReady()},_visibleTilesReady:function(){this.fire("load"),this._zoomAnimated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(o.bind(this._clearBgBuffer,this),300))},_getTilePos:function(t){return t.multiplyBy(this._getTileSize()).subtract(this._map.getPixelOrigin())},_wrapCoords:function(t){t.x=this._wrapLng?o.Util.wrapNum(t.x,this._wrapLng):t.x,t.y=this._wrapLat?o.Util.wrapNum(t.y,this._wrapLat):t.y},_getTileNumBounds:function(){var t=this._map.getPixelWorldBounds(),i=this._getTileSize();return t?o.bounds(t.min.divideBy(i).floor(),t.max.divideBy(i).ceil().subtract([1,1])):null},_startZoomAnim:function(){this._prepareBgBuffer(),this._prevTranslate=this._translate||new o.Point(0,0),this._prevScale=this._scale},_animateZoom:function(t){this._translate=this._prevTranslate.multiplyBy(t.scale).add(t.origin.multiplyBy(1-t.scale)),this._scale=this._prevScale*t.scale,o.DomUtil.setTransform(this._bgBuffer,this._translate,this._scale)},_endZoomAnim:function(){var t=this._tileContainer;t.style.visibility="",o.DomUtil.toFront(t)},_clearBgBuffer:function(){var t=this._map,i=this._bgBuffer;t&&!t._animatingZoom&&i&&(o.DomUtil.empty(i),o.DomUtil.setTransform(i))},_prepareBgBuffer:function(){var t=this._tileContainer,i=this._bgBuffer;return this._abortLoading&&this._abortLoading(),this._tilesToLoad/this._tilesTotal>.5?void(t.style.visibility="hidden"):(i.style.visibility="hidden",o.DomUtil.setTransform(i),this._tileContainer=i,this._bgBuffer=t,this._translate=new o.Point(0,0),this._scale=1,void clearTimeout(this._clearBgBufferTimer))}}),o.gridLayer=function(t){return new o.GridLayer(t)},o.TileLayer=o.GridLayer.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",zoomOffset:0},initialize:function(t,i){this._url=t,i=o.setOptions(this,i),i.detectRetina&&o.Browser.retina&&i.maxZoom>0&&(i.tileSize=Math.floor(i.tileSize/2),i.zoomOffset++,i.minZoom=Math.max(0,i.minZoom),i.maxZoom--),"string"==typeof i.subdomains&&(i.subdomains=i.subdomains.split(""))},setUrl:function(t,i){return this._url=t,i||this.redraw(),this},createTile:function(t,e){var n=i.createElement("img");return n.onload=o.bind(this._tileOnLoad,this,e,n),n.onerror=o.bind(this._tileOnError,this,e,n),this.options.crossOrigin&&(n.crossOrigin=""),n.alt="",n.src=this.getTileUrl(t),n},getTileUrl:function(t){return o.Util.template(this._url,o.extend({r:this.options.detectRetina&&o.Browser.retina&&this.options.maxZoom>0?"@2x":"",s:this._getSubdomain(t),x:t.x,y:this.options.tms?this._tileNumBounds.max.y-t.y:t.y,z:this._getZoomForUrl()},this.options))},_tileOnLoad:function(t,i){t(null,i)},_tileOnError:function(t,i,e){var n=this.options.errorTileUrl;n&&(i.src=n),t(e,i)},_getTileSize:function(){var t=this._map,i=this.options,e=t.getZoom()+i.zoomOffset,n=i.maxNativeZoom;return n&&e>n?Math.round(t.getZoomScale(e)/t.getZoomScale(n)*i.tileSize):i.tileSize},_removeTile:function(t){var i=this._tiles[t];o.GridLayer.prototype._removeTile.call(this,t),o.Browser.android||(i.onload=null,i.src=o.Util.emptyImageUrl)},_getZoomForUrl:function(){var t=this.options,i=this._map.getZoom();return t.zoomReverse&&(i=t.maxZoom-i),i+=t.zoomOffset,t.maxNativeZoom?Math.min(i,t.maxNativeZoom):i},_getSubdomain:function(t){var i=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[i]},_abortLoading:function(){var t,i;for(t in this._tiles)i=this._tiles[t],i.complete||(i.onload=o.Util.falseFn,i.onerror=o.Util.falseFn,i.src=o.Util.emptyImageUrl,o.DomUtil.remove(i))}}),o.tileLayer=function(t,i){return new o.TileLayer(t,i)},o.BuildingLayer=o.GridLayer.extend({options:{minZoom:0,maxZoom:20},createTile:function(){var t=i.createElement("div");return t.style.background="white",t}}),o.Map.mergeOptions({buildingLayer:!0}),o.Map.addInitHook(function(){this.options.buildingLayer&&(o.Map.mergeOptions({crs:o.CRS.UTMK,maxBounds:o.CRS.UTMK.projection.utmkBounds}),this.buildingLayer=(new o.BuildingLayer).addTo(this))}),o.ImageOverlay=o.Layer.extend({options:{opacity:1,alt:""},initialize:function(t,i,e){this._url=t,this._bounds=o.utmkBounds(i),o.setOptions(this,e)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){o.DomUtil.remove(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},bringToFront:function(){return this._map&&o.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&o.DomUtil.toBack(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},getAttribution:function(){return this.options.attribution},getEvents:function(){var t={viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},_initImage:function(){var t=this._image=o.DomUtil.create("img","sop-image-layer "+(this._zoomAnimated?"sop-zoom-animated":""));t.onselectstart=o.Util.falseFn,t.onmousemove=o.Util.falseFn,t.onload=o.bind(this.fire,this,"load"),t.src=this._url,t.alt=this.options.alt},_animateZoom:function(t){var i=this._map._utmkToNewLayerPoint(this._bounds.getNorthWest(),t.zoom,t.center),e=this._map._utmkToNewLayerPoint(this._bounds.getSouthEast(),t.zoom,t.center).subtract(i),n=i.add(e._multiplyBy((1-1/t.scale)/2));o.DomUtil.setTransform(this._image,n,t.scale)},_reset:function(){var t=this._image,i=new o.Bounds(this._map.utmkToLayerPoint(this._bounds.getNorthWest()),this._map.utmkToLayerPoint(this._bounds.getSouthEast())),e=i.getSize();o.DomUtil.setPosition(t,i.min),t.style.width=e.x+"px",t.style.height=e.y+"px"},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,i,e){return new o.ImageOverlay(t,i,e)},o.Icon=o.Class.extend({initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,i){var e=this._getIconUrl(t);if(!e){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(e,i&&"IMG"===i.tagName?i:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,i){var e=this.options,n=o.point(e[i+"Size"]),s=o.point("shadow"===i&&e.shadowAnchor||e.iconAnchor||n&&n.divideBy(2,!0));t.className="sop-marker-"+i+" "+(e.className||""),s&&(t.style.marginLeft=-s.x+"px",t.style.marginTop=-s.y+"px"),n&&(t.style.width=n.x+"px",t.style.height=n.y+"px")},_createImg:function(t,e){return e=e||i.createElement("img"),e.src=t,e},_getIconUrl:function(t){return o.Browser.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],infoWindowAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var i=t+"Url";if(this.options[i])return this.options[i];var e=o.Const.IMAGE_PATH;if(!e)throw new Error("Couldn't autodetect sop.Const.imagePath, set it manually.");return e+"/marker-"+t+(o.Browser.retina&&"icon"===t?"-2x":"")+".png"}}),o.Marker=o.Layer.extend({options:{pane:"markerPane",icon:new o.Icon.Default,clickable:!0,keyboard:!0,zIndexOffset:0,opacity:1,riseOffset:250},initialize:function(t,i){o.setOptions(this,i),this._utmk=o.utmk(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._initIcon(),this.update()},onRemove:function(){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.removeCaption()},getEvents:function(){var t={viewreset:this.update};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},getUTMK:function(){return this._utmk},setUTMK:function(t){var i=this._utmk;return this._utmk=o.utmk(t),this.update(),this.fire("move",{oldUtmk:i,utmk:this._utmk})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._infoWindow&&this.bindInfoWindow(this._infoWindow),this},update:function(){if(this._icon){var t=this._map.utmkToLayerPoint(this._utmk).round();this._setPos(t)}return this._updateCaptionPos(),this},_initIcon:function(){var t=this.options,i="sop-zoom-"+(this._zoomAnimated?"animated":"hide"),e=t.icon.createIcon(this._icon),n=!1;e!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(e.title=t.title),t.alt&&(e.alt=t.alt)),o.DomUtil.addClass(e,i),t.keyboard&&(e.tabIndex="0"),this._icon=e,this._initInteraction(),t.riseOnHover&&o.DomEvent.on(e,{mouseover:this._bringToFront,mouseout:this._resetZIndex},this);var s=t.icon.createShadow(this._shadow),r=!1;s!==this._shadow&&(this._removeShadow(),r=!0),s&&o.DomUtil.addClass(s,i),this._shadow=s,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),s&&r&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&o.DomEvent.off(this._icon,{mouseover:this._bringToFront,mouseout:this._resetZIndex},this),o.DomUtil.remove(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&o.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&&o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var i=this._map._utmkToNewLayerPoint(this._utmk,t.zoom,t.center).round();this._setPos(i),this._updateCaptionPos(t)},_initInteraction:function(){this.options.clickable&&(o.DomUtil.addClass(this._icon,"sop-clickable"),o.DomEvent.on(this._icon,"click dblclick mousedown mouseup mouseover mouseout contextmenu keypress",this._fireMouseEvent,this),o.Handler.MarkerDrag&&(this.dragging=new o.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable()))},_fireMouseEvent:function(t,i){"mousedown"===t.type&&o.DomEvent.preventDefault(t),"click"===t.type&&this.dragging&&this.dragging.moved()||("keypress"===t.type&&13===t.keyCode&&(i="click"),this._map&&this._map._fireMouseEvent(this,t,i,!0,this._utmk))},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;o.DomUtil.setOpacity(this._icon,t),this._shadow&&o.DomUtil.setOpacity(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},setCaption:function(t){this.captionObj=new o.Caption(this,this._utmk,t)},_updateCaptionPos:function(t){this.captionObj&&this.captionObj._updateCaptionPos(this._utmk,t)},getCaption:function(){return this.captionObj._getCaption()},removeCaption:function(){this.captionObj&&(this.captionObj._removeCaption(),this._catpionObj=null)}}),o.marker=function(t,i){return new o.Marker(t,i)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],className:"sop-div-icon",html:!1},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:i.createElement("div"),n=this.options;return e.innerHTML=n.html!==!1?n.html:"",n.bgPos&&(e.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(e,"icon"),e},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.Map.mergeOptions({closeInfoWindowOnClick:!0}),o.InfoWindow=o.Layer.extend({options:{pane:"infowindowPane",minWidth:50,maxWidth:300,offset:[0,7],autoPan:!0,autoPanPadding:[5,5],closeButton:!0,zoomAnimation:!0},initialize:function(t,i){o.setOptions(this,t),this._source=i},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&this.options.zoomAnimation,this._container||this._initLayout(),t._fadeAnimated&&o.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&o.DomUtil.setOpacity(this._container,1),t.fire("infowindowopen",{infoWindow:this}),this._source&&this._source.fire("infowindowopen",{infoWindow:this},!0)},openOn:function(t){return t.openInfoWindow(this),this},onRemove:function(t){t._fadeAnimated?(o.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(o.bind(o.DomUtil.remove,o.DomUtil,this._container),200)):o.DomUtil.remove(this._container),t.fire("infowindowclose",{infoWindow:this}),this._source&&this._source.fire("infowindowclose",{infoWindow:this},!0)},getUTMK:function(){return this._utmk},setUTMK:function(t){return this._utmk=o.utmk(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={viewreset:this._updatePosition},i=this.options;return this._zoomAnimated&&(t.zoomanim=this._animateZoom),("closeOnClick"in i?i.closeOnClick:this._map.options.closeInfoWindowOnClick)&&(t.preclick=this._close),i.keepInView&&(t.moveend=this._adjustPan),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},_close:function(){this._map&&this._map.closeInfoWindow(this)},_initLayout:function(){var t="sop-infowindow",i=this._container=o.DomUtil.create("div",t+" "+(this.options.className||"")+" sop-zoom-"+(this._zoomAnimated?"animated":"hide"));if(this.options.closeButton){var e=this._closeButton=o.DomUtil.create("a",t+"-close-button",i);e.href="#close",e.innerHTML="&#215;",o.DomEvent.on(e,"click",this._onCloseButtonClick,this)}var n=this._wrapper=o.DomUtil.create("div",t+"-content-wrapper",i);this._contentNode=o.DomUtil.create("div",t+"-content",n),o.DomEvent.disableClickPropagation(n).disableScrollPropagation(this._contentNode).on(n,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",t+"-tip-container",i),this._tip=o.DomUtil.create("div",t+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){var t=this._contentNode;if("string"==typeof this._content)t.innerHTML=this._content;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,i=t.style;i.width="",i.whiteSpace="nowrap";var e=t.offsetWidth;e=Math.min(e,this.options.maxWidth),e=Math.max(e,this.options.minWidth),i.width=e+1+"px",i.whiteSpace="",i.height="";var n=t.offsetHeight,s=this.options.maxHeight,r="sop-infowindow-scrolled";s&&n>s?(i.height=s+"px",o.DomUtil.addClass(t,r)):o.DomUtil.removeClass(t,r),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.utmkToLayerPoint(this._utmk),i=o.point(this.options.offset);this._zoomAnimated?o.DomUtil.setPosition(this._container,t):i=i.add(t);var e=this._containerBottom=-i.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+i.x;this._container.style.bottom=e+"px",this._container.style.left=n+"px"}},_animateZoom:function(t){var i=this._map._utmkToNewLayerPoint(this._utmk,t.zoom,t.center);o.DomUtil.setPosition(this._container,i)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,i=this._container.offsetHeight,e=this._containerWidth,n=new o.Point(this._containerLeft,-i-this._containerBottom);this._zoomAnimated&&n._add(o.DomUtil.getPosition(this._container));var s=t.layerPointToContainerPoint(n),r=o.point(this.options.autoPanPadding),a=o.point(this.options.autoPanPaddingTopLeft||r),h=o.point(this.options.autoPanPaddingBottomRight||r),u=t.getSize(),l=0,c=0;s.x+e+h.x>u.x&&(l=s.x+e-u.x+h.x),s.x-l-a.x<0&&(l=s.x-a.x),s.y+i+h.y>u.y&&(c=s.y+i-u.y+h.y),s.y-c-a.y<0&&(c=s.y-a.y),(l||c)&&t.fire("autopanstart").panBy([l,c])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)}}),o.infoWindow=function(t,i){return new o.InfoWindow(t,i)},o.Map.include({openInfoWindow:function(t,i,e){if(!(t instanceof o.InfoWindow)){var n=t;t=new o.InfoWindow(e).setContent(n)}return i&&t.setUTMK(i),this.hasLayer(t)?this:(this.closeInfoWindow(),this._infoWindow=t,this.addLayer(t))},closeInfoWindow:function(t){return t&&t!==this._infoWindow||(t=this._infoWindow,this._infoWindow=null),t&&this.removeLayer(t),this}}),o.Layer.include({bindInfoWindow:function(t,i){return t instanceof o.InfoWindow?(this._infoWindow=t,t._source=this):((!this._infoWindow||i)&&(this._infoWindow=new o.InfoWindow(i,this)),this._infoWindow.setContent(t)),this._infoWindowHandlersAdded||(this.on({click:this._openInfoWindow,remove:this.closeInfoWindow,move:this._moveInfoWindow}),this._infoWindowHandlersAdded=!0),this},unbindInfoWindow:function(){return this._infoWindow&&(this.on({click:this._openInfoWindow,remove:this.closeInfoWindow,move:this._moveInfoWindow}),this._infoWindowHandlersAdded=!1,this._infoWindow=null),this},openInfoWindow:function(t){return this._infoWindow&&this._map&&this._map.openInfoWindow(this._infoWindow,t||this._utmk||this.getCenter()),this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow._close(),this},toggleInfoWindow:function(){return this._infoWindow&&(this._infoWindow._map?this.closeInfoWindow():this.openInfoWindow()),this},setInfoWindowContent:function(t){return this._infoWindow&&this._infoWindow.setContent(t),this},getInfoWindow:function(){return this._infoWindow},_openInfoWindow:function(t){this._map.openInfoWindow(this._infoWindow,t.utmk)},_moveInfoWindow:function(t){this._infoWindow.setUTMK(t.utmk)}}),o.Marker.include({bindInfoWindow:function(t,i){var e=o.point(this.options.icon.options.infoWindowAnchor||[0,0]).add(o.InfoWindow.prototype.options.offset);return i=o.extend({offset:e},i),o.Layer.prototype.bindInfoWindow.call(this,t,i)},_openInfoWindow:o.Layer.prototype.toggleInfoWindow}),o.LayerGroup=o.Layer.extend({initialize:function(t){this._layers={};var i,e;if(t)for(i=0,e=t.length;e>i;i++)this.addLayer(t[i])},addLayer:function(t){var i=this.getLayerId(t);return this._layers[i]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var i=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[i]&&this._map.removeLayer(this._layers[i]),delete this._layers[i],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){for(var t in this._layers)this.removeLayer(this._layers[t]);return this},invoke:function(t){var i,e,n=Array.prototype.slice.call(arguments,1);for(i in this._layers)e=this._layers[i],e[t]&&e[t].apply(e,n);return this},onAdd:function(t){for(var i in this._layers)t.addLayer(this._layers[i])},onRemove:function(t){for(var i in this._layers)t.removeLayer(this._layers[i])},eachLayer:function(t,i){for(var e in this._layers)t.call(i,this._layers[e]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var i in this._layers)t.push(this._layers[i]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),o.LayerGroup.prototype.addLayer.call(this,t),this._infoWindowContent&&t.bindInfoWindow&&t.bindInfoWindow(this._infoWindowContent,this._infoWindowOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),o.LayerGroup.prototype.removeLayer.call(this,t),this._infoWindowContent&&this.invoke("unbindInfoWindow"),this.fire("layerremove",{layer:t})):this},bindInfoWindow:function(t,i){return this._infoWindowContent=t,this._infoWindowOptions=i,this.invoke("bindInfoWindow",t,i)},openInfoWindow:function(t){for(var i in this._layers){this._layers[i].openInfoWindow(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.UTMKBounds;return this.eachLayer(function(i){t.extend(i.getBounds?i.getBounds():i.getUTMK())}),t}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Renderer=o.Layer.extend({options:{padding:0},initialize:function(t){o.setOptions(this,t),o.stamp(this)},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&o.DomUtil.addClass(this._container,"sop-zoom-animated")),this.getPane().appendChild(this._container),this._update()},onRemove:function(){o.DomUtil.remove(this._container)},getEvents:function(){var t={moveend:this._update};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},_animateZoom:function(t){var i=t.origin.subtract(this._map._getCenterLayerPoint()),e=this._bounds.min.add(i.multiplyBy(1-t.scale));o.DomUtil.setTransform(this._container,e,t.scale)},_update:function(){var t=this.options.padding,i=this._map.getSize(),e=this._map.containerPointToLayerPoint(i.multiplyBy(-t)).round();this._bounds=new o.Bounds(e,e.add(i.multiplyBy(1+2*t)).round())}}),o.Map.include({getRenderer:function(t){var i=t.options.renderer||this.options.renderer||this._renderer;return i||(i=this._renderer=o.SVG&&o.svg()||o.Canvas&&o.canvas()),this.hasLayer(i)||this.addLayer(i),i}}),o.Path=o.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",fillOpacity:.2,clickable:!0},onAdd:function(){this._renderer=this._map.getRenderer(this),this._renderer._initPath(this),this._project(),this._update(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},getEvents:function(){return{viewreset:this._project,moveend:this._update}},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return o.setOptions(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer._bringToBack(this),this},_fireMouseEvent:function(t,i){this._map._fireMouseEvent(this,t,i,!0)},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(o.Browser.touch?10:0)}}),o.LineUtil={simplify:function(t,i){if(!i||!t.length)return t.slice();var e=i*i;return t=this._reducePoints(t,e),t=this._simplifyDP(t,e)},pointToSegmentDistance:function(t,i,e){return Math.sqrt(this._sqClosestPointOnSegment(t,i,e,!0))},closestPointOnSegment:function(t,i,e){return this._sqClosestPointOnSegment(t,i,e)},_simplifyDP:function(t,i){var n=t.length,o=typeof Uint8Array!=e+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,i,0,n-1);var r,a=[];for(r=0;n>r;r++)s[r]&&a.push(t[r]);return a},_simplifyDPStep:function(t,i,e,n,o){var s,r,a,h=0;for(r=n+1;o-1>=r;r++)a=this._sqClosestPointOnSegment(t[r],t[n],t[o],!0),a>h&&(s=r,h=a);h>e&&(i[s]=1,this._simplifyDPStep(t,i,e,n,s),this._simplifyDPStep(t,i,e,s,o))},_reducePoints:function(t,i){for(var e=[t[0]],n=1,o=0,s=t.length;s>n;n++)this._sqDist(t[n],t[o])>i&&(e.push(t[n]),o=n);return s-1>o&&e.push(t[s-1]),e},clipSegment:function(t,i,e,n){var o,s,r,a=n?this._lastCode:this._getBitCode(t,e),h=this._getBitCode(i,e);for(this._lastCode=h;;){if(!(a|h))return[t,i];if(a&h)return!1;o=a||h,s=this._getEdgeIntersection(t,i,o,e),r=this._getBitCode(s,e),o===a?(t=s,a=r):(i=s,h=r)}},_getEdgeIntersection:function(t,i,e,n){var s,r,a=i.x-t.x,h=i.y-t.y,u=n.min,l=n.max;return 8&e?(s=t.x+a*(l.y-t.y)/h,r=l.y):4&e?(s=t.x+a*(u.y-t.y)/h,r=u.y):2&e?(s=l.x,r=t.y+h*(l.x-t.x)/a):1&e&&(s=u.x,r=t.y+h*(u.x-t.x)/a),new o.Point(s,r,!0)},_getBitCode:function(t,i){var e=0;return t.x<i.min.x?e|=1:t.x>i.max.x&&(e|=2),t.y<i.min.y?e|=4:t.y>i.max.y&&(e|=8),e},_sqDist:function(t,i){var e=i.x-t.x,n=i.y-t.y;return e*e+n*n},_sqClosestPointOnSegment:function(t,i,e,n){var s,r=i.x,a=i.y,h=e.x-r,u=e.y-a,l=h*h+u*u;return l>0&&(s=((t.x-r)*h+(t.y-a)*u)/l,s>1?(r=e.x,a=e.y):s>0&&(r+=h*s,a+=u*s)),h=t.x-r,u=t.y-a,n?h*h+u*u:new o.Point(r,a)}},o.Polyline=o.Path.extend({options:{smoothFactor:1},initialize:function(t,i){o.setOptions(this,i),this._setUTMKs(t)},getUTMKs:function(){return this._utmks},setUTMKs:function(t){return this._setUTMKs(t),this.redraw()},addUTMK:function(t){return t=o.utmk(t),this._utmks.push(t),this._bounds.extend(t),this.redraw()},spliceUTMKs:function(){var t=[].splice.apply(this._utmks,arguments);return this._setUTMKs(this._utmks),this.redraw(),t},closestLayerPoint:function(t){for(var i,e,n=1/0,s=null,r=o.LineUtil._sqClosestPointOnSegment,a=0,h=this._parts.length;h>a;a++)for(var u=this._parts[a],l=1,c=u.length;c>l;l++){i=u[l-1],e=u[l];var d=r(t,i,e,!0);n>d&&(n=d,s=r(t,i,e))}return s&&(s.distance=Math.sqrt(n)),s},getCenter:function(){var t,i,e,n,o,s,r,a=this._rings[0],h=a.length;for(t=0,i=0;h-1>t;t++)i+=a[t].distanceTo(a[t+1])/2;for(t=0,n=0;h-1>t;t++)if(o=a[t],s=a[t+1],e=o.distanceTo(s),n+=e,n>i)return r=(n-i)/e,this._map.layerPointToUTMK([s.x-r*(s.x-o.x),s.y-r*(s.y-o.y)])},getBounds:function(){return this._bounds},_setUTMKs:function(t){this._bounds=new o.UTMKBounds,this._utmks=this._convertUTMKs(t)},_convertUTMKs:function(t){for(var i=[],e=this._flat(t),n=0,s=t.length;s>n;n++)e?(i[n]=o.utmk(t[n]),this._bounds.extend(i[n])):i[n]=this._convertUTMKs(t[n]);return i},_flat:function(t){return!o.Util.isArray(t[0])||"object"!=typeof t[0][0]},_project:function(){this._rings=[],this._projectUTMKs(this._utmks,this._rings);var t=this._clickTolerance(),i=new o.Point(t,-t);this._utmks.length&&(this._pxBounds=new o.Bounds(this._map.utmkToLayerPoint(this._bounds.getSouthWest())._subtract(i),this._map.utmkToLayerPoint(this._bounds.getNorthEast())._add(i)))},_projectUTMKs:function(t,i){var e,n,s=t[0]instanceof o.UTMK,r=t.length;if(s){for(n=[],e=0;r>e;e++)n[e]=this._map.utmkToLayerPoint(t[e]);i.push(n)}else for(e=0;r>e;e++)this._projectUTMKs(t[e],i)},_clipPoints:function(){if(this.options.noClip)return void(this._parts=this._rings);this._parts=[];var t,i,e,n,s,r,a,h=this._parts,u=this._renderer._bounds;for(t=0,e=0,n=this._rings.length;n>t;t++)for(a=this._rings[t],i=0,s=a.length;s-1>i;i++)r=o.LineUtil.clipSegment(a[i],a[i+1],u,i),r&&(h[e]=h[e]||[],h[e].push(r[0]),(r[1]!==a[i+1]||i===s-2)&&(h[e].push(r[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,i=this.options.smoothFactor,e=0,n=t.length;n>e;e++)t[e]=o.LineUtil.simplify(t[e],i)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}}),o.polyline=function(t,i){return new o.Polyline(t,i)},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,i){var e,n,s,r,a,h,u,l,c,d=[1,4,2,8],m=o.LineUtil;for(n=0,u=t.length;u>n;n++)t[n]._code=m._getBitCode(t[n],i);for(r=0;4>r;r++){for(l=d[r],e=[],n=0,u=t.length,s=u-1;u>n;s=n++)a=t[n],h=t[s],a._code&l?h._code&l||(c=m._getEdgeIntersection(h,a,l,i),c._code=m._getBitCode(c,i),e.push(c)):(h._code&l&&(c=m._getEdgeIntersection(h,a,l,i),c._code=m._getBitCode(c,i),e.push(c)),e.push(a));t=e}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},getCenter:function(){var t,i,e,n,o,s,r,a,h,u=this._rings[0];for(r=a=h=0,t=0,e=u.length,i=e-1;e>t;i=t++)n=u[t],o=u[i],s=n.y*o.x-o.y*n.x,a+=(n.x+o.x)*s,h+=(n.y+o.y)*s,r+=3*s;
return this._map.layerPointToUTMK([a/r,h/r])},_getArea:function(){var t,i,e,n,o,s,r;for(points=this._rings[0],r=0,t=0,e=points.length,i=e-1;e>t;i=t++)n=points[t],o=points[i],s=n.y*o.x-o.y*n.x,r+=3*s;return r},_convertUTMKs:function(t){var i=o.Polyline.prototype._convertUTMKs.call(this,t),e=i.length;return e>=2&&i[0]instanceof o.UTMK&&i[0].equals(i[e-1])&&i.pop(),i},_clipPoints:function(){if(this.options.noClip)return void(this._parts=this._rings);var t=this._renderer._bounds,i=this.options.weight,e=new o.Point(i,i);t=new o.Bounds(t.min.subtract(e),t.max.add(e)),this._parts=[];for(var n,s=0,r=this._rings.length;r>s;s++)n=o.PolyUtil.clipPolygon(this._rings[s],t),n.length&&this._parts.push(n)},_updatePath:function(){this._renderer._updatePoly(this,!0),this._updateCaptionPos()},setCaption:function(t){this.captionObj=new o.Caption(this,this.getCenter(),t)},_updateCaptionPos:function(t){if(this.captionObj){var i=this._getArea();if(200>i)this.captionObj._captionDiv.style.display="none";else{var e=this.getCenter();this.captionObj._captionDiv.style.display="block",this.captionObj._updateCaptionPos(e,t)}}},getCaption:function(){return this.captionObj._getCaption()},removeCaption:function(){this.captionObj&&(this.captionObj._removeCaption(),this._catpionObj=null)},getEvents:function(){var t={viewreset:this._project,moveend:this._update};return t.zoomanim=this._updateCaptionPos,t},onRemove:function(){this._renderer._removePath(this),this.removeCaption()}}),o.polygon=function(t,i){return new o.Polygon(t,i)},o.Rectangle=o.Polygon.extend({initialize:function(t,i){o.Polygon.prototype.initialize.call(this,this._boundsToUTMKs(t),i)},setBounds:function(t){this.setUTMKs(this._boundsToUTMKs(t))},_boundsToUTMKs:function(t){return t=o.utmkBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,i){return new o.Rectangle(t,i)},o.CircleMarker=o.Path.extend({options:{fill:!0,radius:10},initialize:function(t,i){o.setOptions(this,i),this._utmk=o.utmk(t),this._radius=this.options.radius},setUTMK:function(t){return this._utmk=o.utmk(t),this.redraw(),this.fire("move",{utmk:this._utmk})},getUTMK:function(){return this._utmk},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var i=t&&t.radius||this._radius;return o.Path.prototype.setStyle.call(this,t),this.setRadius(i),this},_project:function(){this._point=this._map.utmkToLayerPoint(this._utmk),this._updateBounds()},_updateBounds:function(){var t=this._radius,i=this._radiusY||t,e=this._clickTolerance(),n=[t+e,i+e];this._pxBounds=new o.Bounds(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this),this._updateCaptionPos()},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},setCaption:function(t){this.captionObj=new o.Caption(this,this._utmk,t)},_updateCaptionPos:function(t){this.captionObj&&this.captionObj._updateCaptionPos(this._utmk,t)},getCaption:function(){return this.captionObj._getCaption()},removeCaption:function(){this.captionObj&&(this.captionObj._removeCaption(),this._catpionObj=null)},getEvents:function(){var t={viewreset:this._project,moveend:this._update};return t.zoomanim=this._updateCaptionPos,t},onRemove:function(){this._renderer._removePath(this),this.removeCaption()}}),o.circleMarker=function(t,i){return new o.CircleMarker(t,i)},o.Circle=o.CircleMarker.extend({initialize:function(t,i,e){o.setOptions(this,e),this._utmk=o.utmk(t),this._mRadius=i},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){this._radiusY||(this._radiusY=this._radius);var t=[this._radius,this._radiusY];return new o.UTMKBounds(this._map.layerPointToUTMK(this._point.subtract(t)),this._map.layerPointToUTMK(this._point.add(t)))},setStyle:o.Path.prototype.setStyle,_project:function(){var t=this._map,i=t.options.crs,e=i.unproject(i.project(this._utmk).subtract([this._mRadius,0]));this._point=t.utmkToLayerPoint(this._utmk),this._radius=this._point.x-t.utmkToLayerPoint(e).x,this._updateBounds()}}),o.circle=function(t,i,e){return new o.Circle(t,i,e)},o.SVG=o.Renderer.extend({_initContainer:function(){this._container=o.SVG.create("svg"),this._paths={},this._initEvents(),this._container.setAttribute("pointer-events","none")},_update:function(){if(!this._map._animatingZoom||!this._bounds){o.Renderer.prototype._update.call(this);var t=this._bounds,i=t.getSize(),e=this._container,n=this.getPane();o.Browser.mobileWebkit&&n.removeChild(e),o.DomUtil.setPosition(e,t.min),this._svgSize&&this._svgSize.equals(i)||(this._svgSize=i,e.setAttribute("width",i.x),e.setAttribute("height",i.y)),o.DomUtil.setPosition(e,t.min),e.setAttribute("viewBox",[t.min.x,t.min.y,i.x,i.y].join(" ")),o.Browser.mobileWebkit&&n.appendChild(e)}},_initPath:function(t){var i=t._path=o.SVG.create("path");t.options.className&&o.DomUtil.addClass(i,t.options.className),t.options.clickable&&o.DomUtil.addClass(i,"sop-clickable"),this._updateStyle(t)},_addPath:function(t){var i=t._path;this._container.appendChild(i),this._paths[o.stamp(i)]=t},_removePath:function(t){var i=t._path;o.DomUtil.remove(i),delete this._paths[o.stamp(i)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var i=t._path,e=t.options;i&&(e.stroke?(i.setAttribute("stroke",e.color),i.setAttribute("stroke-opacity",e.opacity),i.setAttribute("stroke-width",e.weight),i.setAttribute("stroke-linecap",e.lineCap),i.setAttribute("stroke-linejoin",e.lineJoin),e.dashArray?i.setAttribute("stroke-dasharray",e.dashArray):i.removeAttribute("stroke-dasharray"),e.dashOffset?i.setAttribute("stroke-dashoffset",e.dashOffset):i.removeAttribute("stroke-dashoffset")):i.setAttribute("stroke","none"),e.fill?(i.setAttribute("fill",e.fillColor||e.color),i.setAttribute("fill-opacity",e.fillOpacity),i.setAttribute("fill-rule","evenodd")):i.setAttribute("fill","none"),i.setAttribute("pointer-events",e.pointerEvents||(e.clickable?"visiblePainted":"none")))},_updatePoly:function(t,i){this._setPath(t,o.SVG.pointsToPath(t._parts,i))},_updateCircle:function(t){var i=t._point,e=t._radius,n=t._radiusY||e,o="a"+e+","+n+" 0 1,0 ",s=t._empty()?"M0 0":"M"+(i.x-e)+","+i.y+o+2*e+",0 "+o+2*-e+",0 ";this._setPath(t,s)},_setPath:function(t,i){t._path.setAttribute("d",i)},_bringToFront:function(t){o.DomUtil.toFront(t._path)},_bringToBack:function(t){o.DomUtil.toBack(t._path)},_initEvents:function(){o.DomEvent.on(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu",this._fireMouseEvent,this)},_fireMouseEvent:function(t){var i=this._paths[o.stamp(t.target||t.srcElement)];i&&i._fireMouseEvent(t)}}),o.extend(o.SVG,{create:function(t){return i.createElementNS("http://www.w3.org/2000/svg",t)},pointsToPath:function(t,i){var e,n,s,r,a,h,u="";for(e=0,s=t.length;s>e;e++){for(a=t[e],n=0,r=a.length;r>n;n++)h=a[n],u+=(n?"L":"M")+h.x+" "+h.y;u+=i?o.Browser.svg?"z":"x":""}return u||"M0 0"}}),o.Browser.svg=!(!i.createElementNS||!o.SVG.create("svg").createSVGRect),o.svg=function(t){return o.Browser.svg||o.Browser.vml?new o.SVG(t):null},o.Browser.vml=!o.Browser.svg&&function(){try{var t=i.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(n){return!1}}(),o.SVG.include(o.Browser.vml?{_initContainer:function(){this._container=o.DomUtil.create("div","sop-vml-container"),this._paths={},this._initEvents()},_update:function(){this._map._animatingZoom||o.Renderer.prototype._update.call(this)},_initPath:function(t){var i=t._container=o.SVG.create("shape");o.DomUtil.addClass(i,"sop-vml-shape "+(this.options.className||"")),i.coordsize="1 1",t._path=o.SVG.create("path"),i.appendChild(t._path),this._updateStyle(t)},_addPath:function(t){var i=t._container;this._container.appendChild(i),this._paths[o.stamp(i)]=t},_removePath:function(t){var i=t._container;o.DomUtil.remove(i),delete this._paths[o.stamp(i)]},_updateStyle:function(t){var i=t._stroke,e=t._fill,n=t.options,s=t._container;s.stroked=!!n.stroke,s.filled=!!n.fill,n.stroke?(i||(i=t._stroke=o.SVG.create("stroke"),s.appendChild(i)),i.weight=n.weight+"px",i.color=n.color,i.opacity=n.opacity,i.dashStyle=n.dashArray?o.Util.isArray(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):"",i.endcap=n.lineCap.replace("butt","flat"),i.joinstyle=n.lineJoin):i&&(s.removeChild(i),t._stroke=null),n.fill?(e||(e=t._fill=o.SVG.create("fill"),s.appendChild(e)),e.color=n.fillColor||n.color,e.opacity=n.fillOpacity):e&&(s.removeChild(e),t._fill=null)},_updateCircle:function(t){var i=t._point,e=Math.round(t._radius),n=Math.round(t._radiusY||e);this._setPath(t,t._empty()?"M0 0":"AL "+i.x+","+i.y+" "+e+","+n+" 0,23592600")},_setPath:function(t,i){t._path.v=i}}:{}),o.Browser.vml&&(o.SVG.create=function(){try{return i.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return i.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return i.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),o.Canvas=o.Renderer.extend({onAdd:function(){o.Renderer.prototype.onAdd.call(this),this._layers=this._layers||{},this._draw()},_initContainer:function(){var t=this._container=i.createElement("canvas");o.DomEvent.on(t,"mousemove",this._onMouseMove,this).on(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),this._ctx=t.getContext("2d")},_update:function(){if(!this._map._animatingZoom||!this._bounds){o.Renderer.prototype._update.call(this);var t=this._bounds,i=this._container,e=t.getSize(),n=o.Browser.retina?2:1;o.DomUtil.setPosition(i,t.min),i.width=n*e.x,i.height=n*e.y,i.style.width=e.x+"px",i.style.height=e.y+"px",o.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y)}},_initPath:function(t){this._layers[o.stamp(t)]=t},_addPath:o.Util.falseFn,_removePath:function(t){t._removed=!0,this._requestRedraw(t)},_updatePath:function(t){this._redrawBounds=t._pxBounds,this._draw(!0),t._project(),t._update(),this._draw(),this._redrawBounds=null},_updateStyle:function(t){this._requestRedraw(t)},_requestRedraw:function(t){this._map&&(this._redrawBounds=this._redrawBounds||new o.Bounds,this._redrawBounds.extend(t._pxBounds.min).extend(t._pxBounds.max),this._redrawRequest=this._redrawRequest||o.Util.requestAnimFrame(this._redraw,this))},_redraw:function(){this._redrawRequest=null,this._draw(!0),this._draw(),this._redrawBounds=null},_draw:function(t){this._clear=t;var i;for(var e in this._layers)i=this._layers[e],(!this._redrawBounds||i._pxBounds.intersects(this._redrawBounds))&&i._updatePath(),t&&i._removed&&(delete i._removed,delete this._layers[e])},_updatePoly:function(t,i){var e,n,o,s,r=t._parts,a=r.length,h=this._ctx;if(a){for(h.beginPath(),e=0;a>e;e++){for(n=0,o=r[e].length;o>n;n++)s=r[e][n],h[n?"lineTo":"moveTo"](s.x,s.y);i&&h.closePath()}this._fillStroke(h,t)}},_updateCircle:function(t){if(!t._empty()){var i=t._point,e=this._ctx,n=t._radius,o=(t._radiusY||n)/n;1!==o&&(e.save(),e.scale(1,o)),e.beginPath(),e.arc(i.x,i.y/o,n,0,2*Math.PI,!1),1!==o&&e.restore(),this._fillStroke(e,t)}},_fillStroke:function(t,i){var e=this._clear,n=i.options;t.globalCompositeOperation=e?"destination-out":"source-over",n.fill&&(t.globalAlpha=e?1:n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill("evenodd")),n.stroke&&(t.globalAlpha=e?1:n.opacity,i._prevWeight=t.lineWidth=e?i._prevWeight+1:n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){var i=this._map.mouseEventToLayerPoint(t);for(var e in this._layers)this._layers[e]._containsPoint(i)&&this._layers[e]._fireMouseEvent(t)},_onMouseMove:function(t){if(this._map&&!this._map._animatingZoom){var i=this._map.mouseEventToLayerPoint(t);for(var e in this._layers)this._handleHover(this._layers[e],t,i)}},_handleHover:function(t,i,e){t.options.clickable&&(t._containsPoint(e)?(t._mouseInside||(o.DomUtil.addClass(this._container,"sop-clickable"),t._fireMouseEvent(i,"mouseover"),t._mouseInside=!0),t._fireMouseEvent(i)):t._mouseInside&&(o.DomUtil.removeClass(this._container,"sop-clickable"),t._fireMouseEvent(i,"mouseout"),t._mouseInside=!1))},_bringToFront:o.Util.falseFn,_bringToBack:o.Util.falseFn}),o.Browser.canvas=function(){return!!i.createElement("canvas").getContext}(),o.canvas=function(t){return o.Browser.canvas?new o.Canvas(t):null},o.Polyline.prototype._containsPoint=function(t,i){var e,n,s,r,a,h,u=this._clickTolerance();if(!this._pxBounds.contains(t))return!1;for(e=0,r=this._parts.length;r>e;e++)for(h=this._parts[e],n=0,a=h.length,s=a-1;a>n;s=n++)if((i||0!==n)&&o.LineUtil.pointToSegmentDistance(t,h[s],h[n])<=u)return!0;return!1},o.Polygon.prototype._containsPoint=function(t){var i,e,n,s,r,a,h,u,l=!1;if(!this._pxBounds.contains(t))return!1;for(s=0,h=this._parts.length;h>s;s++)for(i=this._parts[s],r=0,u=i.length,a=u-1;u>r;a=r++)e=i[r],n=i[a],e.y>t.y!=n.y>t.y&&t.x<(n.x-e.x)*(t.y-e.y)/(n.y-e.y)+e.x&&(l=!l);return l||o.Polyline.prototype._containsPoint.call(this,t,!0)},o.CircleMarker.prototype._containsPoint=function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()},o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,i){o.setOptions(this,i),this._layers={},t&&this.addData(t)},addData:function(t){var i,e,n,s=o.Util.isArray(t)?t:t.features;if(s){for(i=0,e=s.length;e>i;i++)n=s[i],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var r=this.options;if(!r.filter||r.filter(t)){var a=o.GeoJSON.geometryToLayer(t,r);return a.feature=o.GeoJSON.asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),r.onEachFeature&&r.onEachFeature(t,a),this.addLayer(a)}},resetStyle:function(t){return t.options=t.defaultOptions,this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(i){this._setLayerStyle(i,t)},this)},_setLayerStyle:function(t,i){"function"==typeof i&&(i=i(t.feature)),t.setStyle&&t.setStyle(i)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,i){var e,n,s,r,a="Feature"===t.type?t.geometry:t,h=a.coordinates,u=[],l=i&&i.pointToLayer,c=i&&i.coordsToUTMK||this.coordsToUTMK;switch(a.type){case"Point":return e=c(h),l?l(t,e):new o.Marker(e);case"MultiPoint":for(s=0,r=h.length;r>s;s++)e=c(h[s]),u.push(l?l(t,e):new o.Marker(e));return new o.FeatureGroup(u);case"LineString":case"MultiLineString":return n=this.coordsToUTMKs(h,"LineString"===a.type?0:1,c),new o.Polyline(n,i);case"Polygon":case"MultiPolygon":return n=this.coordsToUTMKs(h,"Polygon"===a.type?1:2,c),new o.Polygon(n,i);case"GeometryCollection":for(s=0,r=a.geometries.length;r>s;s++)u.push(this.geometryToLayer({geometry:a.geometries[s],type:"Feature",properties:t.properties},i));return new o.FeatureGroup(u);default:throw new Error("Invalid GeoJSON object.")}},coordsToUTMK:function(t){return new o.UTMK(t[0],t[1],t[2])},coordsToUTMKs:function(t,i,e){for(var n,o=[],s=0,r=t.length;r>s;s++)n=i?this.coordsToUTMKs(t[s],i-1,e):(e||this.coordsToUTMK)(t[s]),o.push(n);return o},utmkToCoords:function(t){return t.alt!==e?[t.x,t.y,t.alt]:[t.x,t.y]},utmksToCoords:function(t,i,e){for(var n=[],s=0,r=t.length;r>s;s++)n.push(i?o.GeoJSON.utmksToCoords(t[s],i-1,e):o.GeoJSON.utmkToCoords(t[s]));return!i&&e&&n.push(n[0]),n},getFeature:function(t,i){return t.feature?o.extend({},t.feature,{geometry:i}):o.GeoJSON.asFeature(i)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var r={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.utmkToCoords(this.getUTMK())})}};o.Marker.include(r),o.Circle.include(r),o.CircleMarker.include(r),o.Polyline.prototype.toGeoJSON=function(){var t=!this._flat(this._utmks),i=o.GeoJSON.utmksToCoords(this._utmks,t?1:0);return o.GeoJSON.getFeature(this,{type:(t?"Multi":"")+"LineString",coordinates:i})},o.Polygon.prototype.toGeoJSON=function(){var t=!this._flat(this._utmks),i=t&&!this._flat(this._utmks[0]),e=o.GeoJSON.utmksToCoords(this._utmks,i?2:t?1:0,!0);return t&&1===this._utmks.length&&(i=!0,e=[e]),t||(e=[e]),o.GeoJSON.getFeature(this,{type:(i?"Multi":"")+"Polygon",coordinates:e})},o.LayerGroup.include({toMultiPoint:function(){var t=[];return this.eachLayer(function(i){t.push(i.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint();var i="GeometryCollection"===t,e=[];return this.eachLayer(function(t){if(t.toGeoJSON){var n=t.toGeoJSON();e.push(i?n.geometry:o.GeoJSON.asFeature(n))}}),i?o.GeoJSON.getFeature(this,{geometries:e,type:"GeometryCollection"}):{type:"FeatureCollection",features:e}}}),o.geoJson=function(t,i){return new o.GeoJSON(t,i)};var a="_sop_events";o.DomEvent={on:function(t,i,e,n){if("object"==typeof i)for(var s in i)this._on(t,s,i[s],e);else{i=o.Util.splitWords(i);for(var r=0,a=i.length;a>r;r++)this._on(t,i[r],e,n)}return this},off:function(t,i,e,n){if("object"==typeof i)for(var s in i)this._off(t,s,i[s],e);else{i=o.Util.splitWords(i);for(var r=0,a=i.length;a>r;r++)this._off(t,i[r],e,n)}return this},_on:function(i,e,n,s){var r=e+o.stamp(n)+(s?"_"+o.stamp(s):"");if(i[a]&&i[a][r])return this;var h=function(e){return n.call(s||i,e||t.event)},u=h;return o.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(i,e,h,r):(o.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(i,h,r),"addEventListener"in i?"mousewheel"===e?(i.addEventListener("DOMMouseScroll",h,!1),i.addEventListener(e,h,!1)):"mouseenter"===e||"mouseleave"===e?(h=function(e){return e=e||t.event,o.DomEvent._checkMouse(i,e)?u(e):void 0},i.addEventListener("mouseenter"===e?"mouseover":"mouseout",h,!1)):("click"===e&&o.Browser.android&&(h=function(t){return o.DomEvent._filterClick(t,u)}),i.addEventListener(e,h,!1)):"attachEvent"in i&&i.attachEvent("on"+e,h),i[a]=i[a]||{},i[a][r]=h,this)},_off:function(t,i,e,n){var s=i+o.stamp(e)+(n?"_"+o.stamp(n):""),r=t[a]&&t[a][s];return r?(o.Browser.pointer&&0===i.indexOf("touch")?this.removePointerListener(t,i,s):o.Browser.touch&&"dblclick"===i&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,s):"removeEventListener"in t?"mousewheel"===i?(t.removeEventListener("DOMMouseScroll",r,!1),t.removeEventListener(i,r,!1)):t.removeEventListener("mouseenter"===i?"mouseover":"mouseleave"===i?"mouseout":i,r,!1):"detachEvent"in t&&t.detachEvent("on"+i,r),t[a][s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){return o.DomEvent.on(t,"mousewheel MozMousePixelScroll",o.DomEvent.stopPropagation)},disableClickPropagation:function(t){var i=o.DomEvent.stopPropagation;return o.DomEvent.on(t,o.Draggable.START.join(" "),i),o.DomEvent.on(t,{click:o.DomEvent._fakeStop,dblclick:i})},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,i){if(!i)return new o.Point(t.clientX,t.clientY);var e=i.getBoundingClientRect();return new o.Point(t.clientX-e.left-i.clientLeft,t.clientY-e.top-i.clientTop)},getWheelDelta:function(t){var i=0;return t.wheelDelta&&(i=t.wheelDelta/120),t.detail&&(i=-t.detail/3),i},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var i=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,i},_checkMouse:function(t,i){var e=i.relatedTarget;if(!e)return!0;try{for(;e&&e!==t;)e=e.parentNode}catch(n){return!1}return e!==t},_filterClick:function(t,i){var e=t.timeStamp||t.originalEvent.timeStamp,n=o.DomEvent._lastClick&&e-o.DomEvent._lastClick;return n&&n>100&&500>n||t.target._simulatedClick&&!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=e,i(t))}},o.DomEvent.addListener=o.DomEvent.on,o.DomEvent.removeListener=o.DomEvent.off,o.Draggable=o.Evented.extend({statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,i){this._element=t,this._dragStartTarget=i||t},enable:function(){this._enabled||(o.DomEvent.on(this._dragStartTarget,o.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(o.DomEvent.off(this._dragStartTarget,o.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._moved=!1,!(t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(o.DomEvent.stopPropagation(t),o.Draggable._disabled||(o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),this._moving)))){this.fire("down");var e=t.touches?t.touches[0]:t;this._startPoint=new o.Point(e.clientX,e.clientY),this._startPos=this._newPos=o.DomUtil.getPosition(this._element),o.DomEvent.on(i,o.Draggable.MOVE[t.type],this._onMove,this).on(i,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new o.Point(e.clientX,e.clientY),s=n.subtract(this._startPoint);(s.x||s.y)&&(o.Browser.touch&&Math.abs(s.x)+Math.abs(s.y)<3||(o.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(s),o.DomUtil.addClass(i.body,"sop-dragging"),this._lastTarget=t.target||t.srcElement,o.DomUtil.addClass(this._lastTarget,"sop-drag-target")),this._newPos=this._startPos.add(s),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){o.DomUtil.removeClass(i.body,"sop-dragging"),this._lastTarget&&(o.DomUtil.removeClass(this._lastTarget,"sop-drag-target"),this._lastTarget=null);for(var t in o.Draggable.MOVE)o.DomEvent.off(i,o.Draggable.MOVE[t],this._onMove,this).off(i,o.Draggable.END[t],this._onUp,this);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&&this._moving&&(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:o.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDown:function(){this._map._panAnim&&this._map._panAnim.stop()},_onDragStart:function(){var t=this._map;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,i=this._lastPos=this._draggable._newPos;this._positions.push(i),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize().divideBy(2),i=this._map.utmkToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_onPreDrag:function(){var t=this._worldWidth,i=Math.round(t/2),e=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-i+e)%t+i-e,s=(n+i+e)%t-i-e,r=Math.abs(o+e)<Math.abs(s+e)?o:s;this._draggable._newPos.x=r},_onDragEnd:function(t){var i=this._map,e=i.options,n=+new Date-this._lastTime,s=!e.inertia||n>e.inertiaThreshold||!this._positions[0];if(i.fire("dragend",t),s)i.fire("moveend");else{var r=this._lastPos.subtract(this._positions[0]),a=(this._lastTime+n-this._times[0])/1e3,h=e.easeLinearity,u=r.multiplyBy(h/a),l=u.distanceTo([0,0]),c=Math.min(e.inertiaMaxSpeed,l),d=u.multiplyBy(c/l),m=c/(e.inertiaDeceleration*h),_=d.multiplyBy(-m/2).round();_.x&&_.y?(_=i._limitOffset(_,i.options.maxBounds),o.Util.requestAnimFrame(function(){i.panBy(_,{duration:m,easeLinearity:h,noMoveStart:!0})})):i.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var i=this._map,e=i.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===i.options.doubleClickZoom?i.setZoom(e):i.setZoomAround(t.containerPoint,e)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,{mousewheel:this._onWheelScroll,MozMousePixelScroll:o.DomEvent.preventDefault},this),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,{mousewheel:this._onWheelScroll,MozMousePixelScroll:o.DomEvent.preventDefault},this)},_onWheelScroll:function(t){var i=o.DomEvent.getWheelDelta(t);this._delta+=i,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var e=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),e),o.DomEvent.stop(t)},_performZoom:function(){var t=this._map,i=this._delta,e=t.getZoom();i=i>0?Math.ceil(i):Math.floor(i),i=Math.max(Math.min(i,4),-4),i=t._limitZoom(e+i)-e,this._delta=0,this._startTime=null,i&&("center"===t.options.scrollWheelZoom?t.setZoom(e+i):t.setZoomAround(this._lastMousePos,e+i))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_onMouseDown:function(t){return!t.shiftKey||1!==t.which&&1!==t.button?!1:(this._moved=!1,o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),void o.DomEvent.on(i,{contextmenu:o.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=o.DomUtil.create("div","sop-zoom-box",this._container),o.DomUtil.addClass(this._container,"sop-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var i=new o.Bounds(this._point,this._startPoint),e=i.getSize();o.DomUtil.setPosition(this._box,i.min),this._box.style.width=e.x+"px",this._box.style.height=e.y+"px"},_finish:function(){this._moved&&(o.DomUtil.remove(this._box),o.DomUtil.removeClass(this._container,"sop-crosshair")),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(i,{contextmenu:o.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(1!==t.which&&1!==t.button)return!1;if(this._finish(),this._moved){var i=new o.UTMKBounds(this._map.containerPointToUTMK(this._startPoint),this._map.containerPointToUTMK(this._point));this._map.fitBounds(i).fire("boxzoomend",{boxZoomBounds:i})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),o.DomEvent.on(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),o.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=i.body,n=i.documentElement,o=e.scrollTop||n.scrollTop,s=e.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var i,e,n=this._panKeys={},o=this.keyCodes;for(i=0,e=o.left.length;e>i;i++)n[o.left[i]]=[-1*t,0];for(i=0,e=o.right.length;e>i;i++)n[o.right[i]]=[t,0];for(i=0,e=o.down.length;e>i;i++)n[o.down[i]]=[0,t];for(i=0,e=o.up.length;e>i;i++)n[o.up[i]]=[0,-1*t]},_setZoomOffset:function(t){var i,e,n=this._zoomKeys={},o=this.keyCodes;for(i=0,e=o.zoomIn.length;e>i;i++)n[o.zoomIn[i]]=t;for(i=0,e=o.zoomOut.length;e>i;i++)n[o.zoomOut[i]]=-t},_addHooks:function(){o.DomEvent.on(i,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(i,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=t.keyCode,e=this._map;if(i in this._panKeys){if(e._panAnim&&e._panAnim._inProgress)return;e.panBy(this._panKeys[i]),e.options.maxBounds&&e.panInsideBounds(e.options.maxBounds)}else{if(!(i in this._zoomKeys))return;e.setZoom(e.getZoom()+this._zoomKeys[i])}o.DomEvent.stop(t)}}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t)),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),o.DomUtil.addClass(t,"sop-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),o.DomUtil.removeClass(this._marker._icon,"sop-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closeInfoWindow().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,i=t._shadow,e=o.DomUtil.getPosition(t._icon),n=t._map.layerPointToUTMK(e);i&&o.DomUtil.setPosition(i,e),t._utmk=n,t.fire("move",{utmk:n}).fire("drag"),t.captionObj&&t.captionObj._updateCaptionPos(n)},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),o.PosAnimation=o.Evented.extend({run:function(t,i,e,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=i,this.fire("start"),t.style[o.DomUtil.TRANSITION]="all "+(e||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",o.DomEvent.on(t,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),o.DomUtil.setPosition(t,i),o.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(o.bind(this._onStep,this),50)
},stop:function(){this._inProgress&&(this._newPos=this._getPos(),this._newPos&&o.DomUtil.setPosition(this._el,this._newPos),this._onTransitionEnd(),o.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._sop_pos=t,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var i,e,n,s=this._el,r=t.getComputedStyle(s);if(o.Browser.any3d){if(n=r[o.DomUtil.TRANSFORM].match(this._transformRe),!n)return;null!==r[o.DomUtil.TRANSFORM].match(/matrix3d/)?(i=parseFloat(n[1]),e=parseFloat(n[2])):(i=parseFloat(n[3]),e=parseFloat(n[4]))}else i=parseFloat(r.left),e=parseFloat(r.top);return new o.Point(i,e,!0)},_onTransitionEnd:function(){o.DomEvent.off(this._el,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[o.DomUtil.TRANSITION]="",this._el._sop_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),o.Map.include({setView:function(t,i,n){if(i=i===e?this._zoom:this._limitZoom(i),t=this._limitCenter(o.utmk(t),i,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==e&&(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate},n.pan));var s=this._zoom!==i?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,i,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,i),this},panBy:function(t,i){if(t=o.point(t).round(),i=i||{},!t.x&&!t.y)return this;if(i.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom());if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),i.noMoveStart||this.fire("movestart"),i.animate!==!1){o.DomUtil.addClass(this._mapPane,"sop-pan-anim");var e=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,e,i.duration||.25,i.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"sop-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,i){var e=this._getCenterOffset(t)._floor();return(i&&i.animate)===!0||this.getSize().contains(e)?(this.panBy(e,i),!0):!1}}),o.PosAnimation=o.DomUtil.TRANSITION?o.PosAnimation:o.PosAnimation.extend({run:function(t,i,e,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=e||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=i.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,i=1e3*this._duration;i>t?this._runFrame(this._easeOut(t/i)):(this._runFrame(1),this._complete())},_runFrame:function(t){var i=this._startPos.add(this._offset.multiplyBy(t));o.DomUtil.setPosition(this._el,i),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4});var h=o.DomUtil.TRANSITION&&o.Browser.any3d&&!o.Browser.mobileOpera;h&&o.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation,this._zoomAnimated&&o.DomEvent.on(this._mapPane,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),o.Map.include(h?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("sop-zoom-animated").length},_tryAnimatedZoom:function(t,i,e){if(this._animatingZoom)return!0;if(e=e||{},!this._zoomAnimated||e.animate===!1||this._nothingToAnimate()||Math.abs(i-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(i),s=this._getCenterOffset(t)._divideBy(1-1/n);return e.animate===!0||this.getSize().contains(s)?(o.Util.requestAnimFrame(function(){this.fire("movestart").fire("zoomstart")._animateZoom(t,i,!0)},this),!0):!1},_animateZoom:function(t,i,e){e&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=i,o.Draggable&&(o.Draggable._disabled=!0),o.DomUtil.addClass(this._mapPane,"sop-zoom-anim"));var n=this.getZoomScale(i),s=this._getCenterLayerPoint().add(this._getCenterOffset(t)._divideBy(1-1/n));this.fire("zoomanim",{center:t,zoom:i,origin:s,scale:n})},_onZoomTransitionEnd:function(){this._animatingZoom=!1,o.DomUtil.removeClass(this._mapPane,"sop-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),o.Draggable&&(o.Draggable._disabled=!1)}}:{}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var i=this._map;return i&&i.removeControl(this),this.options.position=t,i&&i.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var i=this._container=this.onAdd(t),e=this.getPosition(),n=t._controlCorners[e];return o.DomUtil.addClass(i,"sop-control"),-1!==e.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this},remove:function(){return o.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,s){var r=e+t+" "+e+s;i[t+s]=o.DomUtil.create("div",r,n)}var i=this._controlCorners={},e="sop-",n=this._controlContainer=o.DomUtil.create("div",e+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){o.DomUtil.remove(this._controlContainer)}}),o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,i,e){o.setOptions(this,e),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in i)this._addLayer(i[n],n,!0)},onAdd:function(){return this._initLayout(),this._update(),this._container},addBaseLayer:function(t,i){return this._addLayer(t,i),this._update()},addOverlay:function(t,i){return this._addLayer(t,i,!0),this._update()},removeLayer:function(t){return t.off("add remove",this._onLayerChange,this),delete this._layers[o.stamp(t)],this._update()},_initLayout:function(){var t="sop-control-layers",i=this._container=o.DomUtil.create("div",t);i.setAttribute("aria-haspopup",!0),o.Browser.touch?o.DomEvent.on(i,"click",o.DomEvent.stopPropagation):o.DomEvent.disableClickPropagation(i).disableScrollPropagation(i);var e=this._form=o.DomUtil.create("form",t+"-list");if(this.options.collapsed){o.Browser.android||o.DomEvent.on(i,{mouseenter:this._expand,mouseleave:this._collapse},this);var n=this._layersLink=o.DomUtil.create("a",t+"-toggle",i);n.href="#",n.title="Layers",o.Browser.touch?o.DomEvent.on(n,"click",o.DomEvent.stop).on(n,"click",this._expand,this):o.DomEvent.on(n,"focus",this._expand,this),o.DomEvent.on(e,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=o.DomUtil.create("div",t+"-base",e),this._separator=o.DomUtil.create("div",t+"-separator",e),this._overlaysList=o.DomUtil.create("div",t+"-overlays",e),i.appendChild(e)},_addLayer:function(t,i,e){t.on("add remove",this._onLayerChange,this);var n=o.stamp(t);this._layers[n]={layer:t,name:i,overlay:e},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){o.DomUtil.empty(this._baseLayersList),o.DomUtil.empty(this._overlaysList);var t,i,e,n;for(e in this._layers)n=this._layers[e],this._addItem(n),i=i||n.overlay,t=t||!n.overlay;return this._separator.style.display=i&&t?"":"none",this}},_onLayerChange:function(t){this._handlingClick||this._update();var i=this._layers[o.stamp(t.target)].overlay,e=i?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;e&&this._map.fire(e,t.target)},_createRadioElement:function(t,e){var n='<input type="radio" class="sop-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",o=i.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var e,n=i.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(e=i.createElement("input"),e.type="checkbox",e.className="sop-control-layers-selector",e.defaultChecked=s):e=this._createRadioElement("sop-base-layers",s),e.layerId=o.stamp(t.layer),o.DomEvent.on(e,"click",this._onInputClick,this);var r=i.createElement("span");r.innerHTML=" "+t.name,n.appendChild(e),n.appendChild(r);var a=t.overlay?this._overlaysList:this._baseLayersList;return a.appendChild(n),n},_onInputClick:function(){var t,i,e,n=this._form.getElementsByTagName("input");this._handlingClick=!0;for(var o=0,s=n.length;s>o;o++)t=n[o],i=this._layers[t.layerId].layer,e=this._map.hasLayer(i),t.checked&&!e?this._map.addLayer(i):!t.checked&&e&&this._map.removeLayer(i);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){o.DomUtil.addClass(this._container,"sop-control-layers-expanded")},_collapse:function(){o.DomUtil.removeClass(this._container,"sop-control-layers-expanded")}}),o.control.layers=function(t,i,e){return new o.Control.Layers(t,i,e)}}(window,document);